webpackJsonp([16],{"1nCp":function(t,a){},"3/Ms":function(t,a,e){"use strict";var r=e("mtWM"),i=e.n(r),s=(e("5reh"),e("yJCr")),o=e("XLwt"),l=e.n(o),n={props:{isShow:{type:Boolean},isHeatmapChart:{type:Boolean},itemParams:{type:Object}},data:function(){return{chartLoadingShow:!1,myChart:null,legendData:[],xAxisData:[],yAxisData:[]}},created:function(){this.isHeatmapChart||this.getHeatmapChartData()},mounted:function(){this.isHeatmapChart&&this.drawChart()},watch:{isShow:function(){var t=this;this.isShow?(this.getHeatmapChartData(),this.myChart&&(this.myChart.resize(),window.addEventListener("resize",function(){t.myChart.resize()}))):this.myChart&&this.myChart.clear()}},methods:{getHeatmapChartData:function(){var t=this;t.chartLoadingShow=!0;var a=s.b+"dp/es/datachart/process";console.log(t.itemParams),i.a.post(a,{chartType:"heatmapChart",description:"",params:t.itemParams,title:"heatmapChart"}).then(function(a){if(0==a.data.responseCode){console.log(a.data.data);var e=[],r=[],i=[];a.data.data.aggregations[2].buckets.forEach(function(a){var s=t.transformMyDate(a.key);-1==e.indexOf(s)&&e.push(s),a[3].buckets.forEach(function(a){var o=a.key;a.key_as_string&&(o=t.transformMyDate(o)),-1==r.indexOf(o)&&r.push(o),i.push([t.findIndex(o,r),t.findIndex(s,e),a.doc_count])})}),t.xAxisData=e,t.yAxisData=r,t.myChartData=i,t.drawChart(),t.chartLoadingShow=!1}else t.$message.error(t.$t("lg.failed")+": "+a.data.data.message),t.chartLoadingShow=!1}).catch(function(a){console.log(a),t.chartLoadingShow=!1}),t.$emit("changeFlag",!1)},drawChart:function(){var t=this,a=document.getElementById("chartContainer");t.myChart=l.a.init(a);var e=t.xAxisData,r=t.yAxisData,i=t.myChartData;i&&(i=i.map(function(t){return[t[1],t[0],t[2]||"-"]}));var s={title:{text:"Heatmap Chart",left:"20",textStyle:{fontSize:"16",fontWeight:"normal",color:"#606266"}},tooltip:{trigger:"item",formatter:function(a,e,r){return t.itemParams.y[0].field+": "+t.itemParams.y[0].order._count+"</br> Count: "+a.data[2]},axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},animation:!1,grid:{left:"7%",right:"5%",top:"6%",containLabel:!0},xAxis:{type:"category",data:e,splitArea:{show:!0}},yAxis:{type:"category",data:r,splitArea:{show:!0}},visualMap:{type:"piecewise",maxOpen:"single",min:0,max:500,calculable:!0,orient:"horizontal",left:"center",bottom:"0%"},series:[{name:"Punch Card",type:"heatmap",data:i,label:{show:!1},itemStyle:{emphasis:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};t.myChart.clear(),t.myChart.setOption(s)},transformMyDate:function(t){function a(t){return t<10?"0"+t:t}return(t=new Date(t)).getFullYear()+"-"+a(parseInt(t.getMonth())+1)+"-"+a(t.getDate())+" "+a(t.getHours())+":"+a(t.getMinutes())+":"+a(t.getSeconds())},findIndex:function(t,a){return a.findIndex(function(a){return a==t})}}},h={render:function(){var t=this.$createElement,a=this._self._c||t;return a("div",[a("p",{staticClass:"nodataTxt"},[this.chartLoadingShow?a("span",[a("i",{staticClass:"el-icon-loading"}),this._v(" "+this._s(this.$t("lg.loading")))]):this._e(),0!=this.yAxisData.length||this.chartLoadingShow?this._e():a("span",[this._v(this._s(this.$t("lg.nodata")))])]),this._v(" "),a("div",{staticClass:"chartContainer",attrs:{id:"chartContainer"}})])},staticRenderFns:[]};var m=e("VU/8")(n,h,!1,function(t){e("iuXj")},"data-v-07e4a798",null);a.a=m.exports},"7mhK":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=e("mtWM"),i=e.n(r),s=e("yJCr"),o=e("5reh"),l=e("qqiS"),n=e("3/Ms"),h={data:function(){return{aggregationXOptions:[{value:"date_histogram",label:"Date Histogram"}],aggregationYOptions:[{value:"terms",label:"Terms"}],fieldXOptions:[{value:"Data",disabled:!0},{value:"@timestamp"}],intervalOptions:[{value:"s",label:this.$t("lg.second")},{value:"m",label:this.$t("lg.minite")},{value:"h",label:this.$t("lg.hour")},{value:"d",label:this.$t("lg.day")},{value:"w",label:this.$t("lg.week")},{value:"M",label:this.$t("lg.month")},{value:"y",label:this.$t("lg.year")}],orderByOptions:[{value:"metric:Count"}],orderOptions:[{value:"desc",label:"Descending"},{value:"asc",label:"Ascending"}],heatmapChartForm:{aggregationX:"date_histogram",fieldX:"@timestamp",intervalNumX:"500",intervalUnitX:"s",intervalLimitAble:!1,aggregationY:"",fieldY:"",orderByY:"metric:Count",sizeY:"5",orderY:"desc"},heatmapChartFormRules:{aggregationX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],fieldX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],intervalNumX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"},{pattern:/^[0-9]+$/,message:"必须为正整数数值",trigger:"change"}],aggregationY:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],fieldY:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],orderByY:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],sizeY:[{required:!0,message:this.$t("lg.required"),trigger:"blur"},{pattern:/^[0-9]+$/,message:this.$t("lg.requirepositive"),trigger:"change"}],orderY:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}]},isSetChartShow:!1,setChartForm:{describeTxt:""},setChartFormRules:{describeTxt:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}]},setChartLoading:!1,myChartFlag:!1,itemParams:{}}},methods:{aggregationYchange:function(t){this.heatmapChartForm.fieldY="",this.$store.commit(o.d,t)},intervalLimit:function(t){"w"==t||"M"==t||"y"==t?(this.heatmapChartForm.intervalLimitAble=!0,this.heatmapChartForm.intervalNumX=1):this.heatmapChartForm.intervalLimitAble=!1},getHeatmapChartData:function(){var t=this;this.$refs.heatmapChartForm.validate(function(a){if(a){var e=t;e.chartLoadingShow=!0,e.xAxisData=[],e.yAxisData=[],e.myChartData=[];s.b;var r=e.$store.state.mydatedata.starttime,i=e.$store.state.mydatedata.endtime,o={timeRange:{from:r.getTime(),to:i.getTime()},x:{agg:e.heatmapChartForm.aggregationX,field:e.heatmapChartForm.fieldX,interval:e.heatmapChartForm.intervalNumX+e.heatmapChartForm.intervalUnitX,min_doc_count:1},y:[{agg:e.heatmapChartForm.aggregationY,field:e.heatmapChartForm.fieldY,size:e.heatmapChartForm.sizeY,order:{_count:e.heatmapChartForm.orderY}}]};e.myChartFlag=!0,e.itemParams=o}})},fatherChange:function(){this.myChartFlag=!1},showSetChart:function(){var t=this;this.$refs.heatmapChartForm.validate(function(a){a&&(t.isSetChartShow=!0)})},setChartClose:function(){this.isSetChartShow=!1,this.$refs.setChartForm.resetFields()},setHeatmapChartData:function(){var t=this;this.$refs.setChartForm.validate(function(a){if(a){var e=t;e.setChartLoading=!0;var r=s.b+"dp/es/datachart",o=e.$store.state.mydatedata.starttime,l=e.$store.state.mydatedata.endtime,n={timeRange:{from:o.getTime(),to:l.getTime()},x:{agg:e.heatmapChartForm.aggregationX,field:e.heatmapChartForm.fieldX,interval:e.heatmapChartForm.intervalNumX+e.heatmapChartForm.intervalUnitX,min_doc_count:1},y:[{agg:e.heatmapChartForm.aggregationY,field:e.heatmapChartForm.fieldY,size:e.heatmapChartForm.sizeY,order:{_count:e.heatmapChartForm.orderY}}]};i.a.post(r,{chartType:"heatmapChart",description:e.setChartForm.describeTxt,params:n,title:"heatmapChart"}).then(function(a){0==a.data.responseCode?(console.log(a.data.data),t.$message({type:"success",message:e.$t("lg.success")}),e.setChartLoading=!1,e.setChartClose()):(e.$message.error(e.$t("lg.failed")+": "+a.data.data.message),e.setChartLoading=!1)}).catch(function(t){console.log(t)})}})}},components:{loading:l.a,heatmapPic:n.a}},m={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"heatmapChart-wrapper"},[e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:8}},[e("el-form",{ref:"heatmapChartForm",attrs:{model:t.heatmapChartForm,rules:t.heatmapChartFormRules,"label-width":"120px"}},[e("div",{staticClass:"form-bg"},[e("p",{staticClass:"chartformTitle"},[t._v("X-Axis")]),t._v(" "),e("el-form-item",{attrs:{label:"Aggregation",prop:"aggregationX"}},[e("el-select",{staticStyle:{width:"60%"},model:{value:t.heatmapChartForm.aggregationX,callback:function(a){t.$set(t.heatmapChartForm,"aggregationX",a)},expression:"heatmapChartForm.aggregationX"}},t._l(t.aggregationXOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),t.heatmapChartForm.aggregationX?e("el-form-item",{attrs:{label:"Field",prop:"fieldX"}},[e("el-select",{staticStyle:{width:"70%"},model:{value:t.heatmapChartForm.fieldX,callback:function(a){t.$set(t.heatmapChartForm,"fieldX",a)},expression:"heatmapChartForm.fieldX"}},t._l(t.fieldXOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.value,value:t.value,disabled:t.disabled}})}))],1):t._e(),t._v(" "),"date_histogram"==t.heatmapChartForm.aggregationX?e("div",[e("el-form-item",{attrs:{label:"Interval",prop:"intervalNumX"}},[e("el-input",{staticStyle:{width:"45%"},attrs:{placeholder:t.$t("lg.interval"),disabled:t.heatmapChartForm.intervalLimitAble},model:{value:t.heatmapChartForm.intervalNumX,callback:function(a){t.$set(t.heatmapChartForm,"intervalNumX","string"==typeof a?a.trim():a)},expression:"heatmapChartForm.intervalNumX"}}),t._v(" "),e("el-select",{staticStyle:{width:"35%"},attrs:{placeholder:t.$t("lg.select")},on:{change:function(a){t.intervalLimit(t.heatmapChartForm.intervalUnitX)}},model:{value:t.heatmapChartForm.intervalUnitX,callback:function(a){t.$set(t.heatmapChartForm,"intervalUnitX",a)},expression:"heatmapChartForm.intervalUnitX"}},t._l(t.intervalOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)],1):t._e()],1),t._v(" "),e("div",{staticClass:"form-bg"},[e("p",{staticClass:"chartformTitle"},[t._v("Y-Axis")]),t._v(" "),e("el-form-item",{attrs:{label:"Aggregation",prop:"aggregationY"}},[e("el-select",{staticStyle:{width:"60%"},on:{change:function(a){t.aggregationYchange(t.heatmapChartForm.aggregationY)}},model:{value:t.heatmapChartForm.aggregationY,callback:function(a){t.$set(t.heatmapChartForm,"aggregationY",a)},expression:"heatmapChartForm.aggregationY"}},t._l(t.aggregationYOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),t.heatmapChartForm.aggregationY?e("el-form-item",{attrs:{label:"Field",prop:"fieldY"}},[e("el-select",{staticStyle:{width:"70%"},model:{value:t.heatmapChartForm.fieldY,callback:function(a){t.$set(t.heatmapChartForm,"fieldY",a)},expression:"heatmapChartForm.fieldY"}},t._l(t.$store.state.fieldYOptions,function(t,a){return e("el-option",{key:a,attrs:{label:t.value,value:t.value,disabled:t.disabled}})}))],1):t._e(),t._v(" "),"terms"==t.heatmapChartForm.aggregationY?e("div",[e("el-form-item",{attrs:{label:"Order By",prop:"orderByY"}},[e("el-select",{staticStyle:{width:"60%"},attrs:{placeholder:t.$t("lg.select")},model:{value:t.heatmapChartForm.orderByY,callback:function(a){t.$set(t.heatmapChartForm,"orderByY",a)},expression:"heatmapChartForm.orderByY"}},t._l(t.orderByOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.value,value:t.value}})}))],1),t._v(" "),e("el-form-item",{attrs:{label:"Size",prop:"sizeY"}},[e("el-input",{staticStyle:{width:"45%"},attrs:{placeholder:"size"},model:{value:t.heatmapChartForm.sizeY,callback:function(a){t.$set(t.heatmapChartForm,"sizeY","string"==typeof a?a.trim():a)},expression:"heatmapChartForm.sizeY"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"Order",prop:"orderY"}},[e("el-select",{staticStyle:{width:"60%"},attrs:{placeholder:t.$t("lg.select")},model:{value:t.heatmapChartForm.orderY,callback:function(a){t.$set(t.heatmapChartForm,"orderY",a)},expression:"heatmapChartForm.orderY"}},t._l(t.orderOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)],1):t._e()],1),t._v(" "),e("div",{staticClass:"form-bg"},[e("el-button",{attrs:{size:"small",type:"primary",icon:"fa fa-play"},on:{click:t.getHeatmapChartData}},[t._v(" "+t._s(t.$t("lg.generateview")))]),t._v(" "),e("el-button",{attrs:{size:"small",type:"success",icon:"fa fa-cloud"},on:{click:t.showSetChart}},[t._v(" "+t._s(t.$t("lg.saverecord")))])],1)])],1),t._v(" "),e("el-col",{attrs:{span:16}},[e("div",{staticClass:"chartBox"},[e("heatmap-pic",{attrs:{isShow:t.myChartFlag,itemParams:t.itemParams,isHeatmapChart:!0},on:{changeFlag:t.fatherChange}})],1),t._v(" "),e("router-link",{attrs:{to:"/chartMenu"}},[e("el-button",{staticClass:"backBtn el-icon-back",attrs:{size:"small",type:"info",plain:""}},[t._v(" "+t._s(t.$t("lg.back")))])],1)],1)],1),t._v(" "),e("el-dialog",{attrs:{title:t.$t("lg.saveviewrecord"),visible:t.isSetChartShow,width:"45%","before-close":t.setChartClose},on:{"update:visible":function(a){t.isSetChartShow=a}}},[e("el-form",{ref:"setChartForm",attrs:{model:t.setChartForm,rules:t.setChartFormRules,"label-width":"80px"}},[e("el-form-item",{attrs:{label:t.$t("lg.viewdesc"),prop:"describeTxt"}},[e("el-input",{attrs:{placeholder:t.$t("lg.description")},model:{value:t.setChartForm.describeTxt,callback:function(a){t.$set(t.setChartForm,"describeTxt","string"==typeof a?a.trim():a)},expression:"setChartForm.describeTxt"}})],1),t._v(" "),e("el-form-item",[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.setHeatmapChartData}},[t._v(" "+t._s(t.$t("lg.yes")))])],1)],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.setChartLoading,expression:"setChartLoading"}]},[e("loading",{attrs:{title:t.$t("lg.handling")}})],1)],1)],1)},staticRenderFns:[]};var g=e("VU/8")(h,m,!1,function(t){e("1nCp")},"data-v-60a5f436",null);a.default=g.exports},iuXj:function(t,a){}});
//# sourceMappingURL=16.d7b8a9eb674357107133.js.map