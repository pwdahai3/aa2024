webpackJsonp([26],{AQTE:function(e,t){},yQjI:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("//Fk"),i=o.n(a),s=o("bOdI"),r=o.n(s),n=o("Gu7T"),l=o.n(n),c=o("mtWM"),d=o.n(c),m=o("yJCr"),f=o("qqiS"),p=o("xrTZ").Base64,h={components:{loading:f.a},data:function(){return{quickConfigLoading:!1,currentStep:1,stepFormList:["shadownodesform","domainform","locationform","lcbotconfform"],currentForm:"shadownodesform",shadownodesform:{shadownodes:""},nodesdata:[],shadownodesformRules:{shadownodes:[{required:!0,message:this.$t("lg.required"),trigger:"change"}]},domainform:{http:"http",domain:"",domainPort:80,remark:"",diplomas:"",keys:"",innerHttp:"http",configArray:[{ip:"",ipPort:"",ipWeight:""}],checkList:["ipv4"]},domainformRules:{domain:[{required:!0,message:this.$t("lg.required"),trigger:"blur"},{pattern:/^([\w\-." \\*!$@?^()<>{}[\]=%&:;/~+#`,])+$/,message:this.$t("lg.invalidformat"),trigger:"blur"}],domainPort:[{required:!0,message:this.$t("lg.required"),trigger:"blur"},{pattern:/^([0-9]|[1-9]\d{1,3}|[1-5]\d{4}|6[0-5]{2}[0-3][0-5])$/,message:this.$t("lg.invalidport"),trigger:"change"}],diplomas:[{required:!0,message:this.$t("lg.select"),trigger:"blur"}],keys:[{required:!0,message:this.$t("lg.select"),trigger:"blur"}]},crts:[],diplomas:[],keys:[],checkedTactics:"polling",ipTactics:[{value:"polling",name:this.$t("lg.polling")},{value:"least_conn",name:this.$t("lg.leastcon")},{value:"ip_weight",name:this.$t("lg.weights")},{value:"ip_hash",name:"ip_hash"},{value:"xxf_hash",name:"xff_hash"}],ipLabelWidth:"100px",locationform:{locationType:"/",locationName:"/"},locationformRules:{locationType:[{required:!0,message:this.$t("lg.required"),trigger:"change"}],locationName:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}]},lcbotconfform:{botconfVal:!1},lcbotconfformRules:{botconfVal:[]}}},created:function(){this.getShadowNodes()},watch:{"domainform.http":function(){this.domainform.domainPort="https"==this.domainform.http?443:80}},methods:{getShadowNodes:function(){var e=this,t=m.b+"pe/shadow/snode";d.a.get(t).then(function(t){0==t.data.responseCode?e.nodesdata=t.data.data:e.$message.error(e.$t("lg.failed")+": "+t.data.data.message)}).catch(function(e){console.log(e)})},getCrts:function(e){var t=this;if(!e)return!1;var o=this.shadownodesform.shadownodes;if(o){var a=m.b+"pe/file/client/"+o+"/crt";d.a.get(a).then(function(e){0==e.data.responseCode?(t.crts=e.data.data,t.getPems()):t.$message.error(t.$t("lg.failed")+": "+e.data.data.message)}).catch(function(e){console.log(e)})}},getPems:function(e){var t=this,o=this.shadownodesform.shadownodes;if(o){var a=m.b+"pe/file/client/"+o+"/pem";d.a.get(a).then(function(e){if(0==e.data.responseCode){var o=e.data.data;t.diplomas=t.crts.concat(o)}else t.$message.error(t.$t("lg.failed")+": "+e.data.data.message)}).catch(function(e){console.log(e)})}},getKeys:function(e){var t=this;if(!e)return!1;var o=this.shadownodesform.shadownodes;if(o){var a=m.b+"pe/file/client/"+o+"/key";d.a.get(a).then(function(e){0==e.data.responseCode?t.keys=e.data.data:t.$message.error(t.$t("lg.failed")+": "+e.data.data.message)}).catch(function(e){console.log(e)})}},addDomainBox:function(){this.domainform.configArray.push({ip:"",ipPort:"",ipWeight:""})},delDomainBox:function(e){1!=this.domainform.configArray.length&&this.domainform.configArray.splice(e,1)},lastStep:function(){this.currentStep>=2&&(this.currentStep-=1),this.currentForm=this.stepFormList[this.currentStep-1]},nextStep:function(){var e=this;this.$refs[this.currentForm].validate(function(t){t&&(4==e.currentStep?e.$confirm("点击确认即完成了快速配置，是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}).then(function(){e.submitQuickConfig()}).catch(function(){e.$message({type:"info",message:"已取消操作"})}):(e.currentStep+=1,e.currentForm=e.stepFormList[e.currentStep-1]))})},submitQuickConfig:function(){var e=this;e.quickConfigLoading=!0;var t,o=[e.shadownodesform.shadownodes,e.domainform.http,e.domainform.domain,e.domainform.domainPort,e.domainform.remark,e.domainform.innerHttp,[].concat(l()(e.domainform.configArray)),e.checkedTactics],a=o[0],i=o[1],s=o[2],n=o[3],c=o[4],f=o[5],p=o[7],h=[];h=o[6].map(function(e){return/(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/.test(e.ip)&&!/^\[|\]$/.test(e.ip)&&(e.ip="["+e.ip+"]"),"ip_weight"==p?{server:e.ip+":"+e.ipPort+" weight="+e.ipWeight}:{server:e.ip+":"+e.ipPort}}),"polling"!==p&&"ip_weight"!==p&&h.push(r()({},p,""));var u=e.domainform.checkList;1==u.length?t=u[0]:2==u.length&&(t=u[0]+"|"+u[1]);var g=m.b+"pe/shadow/domain",v={snodeId:a,domainName:s,domainPort:n,remark:c,serverScheme:f,servers:h,ssl:"off",ipListenConfs:t};"https"==i&&(v.ssl="on",v.key=e.domainform.keys,v.crt=e.domainform.diplomas),d.a.post(g,v).then(function(t){0==t.data.responseCode?e.addLocation():e.$message.error(e.$t("lg.failed")+": ("+e.$t("lg.rightip")+")"+t.data.data.message)}).catch(function(t){console.log(t),e.$message.error(e.$t("lg.failed")+": "+t.response.data.data.message)})},addLocation:function(){var e=this,t=this,o=m.b+"pe/shadow/domain/location",a=[t.shadownodesform.shadownodes,t.domainform.domain,t.domainform.domainPort,t.locationform.locationType,t.locationform.locationName],i={snodeId:a[0],domainName:a[1],domainPort:a[2],locationType:a[3],locationName:a[4],waf:"off",wafRuleset:[]};d.a.post(o,i).then(function(o){0==o.data.responseCode?t.sdShadowlib().then(function(e){t.lcInsertJs().then(function(e){t.lcBotconf()})}):e.$message.error(t.$t("lg.failed")+":"+o.data.data.message)}).catch(function(e){console.log(e)})},sdShadowlib:function(){var e=this;return new i.a(function(t,o){var a=[e.shadownodesform.shadownodes,e.domainform.domain],i=a[0],s=a[1],r=m.b+"pe/shadow/config/shadowlib/"+i,n={};n[p.encode(s)]={aclick:!1,crossdomain:"",bodye:!1,isws:!1,acookieorencpyt:!1},d.a.patch(r,n).then(function(o){0==o.data.responseCode?t(!0):e.$message.error(e.$t("lg.failed")+":"+o.data.data.message)}).catch(function(e){console.log(e)})})},lcInsertJs:function(){var e=this;return new i.a(function(t,o){var a=[e.shadownodesform.shadownodes,e.domainform.domain,e.domainform.domainPort,e.locationform.locationType,e.locationform.locationName],i=a[0],s=a[1],r=a[2],n=a[3],l=a[4],c=m.b+"pe/shadow/domain/location/directive",f=[{shadow_insert_js_ex:p.encode("pe 10s 1 '<head>' '<head><script src=\"/formvalidator/' 'config.js' '\"><\/script>'")},{shadow_insert_js_ex:p.encode("pe 10s 1 '</title>' '</title><script src=\"/formvalidator/' 'shadowlib.js' '\"><\/script>'")}];d.a.post(c,{snodeId:i,domainName:s,domainPort:r,locationType:n,locationName:l,directives:f}).then(function(o){0==o.data.responseCode?t(!0):e.$message.error(e.$t("lg.failed")+"。输入的指令不匹配，请核对输入内容！"+o.data.data.message)}).catch(function(e){console.log(e)})})},lcBotconf:function(){var e=this,t=[this.shadownodesform.shadownodes,this.domainform.domain,this.domainform.domainPort,this.locationform.locationType,this.locationform.locationName,this.lcbotconfform.botconfVal?"on":"off"],o=t[0],a=t[1],i=t[2],s=t[3],r=t[4],n=t[5],l=m.b+"pe/shadow/domain/location/botconf?snodeId="+o+"&domainName="+a+"&domainPort="+i+"&locationName="+r+"&locationType="+s;d.a.patch(l,{botConf:n}).then(function(t){0==t.data.responseCode?e.$message({type:"success",message:"新的配置已生成！"}):e.$message.error(e.$t("lg.failed")+": "+t.data.data.message),e.quickConfigLoading=!1}).catch(function(e){console.log(e)})}}},u={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"quickconfig-wrapper"},[o("h2",{staticClass:"breadcrumb"},[e._v("快速配置向导")]),e._v(" "),o("div",{staticClass:"form-bg"},[o("el-steps",{attrs:{active:e.currentStep,"finish-status":"success"}},[o("el-step",{attrs:{title:"步骤 1",description:"选择节点"}}),e._v(" "),o("el-step",{attrs:{title:"步骤 2",description:"添加业务"}}),e._v(" "),o("el-step",{attrs:{title:"步骤 3",description:"创建被保护对象"}}),e._v(" "),o("el-step",{attrs:{title:"步骤 4",description:"配置扫描工具防御功能"}})],1)],1),e._v(" "),o("ul",{staticClass:"stepContent"},[o("li",{directives:[{name:"show",rawName:"v-show",value:1==e.currentStep,expression:"currentStep==1"}]},[o("h2",{staticClass:"stepTitle"},[e._v("选择要新增配置的节点")]),e._v(" "),o("el-form",{ref:"shadownodesform",staticClass:"orderBoxJamb",attrs:{model:e.shadownodesform,"label-width":"110px",rules:e.shadownodesformRules}},[o("el-form-item",{attrs:{label:e.$t("lg.shadownode"),prop:"shadownodes"}},[o("el-select",{staticStyle:{width:"50%"},attrs:{placeholder:e.$t("lg.select")},model:{value:e.shadownodesform.shadownodes,callback:function(t){e.$set(e.shadownodesform,"shadownodes",t)},expression:"shadownodesform.shadownodes"}},[e._l(e.nodesdata,function(e){return[o("el-option",{attrs:{label:e.isShadowGroup?e.hostName+"(集群)":e.hostName+"("+e.snodeId+")",value:e.snodeId}})]})],2)],1)],1)],1),e._v(" "),o("li",{directives:[{name:"show",rawName:"v-show",value:2==e.currentStep,expression:"currentStep==2"}]},[o("h2",{staticClass:"stepTitle"},[e._v("为选择的节点添加业务")]),e._v(" "),o("el-form",{ref:"domainform",staticClass:"domainformBox",attrs:{model:e.domainform,"label-width":"90px",rules:e.domainformRules}},[o("div",{staticClass:"outBorder box1"},[o("span",{staticClass:"titleSpan qkConfigtitleSpan"},[e._v(e._s(e.$t("lg.externalserviceconf")))]),e._v(" "),o("el-form-item",{attrs:{label:e.$t("lg.httpout")}},[o("el-select",{staticStyle:{width:"100%"},model:{value:e.domainform.http,callback:function(t){e.$set(e.domainform,"http",t)},expression:"domainform.http"}},[[o("el-option",{attrs:{label:"http",value:"http"}}),e._v(" "),o("el-option",{attrs:{label:"https",value:"https"}})]],2)],1),e._v(" "),o("el-form-item",{attrs:{label:e.$t("lg.bsdomain"),prop:"domain"}},[o("el-input",{model:{value:e.domainform.domain,callback:function(t){e.$set(e.domainform,"domain","string"==typeof t?t.trim():t)},expression:"domainform.domain"}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.$t("lg.bsport"),prop:"domainPort"}},[o("el-input",{model:{value:e.domainform.domainPort,callback:function(t){e.$set(e.domainform,"domainPort","string"==typeof t?t.trim():t)},expression:"domainform.domainPort"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"备注",prop:"remark"}},[o("el-input",{model:{value:e.domainform.remark,callback:function(t){e.$set(e.domainform,"remark","string"==typeof t?t.trim():t)},expression:"domainform.remark"}})],1),e._v(" "),"https"==e.domainform.http?o("el-form-item",{attrs:{label:e.$t("lg.selectcer"),prop:"diplomas"}},[o("el-select",{attrs:{placeholder:e.$t("lg.selectcer")},on:{"visible-change":e.getCrts},model:{value:e.domainform.diplomas,callback:function(t){e.$set(e.domainform,"diplomas",t)},expression:"domainform.diplomas"}},[e._l(e.diplomas,function(e){return[o("el-option",{attrs:{label:e.name,value:e.name}})]})],2)],1):e._e(),e._v(" "),"https"==e.domainform.http?o("el-form-item",{attrs:{label:e.$t("lg.selectsec"),prop:"keys"}},[o("el-select",{attrs:{placeholder:e.$t("lg.selectsec")},on:{"visible-change":e.getKeys},model:{value:e.domainform.keys,callback:function(t){e.$set(e.domainform,"keys",t)},expression:"domainform.keys"}},[e._l(e.keys,function(e){return[o("el-option",{attrs:{label:e.name,value:e.name}})]})],2)],1):e._e(),e._v(" "),o("el-form-item",[o("el-checkbox-group",{attrs:{min:1},model:{value:e.domainform.checkList,callback:function(t){e.$set(e.domainform,"checkList",t)},expression:"domainform.checkList"}},[o("el-checkbox",{attrs:{label:"ipv4"}},[e._v("IPV4")]),e._v(" "),o("el-checkbox",{attrs:{label:"ipv6"}},[e._v("IPV6")])],1)],1)],1),e._v(" "),o("div",{staticClass:"outBorder box2"},[o("span",{staticClass:"titleSpan qkConfigtitleSpan"},[e._v(e._s(e.$t("lg.internalserviceconf")))]),e._v(" "),o("el-form-item",{attrs:{label:e.$t("lg.httpin"),"label-width":e.ipLabelWidth}},[o("el-select",{staticStyle:{width:"100%"},model:{value:e.domainform.innerHttp,callback:function(t){e.$set(e.domainform,"innerHttp",t)},expression:"domainform.innerHttp"}},[[o("el-option",{attrs:{label:"http",value:"http"}}),e._v(" "),o("el-option",{attrs:{label:"https",value:"https"}})]],2)],1),e._v(" "),o("div",{staticStyle:{position:"relative"}},[e._l(e.domainform.configArray,function(t,a){return o("div",{key:a,staticClass:"inBorder"},[o("span",{staticClass:"delIp",on:{click:function(t){e.delDomainBox(a)}}},[o("i",{staticClass:"el-icon-close"})]),e._v(" "),o("el-form-item",{attrs:{label:"IP","label-width":e.ipLabelWidth,prop:"configArray."+a+".ip",rules:[{required:!0,message:e.$t("lg.required"),trigger:"blur"},{pattern:/^([\w\-. *!$@?^()<>{}[\]=%&:\;/~+#`,])+$/,message:e.$t("lg.invalidformat"),trigger:"blur"}]}},[o("el-input",{model:{value:t.ip,callback:function(o){e.$set(t,"ip","string"==typeof o?o.trim():o)},expression:"item.ip"}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.$t("lg.port"),"label-width":e.ipLabelWidth,prop:"configArray."+a+".ipPort",rules:[{required:!0,message:e.$t("lg.required"),trigger:"blur"},{pattern:/^([0-9]|[1-9]\d{1,3}|[1-5]\d{4}|6[0-5]{2}[0-3][0-5])$/,message:e.$t("lg.invalidport"),trigger:"change"}]}},[o("el-input",{model:{value:t.ipPort,callback:function(o){e.$set(t,"ipPort","string"==typeof o?o.trim():o)},expression:"item.ipPort"}})],1),e._v(" "),"ip_weight"==e.checkedTactics?o("el-form-item",{attrs:{label:e.$t("lg.weights"),"label-width":e.ipLabelWidth,prop:"configArray."+a+".ipWeight",rules:[{required:!0,message:e.$t("lg.required"),trigger:"blur"},{pattern:/^[0-9]+$/,message:e.$t("lg.requirepositive"),trigger:"change"}]}},[o("el-input",{model:{value:t.ipWeight,callback:function(o){e.$set(t,"ipWeight","string"==typeof o?o.trim():o)},expression:"item.ipWeight"}})],1):e._e()],1)}),e._v(" "),o("span",{staticClass:"addIp",attrs:{title:e.$t("lg.addmoreinternalbs")},on:{click:e.addDomainBox}},[o("i",{staticClass:"el-icon-circle-plus-outline"})])],2),e._v(" "),o("el-form-item",{attrs:{label:e.$t("lg.balancestrategy"),"label-width":"120px"}},[o("el-radio-group",{model:{value:e.checkedTactics,callback:function(t){e.checkedTactics=t},expression:"checkedTactics"}},e._l(e.ipTactics,function(t){return o("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.name))])}))],1)],1)])],1),e._v(" "),o("li",{directives:[{name:"show",rawName:"v-show",value:3==e.currentStep,expression:"currentStep==3"}]},[o("h2",{staticClass:"stepTitle"},[e._v("给新增的业务创建通用保护对象")]),e._v(" "),o("el-form",{ref:"locationform",staticClass:"orderBoxJamb",attrs:{model:e.locationform,rules:e.locationformRules,"label-width":"145px"}},[o("el-form-item",{attrs:{label:e.$t("lg.matchtype"),prop:"locationType"}},[o("el-select",{attrs:{placeholder:e.$t("lg.matchtype")},model:{value:e.locationform.locationType,callback:function(t){e.$set(e.locationform,"locationType",t)},expression:"locationform.locationType"}},[o("el-option",{attrs:{label:"通用匹配",value:"/"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.$t("lg.protectedpos"),prop:"locationName"}},[o("el-input",{staticStyle:{width:"50%"},attrs:{disabled:"/"==e.locationform.locationType},model:{value:e.locationform.locationName,callback:function(t){e.$set(e.locationform,"locationName","string"==typeof t?t.trim():t)},expression:"locationform.locationName"}})],1)],1)],1),e._v(" "),o("li",{directives:[{name:"show",rawName:"v-show",value:4==e.currentStep,expression:"currentStep==4"}]},[o("h2",{staticClass:"stepTitle"},[e._v("配置通用保护对象的扫描工具防御功能")]),e._v(" "),o("el-form",{ref:"lcbotconfform",staticClass:"orderBoxJamb",attrs:{model:e.lcbotconfform,rules:e.lcbotconfformRules,"label-width":"170px"}},[o("el-form-item",{attrs:{label:"开启扫描工具防御功能",prop:"botconfVal"}},[o("el-switch",{model:{value:e.lcbotconfform.botconfVal,callback:function(t){e.$set(e.lcbotconfform,"botconfVal",t)},expression:"lcbotconfform.botconfVal"}})],1)],1)],1)]),e._v(" "),o("div",{staticClass:"stepBtn"},[o("el-button",{attrs:{disabled:1==e.currentStep},on:{click:e.lastStep}},[e._v("上一步")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.nextStep}},[e._v(e._s(4==e.currentStep?"完成":"下一步"))])],1),e._v(" "),o("loading",{directives:[{name:"show",rawName:"v-show",value:e.quickConfigLoading,expression:"quickConfigLoading"}]})],1)},staticRenderFns:[]};var g=o("VU/8")(h,u,!1,function(e){o("AQTE")},"data-v-dad4afe4",null);t.default=g.exports}});
//# sourceMappingURL=26.eb3fab07636b16770f62.js.map