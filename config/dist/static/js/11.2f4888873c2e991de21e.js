webpackJsonp([11],{VjWF:function(t,e,a){"use strict";var i=a("fZjL"),r=a.n(i),l=a("mtWM"),n=a.n(l),s=(a("5reh"),a("yJCr")),o=a("XLwt"),g=a.n(o),h={props:{isShow:{type:Boolean},isLineChart:{type:Boolean},itemParams:{type:Object}},data:function(){return{chartLoadingShow:!1,myChart:null,legendData:[],xAxisData:[],yAxisData:[]}},created:function(){this.isLineChart||this.getLineChartData()},mounted:function(){this.isLineChart&&this.drawChart()},watch:{isShow:function(){var t=this;this.isShow?(this.getLineChartData(),this.myChart&&(this.myChart.resize(),window.addEventListener("resize",function(){t.myChart.resize()}))):this.myChart&&this.myChart.clear()}},methods:{getLineChartData:function(){var t=this;t.chartLoadingShow=!0;var e=s.b+"dp/es/datachart/process";console.log(t.itemParams),n.a.post(e,{chartType:"lineChart",description:"",params:t.itemParams,title:"lineChart"}).then(function(e){if(console.log(e),0==e.data.responseCode){var a=e.data.data.aggregations[2].buckets,i=[],l=[],n=[],s={},o=[],g=!1;t.itemParams.y.forEach(function(t,e){"count"==t.agg?g=!0:n.push(t.field+"("+t.agg+")")}),a.forEach(function(e){o.push(e.doc_count);var a=t.transformMyDate(e.key);-1==i.indexOf(a)&&i.push(a),r()(e).forEach(function(t){isNaN(t)||(s[t]?s[t].push(e[t].value):s[t]=[e[t].value])})}),n.forEach(function(t,e){l.push({name:t,type:"line",data:s[e+3]})}),console.log(s),console.log(n),g&&(l.push({name:"count",type:"line",data:o}),n.push("count")),t.xAxisData=i,t.yAxisData=l,t.legendData=n,t.drawChart(),t.chartLoadingShow=!1}else t.$message.error(t.$t("lg.failed")+": "+e.data.data.message),t.chartLoadingShow=!1}).catch(function(e){console.log(e),t.chartLoadingShow=!1}),t.$emit("changeFlag",!1)},drawChart:function(){var t=document.getElementById("chartContainer");this.myChart=g.a.init(t);var e={title:{text:"Line Chart",left:"20",textStyle:{fontSize:"16",fontWeight:"normal",color:"#606266"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:this.legendData},grid:{left:"3%",right:"5%",top:"8%",bottom:"4%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:this.xAxisData},yAxis:{type:"value"},series:this.yAxisData};this.myChart.clear(),this.myChart.setOption(e)},transformMyDate:function(t){function e(t){return t<10?"0"+t:t}return(t=new Date(t)).getFullYear()+"-"+e(parseInt(t.getMonth())+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())}}},c={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("p",{staticClass:"nodataTxt"},[this.chartLoadingShow?e("span",[e("i",{staticClass:"el-icon-loading"}),this._v(" "+this._s(this.$t("lg.loading")))]):this._e(),0!=this.yAxisData.length||this.chartLoadingShow?this._e():e("span",[this._v(this._s(this.$t("lg.nodata")))])]),this._v(" "),e("div",{staticClass:"chartContainer",attrs:{id:"chartContainer"}})])},staticRenderFns:[]};var d=a("VU/8")(h,c,!1,function(t){a("yJ6t")},"data-v-371a9d8a",null);e.a=d.exports},"Wi/x":function(t,e){},nQxS:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mtWM"),r=a.n(i),l=a("yJCr"),n=a("5reh"),s=a("qqiS"),o=a("VjWF"),g={data:function(){return{aggregationXOptions:[{value:"date_histogram",label:"Date Histogram"}],aggregationYOptions:[{value:"count",label:"Count"},{value:"avg",label:"Average"},{value:"sum",label:"Sum"},{value:"min",label:"Min"},{value:"max",label:"Max"},{value:"cardinality",label:"Unique Count"}],fieldXOptions:[{value:"Data",disabled:!0},{value:"@timestamp"}],intervalOptions:[{value:"s",label:this.$t("lg.second")},{value:"m",label:this.$t("lg.minite")},{value:"h",label:this.$t("lg.hour")},{value:"d",label:this.$t("lg.day")},{value:"w",label:this.$t("lg.week")},{value:"M",label:this.$t("lg.month")},{value:"y",label:this.$t("lg.year")}],orderByOptions:[{value:"metric:Count"}],orderOptions:[{value:"desc",label:"Descending"},{value:"asc",label:"Ascending"}],lineChartForm:{aggregationX:"date_histogram",fieldX:"@timestamp",intervalNumX:"500",intervalUnitX:"s",intervalLimitAble:!1,orderByX:"metric:Count",sizeX:"5",orderX:"desc",lineChartYAxis:[{aggregationY:"",fieldY:""}]},lineChartFormRules:{aggregationX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],fieldX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],intervalNumX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"},{pattern:/^[0-9]+$/,message:this.$t("lg.requirepositive"),trigger:"change"}],orderByX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],sizeX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"},{pattern:/^[0-9]+$/,message:this.$t("lg.requirepositive"),trigger:"change"}],orderX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}]},isSetChartShow:!1,setChartForm:{describeTxt:""},setChartFormRules:{describeTxt:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}]},setChartLoading:!1,myChartFlag:!1,itemParams:{}}},methods:{intervalLimit:function(t){"w"==t||"M"==t||"y"==t?(this.lineChartForm.intervalLimitAble=!0,this.lineChartForm.intervalNumX=1):this.lineChartForm.intervalLimitAble=!1},addItem:function(){this.lineChartForm.lineChartYAxis.push({aggregationY:"",fieldY:""})},deleteItem:function(t){1!=this.lineChartForm.lineChartYAxis.length&&this.lineChartForm.lineChartYAxis.splice(t,1)},aggregationYchange:function(t){this.lineChartForm.lineChartYAxis[t].fieldY=""},fieldYchange:function(t,e){this.$store.commit(n.d,e)},getLineChartData:function(){var t=this;this.$refs.lineChartForm.validate(function(e){if(e){var a=t,i=(l.b,a.$store.state.mydatedata.starttime),r=a.$store.state.mydatedata.endtime,n=i.getTime(),s=r.getTime(),o=[];a.lineChartForm.lineChartYAxis.forEach(function(t){"count"!=t.aggregationY?o.push({agg:t.aggregationY,field:t.fieldY}):o.push({agg:t.aggregationY})});var g={timeRange:{from:n,to:s},x:{agg:a.lineChartForm.aggregationX,field:a.lineChartForm.fieldX,interval:a.lineChartForm.intervalNumX+a.lineChartForm.intervalUnitX,min_doc_count:1},y:o};a.myChartFlag=!0,a.itemParams=g}})},fatherChange:function(){this.myChartFlag=!1},showSetChart:function(){var t=this;this.$refs.lineChartForm.validate(function(e){e&&(t.isSetChartShow=!0)})},setChartClose:function(){this.isSetChartShow=!1,this.$refs.setChartForm.resetFields()},setLineChartData:function(){var t=this;this.$refs.setChartForm.validate(function(e){if(e){var a=t;a.setChartLoading=!0;var i=l.b+"dp/es/datachart",n=a.$store.state.mydatedata.starttime,s=a.$store.state.mydatedata.endtime,o=n.getTime(),g=s.getTime(),h=[];a.lineChartForm.lineChartYAxis.forEach(function(t){"count"!=t.aggregationY?h.push({agg:t.aggregationY,field:t.fieldY}):h.push({agg:t.aggregationY})});var c={timeRange:{from:o,to:g},x:{agg:a.lineChartForm.aggregationX,field:a.lineChartForm.fieldX,interval:a.lineChartForm.intervalNumX+a.lineChartForm.intervalUnitX,min_doc_count:1},y:h};r.a.post(i,{chartType:"lineChart",description:a.setChartForm.describeTxt,params:c,title:"lineChart"}).then(function(e){console.log(e),0==e.data.responseCode?(t.$message({type:"success",message:a.$t("lg.success")}),a.setChartLoading=!1,a.setChartClose()):(a.$message.error(a.$t("lg.failed")+": "+e.data.data.message),a.setChartLoading=!1)}).catch(function(t){console.log(t)})}})}},components:{loading:s.a,linePic:o.a}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lineChart-wrapper"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:8}},[a("el-form",{ref:"lineChartForm",attrs:{model:t.lineChartForm,rules:t.lineChartFormRules,"label-width":"120px"}},[a("div",{staticClass:"form-bg"},[a("p",{staticClass:"chartformTitle"},[t._v("X-Axis")]),t._v(" "),a("el-form-item",{attrs:{label:"Aggregation",prop:"aggregationX"}},[a("el-select",{staticStyle:{width:"60%"},model:{value:t.lineChartForm.aggregationX,callback:function(e){t.$set(t.lineChartForm,"aggregationX",e)},expression:"lineChartForm.aggregationX"}},t._l(t.aggregationXOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),t.lineChartForm.aggregationX?a("el-form-item",{attrs:{label:"Field",prop:"fieldX"}},[a("el-select",{staticStyle:{width:"70%"},model:{value:t.lineChartForm.fieldX,callback:function(e){t.$set(t.lineChartForm,"fieldX",e)},expression:"lineChartForm.fieldX"}},t._l(t.fieldXOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.value,value:t.value,disabled:t.disabled}})}))],1):t._e(),t._v(" "),"date_histogram"==t.lineChartForm.aggregationX?a("div",[a("el-form-item",{attrs:{label:"Interval",prop:"intervalNumX"}},[a("el-input",{staticStyle:{width:"45%"},attrs:{placeholder:t.$t("lg.interval"),disabled:t.lineChartForm.intervalLimitAble},model:{value:t.lineChartForm.intervalNumX,callback:function(e){t.$set(t.lineChartForm,"intervalNumX","string"==typeof e?e.trim():e)},expression:"lineChartForm.intervalNumX"}}),t._v(" "),a("el-select",{staticStyle:{width:"35%"},attrs:{placeholder:t.$t("lg.select")},on:{change:function(e){t.intervalLimit(t.lineChartForm.intervalUnitX)}},model:{value:t.lineChartForm.intervalUnitX,callback:function(e){t.$set(t.lineChartForm,"intervalUnitX",e)},expression:"lineChartForm.intervalUnitX"}},t._l(t.intervalOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)],1):t._e()],1),t._v(" "),a("div",{staticClass:"form-bg"},[a("p",{staticClass:"chartformTitle"},[t._v("Y-Axis")]),t._v(" "),t._l(t.lineChartForm.lineChartYAxis,function(e,i){return a("div",{key:i,staticClass:"addItemBox"},[a("span",{staticClass:"delItemStyle",on:{click:function(e){t.deleteItem(i)}}},[a("i",{staticClass:"el-icon-close"})]),t._v(" "),a("el-form-item",{attrs:{label:"Aggregation",prop:"lineChartYAxis."+i+".aggregationY",rules:[{required:!0,message:t.$t("lg.required"),trigger:"blur"}]}},[a("el-select",{staticStyle:{width:"60%"},on:{change:function(e){t.aggregationYchange(i)}},model:{value:e.aggregationY,callback:function(a){t.$set(e,"aggregationY",a)},expression:"items.aggregationY"}},t._l(t.aggregationYOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),e.aggregationY&&"count"!=e.aggregationY?a("el-form-item",{attrs:{label:"Field",prop:"lineChartYAxis."+i+".fieldY",rules:[{required:!0,message:t.$t("lg.required"),trigger:"blur"}]}},[a("el-select",{staticStyle:{width:"70%"},on:{"visible-change":function(a){t.fieldYchange(a,e.aggregationY)}},model:{value:e.fieldY,callback:function(a){t.$set(e,"fieldY",a)},expression:"items.fieldY"}},t._l(t.$store.state.fieldYOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.value,value:t.value,disabled:t.disabled}})}))],1):t._e()],1)}),t._v(" "),a("span",{staticClass:"addItemStyle",attrs:{title:t.$t("lg.addmoreyaxis")},on:{click:t.addItem}},[a("i",{staticClass:"el-icon-circle-plus-outline"})])],2),t._v(" "),a("div",{staticClass:"form-bg"},[a("el-button",{attrs:{size:"small",type:"primary",icon:"fa fa-play"},on:{click:t.getLineChartData}},[t._v(" "+t._s(t.$t("lg.generateview")))]),t._v(" "),a("el-button",{attrs:{size:"small",type:"success",icon:"fa fa-cloud"},on:{click:t.showSetChart}},[t._v(" "+t._s(t.$t("lg.saverecord")))])],1)])],1),t._v(" "),a("el-col",{attrs:{span:16}},[a("div",{staticClass:"chartBox"},[a("line-pic",{attrs:{isShow:t.myChartFlag,itemParams:t.itemParams,isLineChart:!0},on:{changeFlag:t.fatherChange}})],1),t._v(" "),a("router-link",{attrs:{to:"/chartMenu"}},[a("el-button",{staticClass:"backBtn el-icon-back",attrs:{size:"small",type:"info",plain:""}},[t._v(" "+t._s(t.$t("lg.back")))])],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{title:t.$t("lg.saveviewrecord"),visible:t.isSetChartShow,width:"45%","before-close":t.setChartClose},on:{"update:visible":function(e){t.isSetChartShow=e}}},[a("el-form",{ref:"setChartForm",attrs:{model:t.setChartForm,rules:t.setChartFormRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:t.$t("lg.viewdesc"),prop:"describeTxt"}},[a("el-input",{attrs:{placeholder:t.$t("lg.description")},model:{value:t.setChartForm.describeTxt,callback:function(e){t.$set(t.setChartForm,"describeTxt","string"==typeof e?e.trim():e)},expression:"setChartForm.describeTxt"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.setLineChartData}},[t._v(" "+t._s(t.$t("lg.yes")))])],1)],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.setChartLoading,expression:"setChartLoading"}]},[a("loading",{attrs:{title:t.$t("lg.handling")}})],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(g,h,!1,function(t){a("Wi/x")},"data-v-ba2ea34a",null);e.default=c.exports},yJ6t:function(t,e){}});
//# sourceMappingURL=11.2f4888873c2e991de21e.js.map