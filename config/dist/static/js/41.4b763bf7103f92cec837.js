webpackJsonp([41],{XswT:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("mtWM"),a=o.n(i),r=o("5reh"),n=o("yJCr"),s=o("T+n0"),l=o("qqiS"),m={props:{isShow:{type:Boolean},editData:{type:Object},editedJobId:{type:String}},data:function(){return{createJobLoading:!1,jobTypeOptions:[{value:"time_series",label:"time_series"}],jobAggOptions:[{value:"count",label:"Count"},{value:"avg",label:"Average"},{value:"sum",label:"Sum"},{value:"min",label:"Min"},{value:"max",label:"Max"},{value:"cardinality",label:"Unique Count"}],intervalOptions:[{value:"s",label:"秒"},{value:"m",label:"分钟"},{value:"h",label:"小时"},{value:"d",label:"天"},{value:"w",label:"一周"},{value:"M",label:"一个月"},{value:"y",label:"一年"}],machineJobForm:{jobName:"",jobDescription:"",jobType:"time_series",jobAgg:"",jobField:"",jobTimeFrom:"",jobTimeTo:"",intervalNum:"500",intervalUnit:"s",intervalLimitAble:!1},machineJobFormRules:{jobName:[{required:!0,message:"不能为空",trigger:"blur"}],jobDescription:[{required:!0,message:"不能为空",trigger:"blur"}],jobType:[{required:!0,message:"不能为空",trigger:"blur"}],jobField:[{required:!0,message:"不能为空",trigger:"blur"}],jobAgg:[{required:!0,message:"不能为空",trigger:"blur"}],jobTimeFrom:[{required:!0,message:"不能为空",trigger:"blur"}],jobTimeTo:[{required:!0,message:"不能为空",trigger:"blur"}],intervalNum:[{required:!0,message:"不能为空",trigger:"blur"},{pattern:/^[0-9]+$/,message:"必须为正整数数值",trigger:"blur"}]}}},watch:{isShow:function(){if(this.isShow)if(this.editedJobId){console.log(this.editData);var e=this.editData.params.interval.match(/(\d*)(\w*)/)[1]-0,t=this.editData.params.interval.match(/(\d*)(\w*)/)[2],o=new Date(this.editData.params.from_ts),i=new Date(this.editData.params.to_ts);this.machineJobForm.jobName=this.editData.name,this.machineJobForm.jobDescription=this.editData.description,this.machineJobForm.jobType=this.editData.task_type,this.machineJobForm.jobAgg=this.editData.params.agg,this.machineJobForm.jobField=this.editData.params.field,this.machineJobForm.jobTimeFrom=o,this.machineJobForm.jobTimeTo=i,this.machineJobForm.intervalNum=e,this.machineJobForm.intervalUnit=t}else this.machineJobForm.jobName="",this.machineJobForm.jobDescription="",this.machineJobForm.jobType="time_series",this.machineJobForm.jobAgg="",this.machineJobForm.jobField="",this.machineJobForm.jobTimeFrom="",this.machineJobForm.jobTimeTo="",this.machineJobForm.intervalNum="500",this.machineJobForm.intervalUnit="s"}},methods:{createNewJobClose:function(){this.$refs.machineJobForm.resetFields(),this.$emit("createNewJobClose")},jobAggChange:function(){this.machineJobForm.jobField=""},jobFieldChange:function(e,t){this.$store.commit(r.d,t)},intervalLimit:function(e){"w"==e||"M"==e||"y"==e?(this.machineJobForm.intervalLimitAble=!0,this.machineJobForm.intervalNum=1):this.machineJobForm.intervalLimitAble=!1},createJobEnsure:function(){var e=this;this.$refs.machineJobForm.validate(function(t){if(t){var o=e;o.createJobLoading=!0,console.log(o.machineJobForm.jobTimeFrom),console.log(o.machineJobForm.jobTimeTo);var i=o.machineJobForm.jobTimeFrom,r=o.machineJobForm.jobTimeTo,l=Object(s.a)(i),m=Object(s.a)(r),c={time_series:o.machineJobForm.jobType,agg:o.machineJobForm.jobAgg,field:o.machineJobForm.jobField,from_ts:l,to_ts:m,interval:o.machineJobForm.intervalNum+o.machineJobForm.intervalUnit};if(o.editedJobId){console.log(55);var b=n.b+"ml/job/"+o.editedJobId;a.a.patch(b,{name:o.machineJobForm.jobName,description:o.machineJobForm.jobDescription,task_type:o.machineJobForm.jobType,params:c,status:null,last_start_ts:null,last_finish_ts:null}).then(function(e){console.log(e),o.createNewJobClose(),o.createJobLoading=!1,o.$emit("getJobListAgain")})}else{console.log(66);var h=n.b+"ml/job";a.a.post(h,{name:o.machineJobForm.jobName,description:o.machineJobForm.jobDescription,task_type:o.machineJobForm.jobType,params:c,status:null,last_start_ts:null,last_finish_ts:null}).then(function(e){console.log(e),o.createNewJobClose(),o.createJobLoading=!1,o.$emit("getJobListAgain")})}}})}},components:{loading:l.a}},c={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-dialog",{attrs:{title:e.editedJobId?"Update Job":"Create New Job",visible:e.isShow,width:"45%","before-close":e.createNewJobClose},on:{"update:visible":function(t){e.isShow=t}}},[o("el-form",{ref:"machineJobForm",attrs:{model:e.machineJobForm,rules:e.machineJobFormRules,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"Name",prop:"jobName"}},[o("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"作业名字"},model:{value:e.machineJobForm.jobName,callback:function(t){e.$set(e.machineJobForm,"jobName","string"==typeof t?t.trim():t)},expression:"machineJobForm.jobName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Description",prop:"jobDescription"}},[o("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"机器学习作业简单描述"},model:{value:e.machineJobForm.jobDescription,callback:function(t){e.$set(e.machineJobForm,"jobDescription","string"==typeof t?t.trim():t)},expression:"machineJobForm.jobDescription"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Job Tpye",prop:"jobType"}},[o("el-select",{staticStyle:{width:"30%"},model:{value:e.machineJobForm.jobType,callback:function(t){e.$set(e.machineJobForm,"jobType",t)},expression:"machineJobForm.jobType"}},[e._l(e.jobTypeOptions,function(e){return[o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})]})],2)],1),e._v(" "),o("el-form-item",{attrs:{label:"Aggregation",prop:"jobAgg"}},[o("el-select",{staticStyle:{width:"30%"},on:{change:function(t){e.jobAggChange()}},model:{value:e.machineJobForm.jobAgg,callback:function(t){e.$set(e.machineJobForm,"jobAgg",t)},expression:"machineJobForm.jobAgg"}},[e._l(e.jobAggOptions,function(e){return[o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})]})],2)],1),e._v(" "),e.machineJobForm.jobAgg&&"count"!=e.machineJobForm.jobAgg?o("el-form-item",{attrs:{label:"Field",prop:"jobField"}},[o("el-select",{staticStyle:{width:"30%"},on:{"visible-change":function(t){e.jobFieldChange(t,e.machineJobForm.jobAgg)}},model:{value:e.machineJobForm.jobField,callback:function(t){e.$set(e.machineJobForm,"jobField",t)},expression:"machineJobForm.jobField"}},e._l(e.$store.state.fieldYOptions,function(e,t){return o("el-option",{key:t,attrs:{label:e.value,value:e.value,disabled:e.disabled}})}))],1):e._e(),e._v(" "),o("el-form-item",{attrs:{label:"Time From",prop:"jobTimeFrom"}},[o("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期"},model:{value:e.machineJobForm.jobTimeFrom,callback:function(t){e.$set(e.machineJobForm,"jobTimeFrom",t)},expression:"machineJobForm.jobTimeFrom"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Time To",prop:"jobTimeTo"}},[o("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期"},model:{value:e.machineJobForm.jobTimeTo,callback:function(t){e.$set(e.machineJobForm,"jobTimeTo",t)},expression:"machineJobForm.jobTimeTo"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Interval",prop:"intervalNum"}},[o("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"时间间隔",disabled:e.machineJobForm.intervalLimitAble},model:{value:e.machineJobForm.intervalNum,callback:function(t){e.$set(e.machineJobForm,"intervalNum","string"==typeof t?t.trim():t)},expression:"machineJobForm.intervalNum"}}),e._v(" "),o("el-select",{staticStyle:{width:"30%"},attrs:{placeholder:"请选择"},on:{change:function(t){e.intervalLimit(e.machineJobForm.intervalUnit)}},model:{value:e.machineJobForm.intervalUnit,callback:function(t){e.$set(e.machineJobForm,"intervalUnit",t)},expression:"machineJobForm.intervalUnit"}},[e._l(e.intervalOptions,function(e){return[o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})]})],2)],1),e._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:e.createJobEnsure}},[e._v("确认")])],1)],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.createJobLoading,expression:"createJobLoading"}]},[o("loading")],1)],1)],1)},staticRenderFns:[]},b={data:function(){return{jobList:[],isCreateNewJobShow:!1,editedJob:{},editedJobId:null}},created:function(){this.$store.state.contentLoading=!0,this.getJobList()},methods:{getJobList:function(){var e=this,t=this,o=n.b+"ml/job";a.a.get(o).then(function(o){if(200==o.status){var i=o.data._items;t.jobList=i}else t.$message.error("操作失败: "+o._error.message);e.$store.state.contentLoading=!1}).catch(function(e){console.log(e)})},showCreatePop:function(){this.editedJobId=null,this.editedJob={},this.isCreateNewJobShow=!0},editJob:function(e){this.isCreateNewJobShow=!0,this.editedJob=e,this.editedJobId=e._id},deleteJob:function(e){var t=this;this.$confirm("确定要删除该机器作业吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var o=n.b+"ml/job/"+e;a.a.delete(o).then(function(e){console.log(e),t.getJobList(),t.$message({type:"success",message:"操作成功"})}).catch(function(e){console.log(e)})}).catch(function(){t.$message({type:"info",message:"操作已取消"})})}},components:{createNewJob:o("VU/8")(m,c,!1,null,null,null).exports}},h={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"jobManagement-wrapper"},[0==e.jobList.length?o("div",{staticClass:"nodata-box"},[e._v("暂无机器作业")]):e._e(),e._v(" "),o("table",[e._m(0),e._v(" "),o("tbody",e._l(e.jobList,function(t,i){return o("tr",[o("td",[e._v(e._s(t._id))]),e._v(" "),o("td",[e._v(e._s(t.name))]),e._v(" "),o("td",[e._v(e._s(t.task_type))]),e._v(" "),o("td",[e._v(e._s(t.description))]),e._v(" "),o("td",[e._v("closed")]),e._v(" "),o("td",[e._v("2018-12-11 16:06:35")]),e._v(" "),o("td",[e._v("2018-12-14 09:15:03")]),e._v(" "),o("td",{staticClass:"text-center"},[e._m(1,!0),e._v(" "),e._m(2,!0),e._v(" "),o("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"}},[o("i",{staticClass:"el-icon-edit-outline font-blue",on:{click:function(o){e.editJob(t)}}},[e._v("修改")])]),e._v(" "),o("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"}},[o("i",{staticClass:"el-icon-delete",on:{click:function(o){e.deleteJob(t._id)}}},[e._v("删除")])])])])}))]),e._v(" "),o("create-new-job",{attrs:{isShow:e.isCreateNewJobShow,editData:e.editedJob,editedJobId:e.editedJobId},on:{createNewJobClose:function(t){e.isCreateNewJobShow=!1},getJobListAgain:e.getJobList}}),e._v(" "),o("el-row",{staticClass:"createJobBtnbox"},[o("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.showCreatePop}},[e._v("create New Job")])],1),e._v(" "),o("el-row",{staticStyle:{"margin-top":"30px"}},[o("router-link",{staticClass:"chartTxt",attrs:{tag:"button",to:"/shadowview"}},[e._v("测试1")]),e._v(" "),o("router-link",{staticClass:"chartTxt",attrs:{tag:"button",to:"/aa"}},[e._v("测试2")])],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("thead",[t("tr",[t("th",[this._v("Job ID")]),this._v(" "),t("th",[this._v("Job Name")]),this._v(" "),t("th",[this._v("Job Type")]),this._v(" "),t("th",[this._v("Description")]),this._v(" "),t("th",[this._v("Job Status")]),this._v(" "),t("th",[this._v("Last Start Timestamp")]),this._v(" "),t("th",[this._v("Last Finish Timestamp")]),this._v(" "),t("th",{staticStyle:{"min-width":"60px"}})])])},function(){var e=this.$createElement,t=this._self._c||e;return t("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"}},[t("i",{staticClass:"el-icon-search"}),this._v("查询")])},function(){var e=this.$createElement,t=this._self._c||e;return t("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"}},[t("i",{staticClass:"el-icon-circle-check font-green"}),t("span",{attrs:{title:"点击开始任务"}},[this._v("开始")])])}]};var d=o("VU/8")(b,h,!1,function(e){o("jC99")},"data-v-39196827",null);t.default=d.exports},jC99:function(e,t){}});
//# sourceMappingURL=41.4b763bf7103f92cec837.js.map