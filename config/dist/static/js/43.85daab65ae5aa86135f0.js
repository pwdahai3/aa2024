webpackJsonp([43],{"2Mw7":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a("mtWM");var r=a("5reh"),s=a("gQxQ"),o=a("rBmc"),i=(a("yJCr"),{data:function(){return{behaviorform:{domain:"",url:"",prenum:""},behaviorformRules:{domain:[{required:!0,message:this.$t("lg.inputdomain"),trigger:"blur"}],url:[],prenum:[{required:!0,message:this.$t("lg.required"),trigger:"blur"},{pattern:/^[0-9]+$/,message:this.$t("lg.requirepositive"),trigger:"change"}]},querytimesData:[],queryTimesTreeProps:{children:"children",label:"label"},isShowTimingTask:!1}},methods:{getDomains:function(e){e&&(this.behaviorform.domain="",this.behaviorform.url="",this.$store.commit(r.b,!0))},getUrls:function(e){if(e){this.behaviorform.url="";var t=this.behaviorform.domain;this.$store.commit(r.c,{domain:t,flag:!0})}},getTokenTimesData:function(){var e=this;this.$refs.behaviorform.validate(function(t){if(t){var a=e,r=a.behaviorform.domain,i=a.behaviorform.url?'"'+a.behaviorform.url+'"':"*",n=a.behaviorform.prenum,l=a.$store.state.mydatedata.starttime,c=a.$store.state.mydatedata.endtime,u=Object(o.a)(l),m=Object(o.a)(c),d=u||Object(o.a)(new Date(Date.now()-a.$store.state.dateTimeLong)),h=m||Object(o.a)(new Date);a.$store.state.contentLoading=!0,s.a.search({index:"shadow-filebeat*",body:{size:0,query:{bool:{filter:[{range:{"@timestamp":{gte:d,lte:h}}}],must:[{query_string:{query:"shadow.access.error_code:0"}},{query_string:{query:"shadow.access.response_code:200"}},{bool:{should:[{query_string:{query:"shadow.access.decrypted:1"}},{query_string:{query:"shadow.access.api_indicator:1"}}]}},{term:{"shadow.access.http_host":r}},{query_string:{query:"shadow.access.org_url:"+i}}],must_not:[{match:{"shadow.access.token":"00000000000000000000000000000000"}},{match:{"shadow.access.token":"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"}}]}},aggs:{GroupByUrl:{terms:{field:"shadow.access.org_url",size:500},aggs:{GroupByToken:{terms:{field:"shadow.access.token",min_doc_count:n,size:500}}}}}}}).then(function(t){var a=[];t.aggregations.GroupByUrl.buckets.forEach(function(e){var t={label:e.key,children:[]};e.GroupByToken.buckets.forEach(function(e){t.children.push({label:e.key,counts:e.doc_count})}),t.children.length>0&&a.push(t)}),e.querytimesData=a,e.$store.state.contentLoading=!1})}})},queryTimesRenderContent:function(e,t){var a=t.node,r=t.data;t.store;return r.children?e("span",{class:"my-tree-node"},[e("span",null,[a.label])]):e("p",{class:"my-tree-node"},[e("span",null,["浏览器指纹：",a.label,"，其访问次数为：",r.counts,"次"])])}},components:{timingTaskPop:a("1r8X").a}}),n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"behavior-wrapper"},[a("h2",{staticClass:"breadcrumb"},[e._v(e._s(e.$t("lg.jiyucishu")))]),e._v(" "),a("el-form",{ref:"behaviorform",staticClass:"form-bg",staticStyle:{"padding-bottom":"0"},attrs:{model:e.behaviorform,rules:e.behaviorformRules,"label-width":"0"}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"grid-content"},[a("el-form-item",{attrs:{prop:"domain"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("lg.selectdomain"),loading:e.$store.state.getEsDomainArrLoading},on:{"visible-change":function(t){e.getDomains(t)}},model:{value:e.behaviorform.domain,callback:function(t){e.$set(e.behaviorform,"domain",t)},expression:"behaviorform.domain"}},[e._l(e.$store.state.esDomainArr,function(e){return[a("el-option",{key:e.key,attrs:{label:e.key,value:e.key}})]})],2)],1)],1)]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"grid-content"},[a("el-form-item",{attrs:{prop:"url"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("lg.selecturl"),clearable:"",loading:e.$store.state.getEsUrlArrLoading},on:{"visible-change":function(t){e.getUrls(t)}},model:{value:e.behaviorform.url,callback:function(t){e.$set(e.behaviorform,"url",t)},expression:"behaviorform.url"}},[e._l(e.$store.state.esUrlArr,function(e){return[a("el-option",{key:e.key,attrs:{label:e.key,value:e.key}})]})],2)],1)],1)]),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content"},[a("el-form-item",{attrs:{prop:"prenum"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("lg.countstobe")},model:{value:e.behaviorform.prenum,callback:function(t){e.$set(e.behaviorform,"prenum",t)},expression:"behaviorform.prenum"}})],1)],1)]),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content"},[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e.getTokenTimesData}},[e._v(e._s(e.$t("lg.query")))])],1)])],1)],1),e._v(" "),a("div",{staticClass:"myTreeBox"},[a("el-tree",{ref:"tree",attrs:{data:e.querytimesData,props:e.queryTimesTreeProps,"render-content":e.queryTimesRenderContent}})],1),e._v(" "),a("el-row",{staticClass:"text-right"},[a("el-button",{attrs:{type:"success",icon:"el-icon-time"},on:{click:function(t){e.isShowTimingTask=!0}}},[e._v(e._s(e.$t("lg.arrangealerting")))])],1),e._v(" "),a("timing-task-pop",{attrs:{isShow:e.isShowTimingTask,myTaskType:"tokenCount",myTaskTypeTxt:e.$t("lg.tokencountbased")},on:{setTimingTaskClose:function(t){e.isShowTimingTask=!1}}})],1)},staticRenderFns:[]};var l=a("VU/8")(i,n,!1,function(e){a("Nt8r")},"data-v-36a8ddbe",null);t.default=l.exports},Nt8r:function(e,t){}});
//# sourceMappingURL=43.85daab65ae5aa86135f0.js.map