webpackJsonp([14],{"/zvz":function(e,t,a){"use strict";var r=a("fZjL"),i=a.n(r),l=a("woOf"),s=a.n(l),o=a("mtWM"),n=a.n(o),d=(a("5reh"),a("yJCr")),g=(a("XLwt"),{props:{isShow:{type:Boolean},isDataTable:{type:Boolean},itemParams:{type:Object}},data:function(){return{chartLoadingShow:!1,tableHead:[],tableBody:[],curPage:1,pageSize:10,tableDataTotal:0}},created:function(){this.isDataTable||this.getDataTableData()},watch:{isShow:function(){this.isShow&&this.getDataTableData()}},methods:{getDataTableData:function(){var e=this;e.tableHead=[],e.tableBody=[],e.chartLoadingShow=!0;var t=d.b+"dp/es/datachart/process";console.log(e.itemParams),n.a.post(t,{chartType:"dataTable",description:"",params:e.itemParams,title:"dataTable"}).then(function(t){if(console.log(t),0==t.data.responseCode){var a=t.data.data.aggregations[2].buckets,r=[],l=[];e.itemParams.aggs.forEach(function(e,t){if("date_histogram"==e.agg)switch(e.interval.match(/(\d*)(\w*)/)[2]){case"s":r.push("@timestamp per "+e.interval.match(/(\d*)(\w*)/)[1]+" seconds");break;case"m":r.push("@timestamp per "+e.interval+" minutes");break;case"h":r.push("@timestamp per "+e.interval+" hours");break;case"d":r.push("@timestamp per "+e.interval+" days");break;case"w":r.push("@timestamp per "+e.interval+" weeks");break;case"M":r.push("@timestamp per "+e.interval+" months");break;default:r.push("@timestamp per "+e.interval+" years")}else"terms"==e.agg&&r.push(e.field)}),r.push("count");var o=r.map(function(e){if(e.indexOf("."))return e.split(".").join(" ")});!function t(a,r,o,n){0!=a.length&&a.forEach(function(a,d){o=s()({},o);var g=!1;if(i()(a).forEach(function(i){if(!isNaN(i)){if(g=!0,a.key_as_string){var l=e.transformMyDate(a.key);o[r[n++]]=l}else o[r[n++]]=a.key;t(a[i].buckets,r,o,n),n--}}),!g){if(o=s()({},o),a.key_as_string){var c=e.transformMyDate(a.key);o[r[n]]=c}else o[r[n]]=a.key;o.count=a.doc_count,l.push(o)}})}(a,o,{},0),e.tableHead=o,e.tableBody=l,e.tableDataTotal=l.length,e.chartLoadingShow=!1}else e.$message.error(e.$t("lg.failed")+": "+t.data.data.message),e.chartLoadingShow=!1}).catch(function(t){console.log(t),e.chartLoadingShow=!1}),e.$emit("changeFlag",!1)},handleCurrentChange:function(){console.log(this.curPage),console.log(this.pageSize)},sort_change:function(e,t,a){"descending"==e.order?this.tableBody.sort(function(t,a){return isNaN(t[e.prop])?new Date(t[e.prop]).getTime()-new Date(a[e.prop]).getTime():t[e.prop]-a[e.prop]}):"ascending"==e.order&&this.tableBody.sort(function(t,a){return isNaN(t[e.prop])?Date.parse(new Date(a[e.prop]))-Date.parse(new Date(t[e.prop])):a[e.prop]-t[e.prop]})},transformMyDate:function(e){function t(e){return e<10?"0"+e:e}return(e=new Date(e)).getFullYear()+"-"+t(parseInt(e.getMonth())+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())}}}),c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("p",{staticClass:"chartName"},[e._v("Data Table")]),e._v(" "),a("div",{staticClass:"tableBox"},[a("el-table",{attrs:{height:"560","empty-text":e.chartLoadingShow?e.$t("lg.loading"):e.$t("lg.nodata"),data:e.tableBody.slice((e.curPage-1)*e.pageSize,e.curPage*e.pageSize)},on:{"sort-change":e.sort_change}},[e._l(e.tableHead,function(e){return[a("el-table-column",{attrs:{"min-width":"340",prop:e,label:e,sortable:"custom"}})]})],2),e._v(" "),a("div",{staticClass:"mypage"},[a("el-pagination",{attrs:{"current-page":e.curPage,"page-size":e.pageSize,layout:"prev, pager, next, jumper",total:e.tableDataTotal},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.curPage=t}}})],1)],1)])},staticRenderFns:[]};var p=a("VU/8")(g,c,!1,function(e){a("gWKs")},"data-v-1f7f4971",null);t.a=p.exports},"9fht":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("mtWM"),i=a.n(r),l=a("yJCr"),s=a("5reh"),o=a("qqiS"),n=a("/zvz"),d={data:function(){return{aggregationMOptions:[{value:"count",label:"Count"}],aggregationSprOptions:[{value:"date_histogram",label:"Date Histogram"},{value:"terms",label:"Terms"}],intervalOptions:[{value:"s",label:this.$t("lg.second")},{value:"m",label:this.$t("lg.minite")},{value:"h",label:this.$t("lg.hour")},{value:"d",label:this.$t("lg.day")},{value:"w",label:this.$t("lg.week")},{value:"M",label:this.$t("lg.month")},{value:"y",label:this.$t("lg.year")}],orderByOptions:[{value:"metric:Count"}],orderOptions:[{value:"desc",label:"Descending"},{value:"asc",label:"Ascending"}],dataTableForm:{aggregationM:"count",dataTableSpr:[{aggregationSpr:""}]},dataTableFormRules:{aggregationM:[{required:!0,message:this.$t("lg.rquired"),trigger:"blur"}]},isSetChartShow:!1,setChartForm:{describeTxt:""},setChartFormRules:{describeTxt:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}]},setChartLoading:!1,myChartFlag:!1,itemParams:{}}},methods:{addItem:function(e){"metric"==e?this.dataTableForm.dataTableMetric.push({aggregationM:"",fieldM:""}):"splitRows"==e&&this.dataTableForm.dataTableSpr.push({aggregationSpr:""})},deleteItem:function(e,t){if("metric"==e){if(1==this.dataTableForm.dataTableMetric.length)return;this.dataTableForm.dataTableMetric.splice(t,1)}else if("splitRows"==e){if(1==this.dataTableForm.dataTableSpr.length)return;this.dataTableForm.dataTableSpr.splice(t,1)}},aggregationMchange:function(e){this.dataTableForm.dataTableMetric[e].fieldM=""},fieldMchange:function(e,t){this.$store.commit(s.d,t)},aggregationSprChange:function(e,t){"date_histogram"==e?(this.$set(this.dataTableForm.dataTableSpr[t],"fieldSpr","@timestamp"),this.dataTableForm.dataTableSpr[t].intervalNumSpr="500",this.dataTableForm.dataTableSpr[t].intervalLimitAble=!1,this.$set(this.dataTableForm.dataTableSpr[t],"intervalUnitSpr","s")):(this.$set(this.dataTableForm.dataTableSpr[t],"fieldSpr",""),this.dataTableForm.dataTableSpr[t].orderBySpr="metric:Count",this.dataTableForm.dataTableSpr[t].sizeSpr="5",this.$set(this.dataTableForm.dataTableSpr[t],"orderSpr","desc"))},fieldSprChange:function(e,t){this.$store.commit(s.d,t)},intervalLimit:function(e,t){"w"==e||"M"==e||"y"==e?(this.dataTableForm.dataTableSpr[t].intervalNumSpr="1",this.dataTableForm.dataTableSpr[t].intervalLimitAble=!0):this.dataTableForm.dataTableSpr[t].intervalLimitAble=!1},getDataTableData:function(){var e=this;this.$refs.dataTableForm.validate(function(t){if(t){var a=e;a.tableHead=[],a.tableBody=[],a.chartLoadingShow=!0;l.b;var r=a.$store.state.mydatedata.starttime,i=a.$store.state.mydatedata.endtime,s=r.getTime(),o=i.getTime(),n=[];a.dataTableForm.dataTableSpr.forEach(function(e){"date_histogram"==e.aggregationSpr?n.push({agg:"date_histogram",field:"@timestamp",interval:e.intervalNumSpr+e.intervalUnitSpr,min_doc_count:1}):"terms"==e.aggregationSpr&&n.push({agg:e.aggregationSpr,field:e.fieldSpr,size:e.sizeSpr,order:{_count:e.orderSpr}})});var d={timeRange:{from:s,to:o},aggs:n};a.myChartFlag=!0,a.itemParams=d}})},fatherChange:function(){this.myChartFlag=!1},showSetChart:function(){var e=this;this.$refs.dataTableForm.validate(function(t){t&&(e.isSetChartShow=!0)})},setChartClose:function(){this.isSetChartShow=!1,this.$refs.setChartForm.resetFields()},setDataTableData:function(){var e=this;this.$refs.setChartForm.validate(function(t){if(t){var a=e;a.setChartLoading=!0;var r=l.b+"dp/es/datachart",s=a.$store.state.mydatedata.starttime,o=a.$store.state.mydatedata.endtime,n=s.getTime(),d=o.getTime(),g=[];a.dataTableForm.dataTableSpr.forEach(function(e){"date_histogram"==e.aggregationSpr?g.push({agg:"date_histogram",field:"@timestamp",interval:e.intervalNumSpr+e.intervalUnitSpr,min_doc_count:1}):"terms"==e.aggregationSpr&&g.push({agg:e.aggregationSpr,field:e.fieldSpr,size:e.sizeSpr,order:{_count:e.orderSpr}})});var c={timeRange:{from:n,to:d},aggs:g};i.a.post(r,{chartType:"dataTable",description:a.setChartForm.describeTxt,params:c,title:"dataTable"}).then(function(t){console.log(t),0==t.data.responseCode?(e.$message({type:"success",message:a.$t("lg.success")}),a.setChartLoading=!1,a.setChartClose()):(a.$message.error(a.$t("lg.failed")+": "+t.data.data.message),a.setChartLoading=!1)}).catch(function(e){console.log(e)})}})}},components:{loading:o.a,dataTabPic:n.a}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dataTable-wrapper"},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:8}},[a("el-form",{ref:"dataTableForm",attrs:{model:e.dataTableForm,rules:e.dataTableFormRules,"label-width":"120px"}},[a("div",{staticClass:"form-bg"},[a("p",{staticClass:"chartformTitle"},[e._v("Metric")]),e._v(" "),a("el-form-item",{attrs:{label:"Aggregation",prop:"aggregationM"}},[a("el-select",{staticStyle:{width:"60%"},model:{value:e.dataTableForm.aggregationM,callback:function(t){e.$set(e.dataTableForm,"aggregationM",t)},expression:"dataTableForm.aggregationM"}},e._l(e.aggregationMOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),a("div",{staticClass:"form-bg"},[a("p",{staticClass:"chartformTitle"},[e._v("Split Rows")]),e._v(" "),e._l(e.dataTableForm.dataTableSpr,function(t,r){return a("div",{key:r,staticClass:"addItemBox"},[a("span",{staticClass:"delItemStyle",on:{click:function(t){e.deleteItem("splitRows",r)}}},[a("i",{staticClass:"el-icon-close"})]),e._v(" "),a("el-form-item",{attrs:{label:"Aggregation",prop:"dataTableSpr."+r+".aggregationSpr",rules:[{required:!0,message:e.$t("lg.required"),trigger:"blur"}]}},[a("el-select",{staticStyle:{width:"60%"},on:{change:function(a){e.aggregationSprChange(t.aggregationSpr,r)}},model:{value:t.aggregationSpr,callback:function(a){e.$set(t,"aggregationSpr",a)},expression:"items.aggregationSpr"}},e._l(e.aggregationSprOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),t.aggregationSpr?a("el-form-item",{attrs:{label:"Field",prop:"dataTableSpr."+r+".fieldSpr",rules:[{required:!0,message:e.$t("lg.required"),trigger:"blur"}]}},[a("el-select",{staticStyle:{width:"70%"},on:{"visible-change":function(a){e.fieldSprChange(a,t.aggregationSpr)}},model:{value:t.fieldSpr,callback:function(a){e.$set(t,"fieldSpr",a)},expression:"items.fieldSpr"}},e._l(e.$store.state.fieldYOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.value,value:e.value,disabled:e.disabled}})}))],1):e._e(),e._v(" "),"date_histogram"==t.aggregationSpr?a("div",[a("el-form-item",{attrs:{label:"Interval",prop:"dataTableSpr."+r+".intervalNumSpr",rules:[{required:!0,message:e.$t("lg.required"),trigger:"blur"},{pattern:/^[0-9]+$/,message:e.$t("lg.required"),trigger:"change"}]}},[a("el-input",{staticStyle:{width:"45%"},attrs:{placeholder:e.$t("lg.interval"),disabled:t.intervalLimitAble},model:{value:t.intervalNumSpr,callback:function(a){e.$set(t,"intervalNumSpr","string"==typeof a?a.trim():a)},expression:"items.intervalNumSpr"}}),e._v(" "),a("el-select",{staticStyle:{width:"35%"},attrs:{placeholder:e.$t("lg.select")},on:{change:function(a){e.intervalLimit(t.intervalUnitSpr,r)}},model:{value:t.intervalUnitSpr,callback:function(a){e.$set(t,"intervalUnitSpr",a)},expression:"items.intervalUnitSpr"}},e._l(e.intervalOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1):e._e(),e._v(" "),"terms"==t.aggregationSpr?a("div",[a("el-form-item",{attrs:{label:"Order By",prop:"dataTableSpr."+r+".orderBySpr",rules:[{required:!0,message:e.$t("lg.required"),trigger:"blur"}]}},[a("el-select",{staticStyle:{width:"60%"},attrs:{placeholder:e.$t("lg.select")},model:{value:t.orderBySpr,callback:function(a){e.$set(t,"orderBySpr",a)},expression:"items.orderBySpr"}},e._l(e.orderByOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"Size",prop:"dataTableSpr."+r+".sizeSpr",rules:[{required:!0,message:e.$t("lg.required"),trigger:"blur"},{pattern:/^[0-9]+$/,message:"必须为正整数数值",trigger:"change"}]}},[a("el-input",{staticStyle:{width:"45%"},attrs:{placeholder:"size"},model:{value:t.sizeSpr,callback:function(a){e.$set(t,"sizeSpr","string"==typeof a?a.trim():a)},expression:"items.sizeSpr"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Order",prop:"dataTableSpr."+r+".orderSpr",rules:[{required:!0,message:e.$t("lg.required"),trigger:"blur"}]}},[a("el-select",{staticStyle:{width:"60%"},attrs:{placeholder:e.$t("lg.select")},model:{value:t.orderSpr,callback:function(a){e.$set(t,"orderSpr",a)},expression:"items.orderSpr"}},e._l(e.orderOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1):e._e()],1)}),e._v(" "),a("span",{staticClass:"addItemStyle",attrs:{title:e.$t("lg.required")},on:{click:function(t){e.addItem("splitRows")}}},[a("i",{staticClass:"el-icon-circle-plus-outline"})])],2),e._v(" "),a("div",{staticClass:"form-bg"},[a("el-button",{attrs:{size:"small",type:"primary",icon:"fa fa-play"},on:{click:e.getDataTableData}},[e._v(" "+e._s(e.$t("lg.generateview")))]),e._v(" "),a("el-button",{attrs:{size:"small",type:"success",icon:"fa fa-cloud"},on:{click:e.showSetChart}},[e._v(" "+e._s(e.$t("lg.saverecord")))])],1)])],1),e._v(" "),a("el-col",{attrs:{span:16}},[a("div",{staticClass:"chartBox"},[a("data-tab-pic",{attrs:{isShow:e.myChartFlag,itemParams:e.itemParams,isDataTable:!0},on:{changeFlag:e.fatherChange}})],1),e._v(" "),a("router-link",{attrs:{to:"/chartMenu"}},[a("el-button",{staticClass:"backBtn el-icon-back",attrs:{size:"small",type:"info",plain:""}},[e._v(" "+e._s(e.$t("lg.back")))])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.$t("lg.saveviewrecord"),visible:e.isSetChartShow,width:"45%","before-close":e.setChartClose},on:{"update:visible":function(t){e.isSetChartShow=t}}},[a("el-form",{ref:"setChartForm",attrs:{model:e.setChartForm,rules:e.setChartFormRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:e.$t("lg.viewdesc"),prop:"describeTxt"}},[a("el-input",{attrs:{placeholder:e.$t("lg.description")},model:{value:e.setChartForm.describeTxt,callback:function(t){e.$set(e.setChartForm,"describeTxt","string"==typeof t?t.trim():t)},expression:"setChartForm.describeTxt"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.setDataTableData}},[e._v(" "+e._s(e.$t("lg.yes")))])],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.setChartLoading,expression:"setChartLoading"}]},[a("loading",{attrs:{title:e.$t("lg.handling")}})],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(d,g,!1,function(e){a("Y1sh")},"data-v-9dab8318",null);t.default=c.exports},Y1sh:function(e,t){},gWKs:function(e,t){}});
//# sourceMappingURL=14.76480e3e16375c2b5eec.js.map