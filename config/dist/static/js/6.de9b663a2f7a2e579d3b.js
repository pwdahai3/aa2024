webpackJsonp([6],{"7tBt":function(a,t){},"N+Ex":function(a,t){},ZzkL:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=e("woOf"),i=e.n(s),r=e("Dd8w"),n=e.n(r),l=e("fZjL"),o=e.n(l),c=e("Gu7T"),m=e.n(c),d=e("mtWM"),p=e.n(d),u=(e("5reh"),e("gQxQ")),g=e("T+n0"),_=e("rBmc"),h=e("yJCr"),v=e("1r8X"),k={props:{taskTypeDisabledObj:{type:Object}},data:function(){return{isShowSelect:!1,taskTypeOptions:[{value:"urlCompare",label:this.$t("lg.objbased")},{value:"apiScan",label:this.$t("lg.apiScanbased")},{value:"tokenTime",label:this.$t("lg.tokentimebased")},{value:"tokenCount",label:this.$t("lg.tokencountbased")},{value:"esSearch",label:this.$t("lg.customesqbased")},{value:"maliciousAccess",label:this.$t("lg.maccessyuanipbased")},{value:"maliciousAccessOrg",label:this.$t("lg.maccessorgipbased")},{value:"maliciousAttack",label:this.$t("lg.mattackyuanipbased")},{value:"cpuMax",label:this.$t("lg.cpubased"),disabled:!1},{value:"cpu_cmMax",label:"基于‘管理平台的CPU’报警",disabled:!1},{value:"memoryMax",label:this.$t("lg.memorybased"),disabled:!1},{value:"memory_cmMax",label:"基于‘管理平台的MEMORY’报警",disabled:!1},{value:"diskRootMax",label:this.$t("lg.diskRootbased"),disabled:!1},{value:"diskRoot_cmMax",label:"基于‘管理平台的磁盘空间（/）’报警",disabled:!1},{value:"diskRoot01Max",label:this.$t("lg.diskRoot01based"),disabled:!1},{value:"diskRoot01_cmMax",label:"基于‘管理平台的磁盘空间（/home）’报警",disabled:!1}],taskTypeValue:"",alarmTaskType:"",alarmTaskTypeTxt:"",alertMark:"",isShowTimingTask:!1,hasNextStep:!1}},watch:{isShowSelect:function(){this.isShowSelect&&this.judgeTaskTypeOptDisable()},isShowTimingTask:function(){this.isShowTimingTask||(this.taskTypeValue="",this.isShowSelect=!1)}},methods:{judgeTaskTypeOptDisable:function(){var a=this.taskTypeDisabledObj;for(var t in a)this.taskTypeOptions.forEach(function(e){e.value==t&&(e.disabled=a[t])})},getCorrespondingTaskPop:function(a){var t="";this.hasNextStep=!1,this.taskTypeOptions.forEach(function(e){a==e.value&&(t=e.label)}),this.alarmTaskTypeTxt=t,"urlCompare"==a||"apiScan"==a||"tokenTime"==a||"tokenCount"==a||"esSearch"==a?(this.alarmTaskType=a,this.alertMark="","esSearch"==a&&(this.hasNextStep=!0)):"maliciousAccess"!=a&&"maliciousAccessOrg"!=a&&"maliciousAttack"!=a&&"cpuMax"!=a&&"memoryMax"!=a&&"networkMax"!=a&&"diskRootMax"!=a&&"diskRoot01Max"!=a&&"cpu_cmMax"!=a&&"memory_cmMax"!=a&&"diskRoot_cmMax"!=a&&"diskRoot01_cmMax"!=a||(this.alarmTaskType="esSearch",this.alertMark=a),this.isShowTimingTask=!0},getTimingTask:function(){this.$emit("getTimingTask")}},components:{timingTaskPop:v.a}},y={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",[e("div",{staticClass:"form-bg"},[e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:2.5}},[e("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(t){a.isShowSelect=!0}}},[a._v(a._s(a.$t("lg.add")))])],1),a._v(" "),e("el-col",{attrs:{span:6}},[e("el-select",{directives:[{name:"show",rawName:"v-show",value:a.isShowSelect,expression:"isShowSelect"}],staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:a.$t("lg.addalertingtype")},on:{change:a.getCorrespondingTaskPop},model:{value:a.taskTypeValue,callback:function(t){a.taskTypeValue=t},expression:"taskTypeValue"}},a._l(a.taskTypeOptions,function(a){return e("el-option",{key:a.value,attrs:{label:a.label,value:a.value,disabled:a.disabled}})}))],1)],1)],1),a._v(" "),e("timing-task-pop",{attrs:{isShow:a.isShowTimingTask,isNeedRefreshAddTask:!0,hasNextStep:a.hasNextStep,myTaskType:a.alarmTaskType,myTaskTypeTxt:a.alarmTaskTypeTxt,alertmark:a.alertMark},on:{getTimingTask:a.getTimingTask,setTimingTaskClose:function(t){a.isShowTimingTask=!1}}})],1)},staticRenderFns:[]};var T=e("VU/8")(k,y,!1,function(a){e("N+Ex")},null,null).exports,f=e("GfiX"),b=e("7uT9"),x=e("EjLO"),w=e("j5eg"),$=e("ufP2"),C=e("InnB"),I={mixins:[$.a],components:{addAlarmTask:T,timingTaskPop:v.a,logRebuild:b.a,logagg:w.a,logTables:x.a},data:function(){return{timeVisible:!1,timesVisible:!1,esSearchVisible:!1,isShowTimingTaskEdit:!1,editTaskId:null,queryTimeData:[],queryTimeTreeProps:{children:"children",label:"label"},querytimesData:[],queryTimesTreeProps:{children:"children",label:"label"},timingTask:[],editTaskItem:{},alertMark:"",logId:"",tbodyArr:[],tableKeyArrTask:[],taskLogsHeadData:[],taskLogsBodyData:[],taskTotalNum:0,piedata:{},linechartdata:{},isQueryOrAggsObj:"",isQueryOrAggs:!1,taskTypeDisabledObj:{cpuMax:!1,memoryMax:!1,networkMax:!1,diskRootMax:!1,diskRoot01Max:!1,cpu_cmMax:!1,memory_cmMax:!1,diskRoot_cmMax:!1,diskRoot01_cmMax:!1},filterObj:{match_all:{}},itemInfo:{}}},created:function(){this.$store.state.contentLoading=!0,this.getTimingTask()},methods:{getCustomHeadData:function(a){var t=this;if("waf.log"==a){this.tableKeyArrTask=[].concat(m()(f.a.waf));var e=h.b+"/pe/shadow/kv/taskWaf";p.a.get(e).then(function(a){a.data.data?t.taskLogsHeadData=a.data.data.value:t.taskLogsHeadData=[].concat(m()(f.a.waf))})}else if("access.log"==a){this.tableKeyArrTask=[].concat(m()(f.a.access));var s=h.b+"/pe/shadow/kv/taskAccess";p.a.get(s).then(function(a){a.data.data?t.taskLogsHeadData=a.data.data.value:t.taskLogsHeadData=[].concat(m()(f.a.access))})}},refilterColByTask:function(a){if("waf.log"===this.logId){var t=h.b+"/pe/shadow/kv";if(!a.length)return!1;p.a.post(t,{taskWaf:a}).then(function(e){o()(e.data.data.Failure)&&p.a.patch(t,{taskWaf:a}).then(function(a){})}),this.taskLogsHeadData=a}else if("access.log"===this.logId){t=h.b+"/pe/shadow/kv";p.a.post(t,{taskAccess:a}).then(function(e){o()(e.data.data.Failure)&&p.a.patch(t,{taskAccess:a}).then(function(a){})}),this.taskLogsHeadData=a}},requeryRowByTask:function(a){this.filterObj=a.requeryObj,this.searchTime(this.itemInfo,{curPage:1,pageNum:10},!0),this.$refs.log_tables&&(this.$refs.log_tables.tabCurPage=1)},getTimingTask:function(){var a=this,t=h.b+"monitoring/scheduling/tasks";a.taskTypeDisabledObj={cpuMax:!1,memoryMax:!1,networkMax:!1,diskRootMax:!1,diskRoot01Max:!1,cpu_cmMax:!1,memory_cmMax:!1,diskRoot_cmMax:!1,diskRoot01_cmMax:!1},p.a.get(t).then(function(t){if(0==t.data.responseCode){var e=t.data.data;e.map(function(t,e){switch(t.rate=t.frequency.match(/(\d*)(\w*)/)[1],t.rateUnitValue=t.frequency.match(/(\d*)(\w*)/)[2],t.rateUnitValue){case"m":t.rateUnitValueTxt=a.$t("lg.minite");break;case"h":t.rateUnitValueTxt=a.$t("lg.hour");break;case"d":t.rateUnitValueTxt=a.$t("lg.day");break;case"w":t.rateUnitValueTxt=a.$t("lg.week");break;default:t.rateUnitValueTxt=a.$t("lg.year")}if("urlCompare"==t.taskType){switch(t.params.timeStrInterval=t.params.strInterval.match(/(\d*)(\w*)/)[1],t.params.strIntervalUnitVal=t.params.strInterval.match(/(\d*)(\w*)/)[2],t.params.strIntervalUnitVal){case"s":t.params.strIntervalUnitValTxt=a.$t("lg.second");break;case"m":t.params.strIntervalUnitValTxt=a.$t("lg.minite");break;case"h":t.params.strIntervalUnitValTxt=a.$t("lg.hour");break;default:t.params.strIntervalUnitValTxt=a.$t("lg.day")}switch(t.params.timeLteInterval=t.params.lteInterval.match(/(\d*)(\w*)/)[1],t.params.lteIntervalUnitVal=t.params.lteInterval.match(/(\d*)(\w*)/)[2],t.params.lteIntervalUnitVal){case"s":t.params.lteIntervalUnitValTxt=a.$t("lg.second");break;case"m":t.params.lteIntervalUnitValTxt=a.$t("lg.minite");break;case"h":t.params.lteIntervalUnitValTxt=a.$t("lg.hour");break;default:t.params.lteIntervalUnitValTxt=a.$t("lg.day")}if(t.params.addToConfig)switch(t.params.dfRequestTimeVal=t.params.defaultRequestTime.match(/(\d*)(\w*)/)[1],t.params.requestTimeUnitVal=t.params.defaultRequestTime.match(/(\d*)(\w*)/)[2],t.params.requestTimeUnitVal){case"ms":t.params.requestTimeUnitValTxt=a.$t("lg.ms");break;default:t.params.requestTimeUnitValTxt=a.$t("lg.second")}}else switch(t.params.timeInterval=t.params.interval.match(/(\d*)(\w*)/)[1],t.params.intervalUnitVal=t.params.interval.match(/(\d*)(\w*)/)[2],t.params.intervalUnitVal){case"s":t.params.intervalUnitValTxt=a.$t("lg.second");break;case"m":t.params.intervalUnitValTxt=a.$t("lg.minite");break;case"h":t.params.intervalUnitValTxt=a.$t("lg.hour");break;default:t.params.intervalUnitValTxt=a.$t("lg.day")}if("stop"==t.status?t.taskStatu=a.$t("lg.stop"):"running"==t.status&&(t.taskStatu=a.$t("lg.running")),"tokenTime"==t.taskType)t.taskTypeTxt=a.$t("lg.tokentimebased");else if("tokenCount"==t.taskType)t.taskTypeTxt=a.$t("lg.tokencountbased");else if("esSearch"==t.taskType)switch(t.params.alertmark){case"maliciousAccess":t.taskTypeTxt=a.$t("lg.maccessyuanipbased");break;case"maliciousAccessOrg":t.taskTypeTxt=a.$t("lg.maccessorgipbased");break;case"maliciousAttack":t.taskTypeTxt=a.$t("lg.mattackyuanipbased");break;case"cpuMax":t.taskTypeTxt=a.$t("lg.cpubased"),a.taskTypeDisabledObj.cpuMax=!0;break;case"cpu_cmMax":t.taskTypeTxt="基于‘管理平台的CPU’报警",a.taskTypeDisabledObj.cpu_cmMax=!0;break;case"memoryMax":t.taskTypeTxt=a.$t("lg.memorybased"),a.taskTypeDisabledObj.memoryMax=!0;break;case"memory_cmMax":t.taskTypeTxt="基于‘管理平台的MEMORY’报警",a.taskTypeDisabledObj.memory_cmMax=!0;break;case"networkMax":t.taskTypeTxt=a.$t("lg.networkbased"),a.taskTypeDisabledObj.networkMax=!0;break;case"diskRootMax":t.taskTypeTxt=a.$t("lg.diskRootbased"),a.taskTypeDisabledObj.diskRootMax=!0;break;case"diskRoot_cmMax":t.taskTypeTxt="基于‘管理平台的磁盘空间（/）’报警",a.taskTypeDisabledObj.diskRoot_cmMax=!0;break;case"diskRoot01Max":t.taskTypeTxt=a.$t("lg.diskRoot01based"),a.taskTypeDisabledObj.diskRoot01Max=!0;break;case"diskRoot01_cmMax":t.taskTypeTxt="基于‘管理平台的磁盘空间（/home）’报警",a.taskTypeDisabledObj.diskRoot01_cmMax=!0;break;default:t.taskTypeTxt=a.$t("lg.customesqbased")}else"urlCompare"==t.taskType?t.taskTypeTxt=a.$t("lg.objbased"):"apiScan"==t.taskType&&(t.taskTypeTxt=a.$t("lg.apiScanbased"))}),a.timingTask=e,a.$store.state.contentLoading=!1}else a.$message.error(a.$t("lg.failed")+": "+t.data.data.message)}).catch(function(a){console.log(a)})},esSearchDataChange:function(a){this.searchTime(this.isQueryOrAggsObj,a)},searchTime:function(a,t,e){var s=this;if(this.itemInfo=n()({},a),t){var i=0,r=0,l="5m";t.curPage?(i=(t.curPage-1)*t.pageNum,r=t.pageNum):l=t}var o=0;switch(a.params.intervalUnitVal){case"m":o=60*a.params.timeInterval*1e3;break;case"h":o=60*a.params.timeInterval*60*1e3;break;default:o=24*a.params.timeInterval*60*60*1e3}var c=new Date(Date.now()-o),m=new Date(Date.now());if(this.isQueryOrAggs=!1,"tokenTime"==a.taskType){var d=Object(_.a)(c),p=Object(_.a)(m),h=a.params.domain,v="*"==a.params.url?"*":'"'+a.params.url+'"',k=a.params.times,y=a.params.count;u.a.search({index:"shadow-filebeat*",body:{size:0,query:{bool:{filter:[{range:{"@timestamp":{gte:d,lte:p}}}],must:[{query_string:{query:"shadow.access.error_code:0"}},{query_string:{query:"shadow.access.response_code:200"}},{bool:{should:[{query_string:{query:"shadow.access.decrypted:1"}},{query_string:{query:"shadow.access.api_indicator:1"}}]}},{term:{"shadow.access.http_host":h}},{query_string:{query:"shadow.access.org_url:"+v}}],must_not:[{match:{"shadow.access.token":"00000000000000000000000000000000"}},{match:{"shadow.access.token":"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"}}]}},aggs:{GroupByUrl:{terms:{field:"shadow.access.org_url",size:500},aggs:{GroupByToken:{terms:{field:"shadow.access.token",size:500},aggs:{avg_starttime:{avg:{field:"shadow.access.send_time"}},avg_endtime:{avg:{field:"shadow.access.rec_time"}},avg_time:{bucket_script:{buckets_path:{avg_starttime:"avg_starttime",avg_endtime:"avg_endtime"},script:"params.avg_endtime-params.avg_starttime"}},suspects:{scripted_metric:{init_script:"params._agg.suspects=[]",map_script:"params._agg.suspects.add(Long.parseLong(params._source.shadow.access.rec_time)-Long.parseLong(params._source.shadow.access.send_time))",combine_script:"ArrayList list=new ArrayList();for(s in params._agg.suspects){list.add(s);}return list",reduce_script:"double total_time=0;int length=0;for(a in params._aggs){for(i in a){total_time+=i;length+=1;}}double avg_time=total_time/length;int count=0;for(a in params._aggs){for(i in a){if(i>(avg_time*"+k+")){count+=1;}}}if(count>="+y+"){return count;}else{return null;}"}}}}}}}}}).then(function(a){var t=[];a.aggregations.GroupByUrl.buckets.forEach(function(a){var e={label:a.key,children:[]};a.GroupByToken.buckets.forEach(function(a){a.suspects.value&&e.children.push({label:a.key,counts:a.doc_count,avgTime:(a.avg_time.value/1e3).toFixed(2),suspects:a.suspects.value})}),t.push(e)}),s.queryTimeData=t,s.timeVisible=!0})}else if("tokenCount"==a.taskType){d=Object(_.a)(c),p=Object(_.a)(m),h=a.params.domain,v="*"==a.params.url?"*":'"'+a.params.url+'"';var T=a.params.count;u.a.search({index:"shadow-filebeat*",body:{size:10,query:{bool:{filter:[{range:{"@timestamp":{gte:d,lte:p}}}],must:[{query_string:{query:"shadow.access.error_code:0"}},{query_string:{query:"shadow.access.response_code:200"}},{bool:{should:[{query_string:{query:"shadow.access.decrypted:1"}},{query_string:{query:"shadow.access.api_indicator:1"}}]}},{term:{"shadow.access.http_host":h}},{query_string:{query:"shadow.access.org_url:"+v}}],must_not:[{match:{"shadow.access.token":"00000000000000000000000000000000"}},{match:{"shadow.access.token":"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"}}]}},aggs:{GroupByUrl:{terms:{field:"shadow.access.org_url",size:500},aggs:{GroupByToken:{terms:{field:"shadow.access.token",min_doc_count:T,size:500}}}}}}}).then(function(a){var t=[];a.aggregations.GroupByUrl.buckets.forEach(function(a){var e={label:a.key,children:[]};a.GroupByToken.buckets.forEach(function(a){e.children.push({label:a.key,counts:a.doc_count})}),e.children.length>0&&t.push(e)}),s.querytimesData=t,s.timesVisible=!0})}else if("esSearch"==a.taskType){var f=this;if(f.logId=a.params.logId,e||f.getCustomHeadData(a.params.logId),f.isQueryOrAggsObj=a,"access.log"==a.params.logId)d=Object(_.a)(c),p=Object(_.a)(m);else d=Object(g.a)(c),p=Object(g.a)(m);for(var b="/usr/local/shadow/logs/"+("waf.log"==a.params.logId?"shadow_"+a.params.logId:a.params.logId),x=a.params.tmpsArray.length,w=[],$=[],I=0;I<x;I++){var M=a.params.tmpsArray[I].andorId;w[I]="OR"===M?"should":"must";var S=a.params.tmpsArray[I].symbolId||"等于";"包含"==S?$[I]="wildcard":"等于"==S&&($[I]="match")}x>=2&&(w[x-1]=w[x-2]);var D={must:[{term:{"log.file.path":b}},{range:{"@timestamp":{from:d,to:p,include_lower:!0,include_upper:!0}}}],should:[],filter:f.filterObj};"access.log"==a.params.logId?D.must.push({exists:{field:"shadow.access.method"}}):D.must_not={exists:{field:"error"}};for(var q=0;q<x;q++){var O=w[q],V=a.params.tmpsArray[q].keyId,R=a.params.tmpsArray[q].keyinputId,j={};if("wildcard"==$[q]){var U="*"+R+"*";j[V]=U,D[O].push({wildcard:j})}else"match"==$[q]&&(j[V]=R,D[O].push({match:j}))}var A=a.params.aggsId,L={};if(A){var B=l,E=parseInt(a.params.metricinputId)||1;L={GroupByMe:{terms:{field:A,min_doc_count:E,size:5},aggs:{time_his:{date_histogram:{field:"@timestamp",interval:B,min_doc_count:0}}}}},f.isQueryOrAggs=!0}var N={index:"shadow-filebeat*",body:{size:10,query:{bool:D},aggs:L}};A||(N.from=i,N.size=r),u.a.search(N).then(function(t){if(f.esSearchVisible=!0,A){if(t.aggregations.GroupByMe.buckets.length>0){var e=t.aggregations.GroupByMe.buckets;f.tbodyArr=e;for(var s=[],i=[],r=[],n=[],l=[],o=0;o<e.length;o++)for(var c=e[o],m=0;m<c.time_his.buckets.length;m++){var d=c.time_his.buckets[m];l.includes(d.key)||l.push(d.key)}l.sort(function(a,t){return a-t});for(var p=0;p<e.length;p++){var u=e[p],g=l.map(function(a){return 0}),_=void 0;(_=u.key?u.key.toString():" ").length>40&&(_=_.slice(0,36)+"..."+_.slice(_.length-4-1)),s.push(_),i.push({value:u.doc_count,name:_});for(var h=0;h<u.time_his.buckets.length;h++){var v=u.time_his.buckets[h];g[l.indexOf(v.key)]=v.doc_count}r.push({name:_,type:"line",data:g})}n="access.log"==a.params.logId?l.map(function(a){return f.transformMyDate(a)}):l.map(function(a){return f.transformMyDate2(a)}),f.piedata={legend:s,data:i},f.linechartdata={legend:s,xaxisdata:n,seriesdata:r}}}else{var k=t.hits.hits;if(f.tbodyArr=k,f.taskTotalNum=t.hits.total.value,t.hits.total.value>0){f.taskLogsBodyData=[];var y=[];if("waf.log"==a.params.logId)y=Object(C.e)(k);else if("access.log"==a.params.logId)y=Object(C.c)(k);else if("error.log"==a.params.logId){var T=f.$options.filters.toSdDate;k.forEach(function(a){var t=a._source,e={};e.date=T(t.read_timestamp),e.level=t.shadow.error.level,e.message=t.shadow.error.message,y.push(e)})}f.taskLogsBodyData=y}}}).catch(function(a){console.log(a)})}},transformMyDate:function(a){function t(a){return a<10?"0"+a:a}return a=new Date(a),t(parseInt(a.getMonth())+1)+"-"+t(a.getDate())+" "+t(a.getHours())+":"+t(a.getMinutes())},transformMyDate2:function(a){function t(a){return a<10?"0"+a:a}return a=new Date(a-288e5),t(parseInt(a.getMonth())+1)+"-"+t(a.getDate())+" "+t(a.getHours())+":"+t(a.getMinutes())},operationTask:function(a){var t=this;a.taskStatu=t.$t("lg.handling");var e=a.id,s="";"stop"==a.status?s="start":"running"==a.status&&(s="stop");var i=h.b+"monitoring/scheduling/tasks/"+e+"?option="+s;p.a.post(i,{}).then(function(a){0==a.data.responseCode?(t.$message({type:"success",message:t.$t("lg.success")}),t.getTimingTask()):t.$message.error(t.$t("lg.failed")+": "+a.data.data.message)}).catch(function(a){console.log(a)})},editTask:function(a){"running"!=a.status?(this.editTaskId=a.id,this.editTaskItem=i()({},a),a.params.alertmark?this.alertMark=a.params.alertmark:this.alertMark="",this.isShowTimingTaskEdit=!0):this.$message.error(this.$t("lg.isrunningandstop"))},deleteTask:function(a){var t=this,e=this;"running"!=a.status?e.$confirm(e.$t("lg.isdelete"),e.$t("lg.tip"),{confirmButtonText:e.$t("lg.yes"),cancelButtonText:e.$t("lg.cancel"),type:"warning"}).then(function(){e.$store.state.contentLoading=!0;var t=h.b+"monitoring/scheduling/tasks/"+a.id;p.a.delete(t).then(function(a){0==a.data.responseCode?(e.getTimingTask(),e.$message({type:"success",message:e.$t("lg.success")}),e.$refs.addAlarmTask.isShowSelect=!1):e.$message.error(e.$t("lg.failed")+": "+a.data.data.message),e.$store.state.contentLoading=!1}).catch(function(a){console.log(a)})}).catch(function(){t.$message({type:"info",message:e.$t("lg.cancel")})}):e.$message.error(e.$t("lg.isrunningandstop"))},timeClose:function(){this.timeVisible=!1,this.queryTimeData=[]},timesClose:function(){this.timesVisible=!1,this.querytimesData=[]},esSearchClose:function(){this.esSearchVisible=!1,this.isQueryOrAggsObj="",this.qinterval="5m",this.tbodyArr=[],this.broadcast("logRequery","clearData"),this.filterObj={match_all:{}}},showSDURLMenu:function(a){this.taskLogsBodyData.forEach(function(a){a.showUMenuList=!1}),this.$set(this.taskLogsBodyData[a],"showUMenuList",!0)},hideSDURLMenu:function(){this.taskLogsBodyData.forEach(function(a){a.showUMenuList=!1})},queryTimeRenderContent:function(a,t){var e=t.node,s=t.data;t.store;return s.children?a("span",{class:"my-tree-node"},[a("span",null,[e.label])]):a("span",{class:"my-tree-node"},[a("span",null,["浏览器指纹：",e.label,"，其平均访问时间为：",s.avgTime,"秒，访问次数为：",s.counts,"次"])])},queryTimesRenderContent:function(a,t){var e=t.node,s=t.data;t.store;return s.children?a("span",{class:"my-tree-node"},[a("span",null,[e.label])]):a("p",{class:"my-tree-node"},[a("span",null,["浏览器指纹：",e.label,"，其访问次数为：",s.counts,"次"])])}},filters:{toSdDate:function(a){if(a){var t=new Date(a);return t.getFullYear()+"/"+e(parseInt(t.getMonth())+1)+"/"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())}function e(a){return a<10?"0"+a:a}}}},M={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"timingTask-wrapper"},[e("h2",{staticClass:"breadcrumb"},[a._v(a._s(a.$t("lg.youjiang")))]),a._v(" "),e("add-alarm-task",{ref:"addAlarmTask",attrs:{taskTypeDisabledObj:a.taskTypeDisabledObj},on:{getTimingTask:a.getTimingTask}}),a._v(" "),e("div",{staticClass:"timingTaskContent"},[0==a.timingTask.length?e("div",{staticClass:"nodata-box"},[a._v(a._s(a.$t("lg.nodata")))]):a._e(),a._v(" "),a.timingTask.length>0?e("table",[e("thead",[e("tr",[e("th",[a._v(a._s(a.$t("lg.id")))]),a._v(" "),e("th",[a._v(a._s(a.$t("lg.type")))]),a._v(" "),e("th",[a._v("执行频率")]),a._v(" "),e("th",[a._v(a._s(a.$t("lg.params")))]),a._v(" "),e("th",{staticStyle:{"min-width":"80px"}},[a._v(a._s(a.$t("lg.status")))]),a._v(" "),e("th",{staticStyle:{"min-width":"60px"}})])]),a._v(" "),e("tbody",a._l(a.timingTask,function(t){return e("tr",{key:t.id},[e("td",[a._v(a._s(t.id))]),a._v(" "),e("td",[a._v(a._s(t.taskTypeTxt))]),a._v(" "),e("td",[a._v(a._s(t.rate)+a._s(t.rateUnitValueTxt)+"/"+a._s(a.$t("lg.count")))]),a._v(" "),"tokenTime"==t.taskType?e("td",{staticClass:"taskDetailTd"},[e("p",[e("span",[a._v(a._s(a.$t("lg.notifytype"))+": ")]),a._v(a._s(t.params.notificationType))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.recipient"))+": ")]),a._v(" "),a._l(t.params.mailRecipient,function(t,s){return e("span",{key:s},[s>0?e("i",[a._v("、")]):a._e(),a._v(a._s(t))])})],2),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.emailtitle"))+": ")]),a._v(a._s(t.params.mailSubject))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.domain"))+": ")]),a._v(a._s(t.params.domain))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.yemian"))+": ")]),a._v(a._s(t.params.url&&"*"!=t.params.url?t.params.url:"未指定"))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.timefactor"))+": ")]),a._v(a._s(t.params.times))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.counts"))+": ")]),a._v(a._s(t.params.count))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.queryinterval"))+": ")]),a._v(a._s(t.params.timeInterval)+a._s(t.params.intervalUnitValTxt))])]):a._e(),a._v(" "),"tokenCount"==t.taskType?e("td",{staticClass:"taskDetailTd"},[e("p",[e("span",[a._v(a._s(a.$t("lg.notifytype"))+": ")]),a._v(a._s(t.params.notificationType))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.recipient"))+": ")]),a._v(" "),a._l(t.params.mailRecipient,function(t,s){return e("span",{key:s},[s>0?e("i",[a._v("、")]):a._e(),a._v(a._s(t))])})],2),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.emailtitle"))+": ")]),a._v(a._s(t.params.mailSubject))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.domain"))+": ")]),a._v(a._s(t.params.domain))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.yemian"))+": ")]),a._v(a._s(t.params.url&&"*"!=t.params.url?t.params.url:"未指定"))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.counts"))+": ")]),a._v(a._s(t.params.count))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.queryinterval"))+": ")]),a._v(a._s(t.params.timeInterval)+a._s(t.params.intervalUnitValTxt))])]):a._e(),a._v(" "),"esSearch"==t.taskType?e("td",{staticClass:"taskDetailTd"},[e("p",[e("span",[a._v(a._s(a.$t("lg.notifytype"))+": ")]),a._v(a._s(t.params.notificationType))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.recipient"))+": ")]),a._v(" "),a._l(t.params.mailRecipient,function(t,s){return e("span",{key:s},[s>0?e("i",[a._v("、")]):a._e(),a._v(a._s(t))])})],2),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.emailtitle"))+": ")]),a._v(a._s(t.params.mailSubject))]),a._v(" "),t.params.logId?e("p",[e("span",[a._v(a._s(a.$t("lg.logsource"))+": ")]),a._v(a._s(t.params.logId))]):a._e(),a._v(" "),t.params.tmpsArray?e("p",[e("span",[a._v(a._s(a.$t("lg.queryc"))+": ")]),a._v(" "),a._l(t.params.tmpsArray,function(t,s){return e("span",{key:s},[a._v(a._s(t.keyId)+" "+a._s(t.symbolId)+" "+a._s(t.keyinputId)+" "+a._s(t.andorId)+" ")])})],2):a._e(),a._v(" "),t.params.aggsId?e("p",[e("span",[a._v(a._s(a.$t("lg.aggfield"))+": ")]),e("span",[a._v(a._s(t.params.aggsId))])]):a._e(),a._v(" "),t.params.aggsId?e("p",[e("span",[a._v(a._s(a.$t("lg.metric"))+": ")]),e("span",[a._v(a._s(t.params.metricId)+" "+a._s(t.params.symbol2Id)+" "+a._s(t.params.metricinputId))])]):a._e(),a._v(" "),t.params.domainName?e("p",[e("span",[a._v(a._s(a.$t("lg.domain"))+": ")]),e("span",[a._v(a._s(t.params.domainName))])]):a._e(),a._v(" "),t.params.monThreshold?e("p",[e("span",[a._v(a._s(a.$t("lg.threshold"))+": ")]),e("span",[a._v(a._s(t.params.monThreshold))])]):a._e(),a._v(" "),t.params.minDocCount?e("p",[e("span",[a._v(a._s(a.$t("lg.threshold"))+": ")]),e("span",[a._v(a._s(t.params.minDocCount)+a._s(a.$t("lg.counts")))])]):a._e(),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.queryinterval"))+": ")]),a._v(a._s(t.params.timeInterval)+a._s(t.params.intervalUnitValTxt))])]):a._e(),a._v(" "),"urlCompare"==t.taskType?e("td",{staticClass:"taskDetailTd"},[e("p",[e("span",[a._v(a._s(a.$t("lg.notifytype"))+": ")]),a._v(a._s(t.params.notificationType))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.recipient"))+": ")]),a._v(" "),a._l(t.params.mailRecipient,function(t,s){return e("span",{key:s},[s>0?e("i",[a._v("、")]):a._e(),a._v(a._s(t))])})],2),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.emailtitle"))+": ")]),a._v(a._s(t.params.mailSubject))]),a._v(" "),e("p",[e("span",[a._v("数据来源: ")]),a._v(a._s("0"==t.params.apiIndicator?"页面":"API接口"))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.domain"))+": ")]),a._v(a._s(t.params.domainName))]),a._v(" "),e("p",[e("span",[a._v("是否将url加到配置: ")]),a._v(a._s(t.params.addToConfig?"是":"否"))]),a._v(" "),e("p",{directives:[{name:"show",rawName:"v-show",value:t.params.addToConfig,expression:"item.params.addToConfig"}]},[e("span",[a._v("手动代理防御设置默认值: ")]),a._v(a._s(t.params.dfRequestTimeVal)+a._s(t.params.requestTimeUnitValTxt))]),a._v(" "),e("p",{directives:[{name:"show",rawName:"v-show",value:t.params.addToConfig,expression:"item.params.addToConfig"}]},[e("span",[a._v("浏览器参数指标默认值: ")]),a._v(a._s(t.params.defaultVerifyBrowser))]),a._v(" "),e("p",{directives:[{name:"show",rawName:"v-show",value:t.params.addToConfig,expression:"item.params.addToConfig"}]},[e("span",[a._v("用户行为指标默认值: ")]),a._v(a._s(t.params.defaultVerifyAgent))]),a._v(" "),e("p",{directives:[{name:"show",rawName:"v-show",value:t.params.addToConfig,expression:"item.params.addToConfig"}]},[e("span",[a._v("动态指纹功能开启默认: ")]),a._v(a._s("1"==t.params.defaultVerifyToken?"开启":"关闭"))]),a._v(" "),e("p",[e("span",[a._v("时间段一: ")]),a._v(a._s(t.params.timeStrInterval)+a._s(t.params.strIntervalUnitValTxt))]),a._v(" "),e("p",[e("span",[a._v("时间段二: ")]),a._v(a._s(t.params.timeLteInterval)+a._s(t.params.lteIntervalUnitValTxt))])]):a._e(),a._v(" "),"apiScan"==t.taskType?e("td",{staticClass:"taskDetailTd"},[e("p",[e("span",[a._v(a._s(a.$t("lg.notifytype"))+": ")]),a._v(a._s(t.params.notificationType))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.recipient"))+": ")]),a._v(" "),a._l(t.params.mailRecipient,function(t,s){return e("span",{key:s},[s>0?e("i",[a._v("、")]):a._e(),a._v(a._s(t))])})],2),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.emailtitle"))+": ")]),a._v(a._s(t.params.mailSubject))]),a._v(" "),e("p",[e("span",[a._v("是否发送邮件: ")]),a._v(a._s(t.params.notification?"是":"否"))]),a._v(" "),e("p",[e("span",[a._v(a._s(a.$t("lg.queryinterval"))+": ")]),a._v(a._s(t.params.timeInterval)+a._s(t.params.intervalUnitValTxt))])]):a._e(),a._v(" "),e("td",[e("span",{class:t.taskStatu==a.$t("lg.running")?"font-green":""},[e("i",{class:{"el-icon-loading":"操作中"==t.taskStatu,"el-icon-success shadow-icon-color-success":"运行中..."==t.taskStatu,"el-icon-warning":"已暂停"==t.taskStatu}}),a._v(" "+a._s(t.taskStatu))])]),a._v(" "),e("td",{staticClass:"text-center"},["urlCompare"==t.taskType||t.params.alertmark||"apiScan"==t.taskType?a._e():e("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"},on:{click:function(e){t.params.aggsId?a.searchTime(t,"5m"):a.searchTime(t,{curPage:1,pageNum:10})}}},[e("i",{staticClass:"el-icon-search"}),a._v(a._s(a.$t("lg.query")))]),a._v(" "),"urlCompare"==t.taskType?e("router-link",{staticClass:"edit-del-a",attrs:{to:{path:"/objUpdate",query:{urlType:t.params.apiIndicator,domain:t.params.domainName,timeStrInterval:t.params.strInterval,timeLteInterval:t.params.lteInterval}},tag:"a"}},[e("i",{staticClass:"el-icon-search"}),a._v(a._s(a.$t("lg.query")))]):a._e(),a._v(" "),"maliciousAccess"==t.params.alertmark||"maliciousAccessOrg"==t.params.alertmark?e("router-link",{staticClass:"edit-del-a",attrs:{to:{path:"/visitChart",query:{timeInterval:t.params.interval,theDomian:t.params.domainName,ipType:t.params.alertmark}},tag:"a"}},[e("i",{staticClass:"el-icon-search"}),a._v(a._s(a.$t("lg.detail")))]):a._e(),a._v(" "),"maliciousAttack"==t.params.alertmark?e("router-link",{staticClass:"edit-del-a",attrs:{to:{path:"/attackChart",query:{timeInterval:t.params.interval,theDomian:t.params.domainName}},tag:"a"}},[e("i",{staticClass:"el-icon-search"}),a._v(a._s(a.$t("lg.detail")))]):a._e(),a._v(" "),"cpuMax"==t.params.alertmark||"memoryMax"==t.params.alertmark||"networkMax"==t.params.alertmark||"diskRootMax"==t.params.alertmark||"diskRoot01Max"==t.params.alertmark||"cpu_cmMax"==t.params.alertmark||"memory_cmMax"==t.params.alertmark||"diskRoot_cmMax"==t.params.alertmark||"diskRoot01_cmMax"==t.params.alertmark?e("router-link",{staticClass:"edit-del-a",attrs:{to:{path:"/dashboard",query:{timeInterval:t.params.interval,theChartType:t.params.alertmark}},tag:"a"}},[e("i",{staticClass:"el-icon-search"}),a._v(a._s(a.$t("lg.detail")))]):a._e(),a._v(" "),e("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"},on:{click:function(e){a.operationTask(t)}}},[e("i",{class:"stop"==t.status?"el-icon-circle-check font-green":"el-icon-circle-close font-red"}),"stop"==t.status?e("span",{attrs:{title:"点击开始任务"}},[a._v(a._s(a.$t("lg.start")))]):a._e(),"running"==t.status?e("span",{attrs:{title:a.$t("lg.ting")}},[a._v(a._s(a.$t("lg.ting")))]):a._e()]),a._v(" "),e("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"},on:{click:function(e){a.editTask(t)}}},[e("i",{staticClass:"el-icon-edit-outline font-blue"},[a._v(a._s(a.$t("lg.edit")))])]),a._v(" "),e("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"},on:{click:function(e){a.deleteTask(t)}}},[e("i",{staticClass:"el-icon-delete"},[a._v(a._s(a.$t("lg.delete")))])])],1)])}))]):a._e()]),a._v(" "),e("el-dialog",{attrs:{title:a.$t("lg.jiyushijiang"),visible:a.timeVisible,width:"60%","before-close":a.timeClose},on:{"update:visible":function(t){a.timeVisible=t}}},[e("div",{staticClass:"myTreeBox"},[e("el-tree",{ref:"tree",attrs:{data:a.queryTimeData,props:a.queryTimeTreeProps,"render-content":a.queryTimeRenderContent}})],1)]),a._v(" "),e("el-dialog",{attrs:{title:a.$t("lg.jiyucishu"),visible:a.timesVisible,width:"60%","before-close":a.timesClose},on:{"update:visible":function(t){a.timesVisible=t}}},[e("div",{staticClass:"myTreeBox"},[e("el-tree",{ref:"tree",attrs:{data:a.querytimesData,props:a.queryTimesTreeProps,"render-content":a.queryTimesRenderContent}})],1)]),a._v(" "),e("el-dialog",{attrs:{title:a.$t("lg.zidingyi"),visible:a.esSearchVisible,width:"80%","before-close":a.esSearchClose},on:{"update:visible":function(t){a.esSearchVisible=t}}},[a.isQueryOrAggs||"error.log"==a.logId?a._e():e("log-rebuild",{attrs:{tableKeyArr:a.tableKeyArrTask,dynamicTag:a.taskLogsHeadData},on:{refilterColBy:a.refilterColByTask,requeryRowBy:a.requeryRowByTask}}),a._v(" "),0==a.tbodyArr.length?e("div",{staticClass:"nodata-box"},[a._v(a._s(a.$t("lg.nodata")))]):a._e(),a._v(" "),a.tbodyArr.length>0?e("div",{staticClass:"logTableHeight"},[a.isQueryOrAggs?e("logagg",{attrs:{data:a.tbodyArr,piedata:a.piedata,linechartdata:a.linechartdata},on:{getChangeLogInterval:a.esSearchDataChange}}):e("log-tables",{ref:"log_tables",attrs:{logType:a.logId,tabheadData:a.taskLogsHeadData,tabodyData:a.taskLogsBodyData,totalNum:a.taskTotalNum,isLogLoding:!1,showSDURLMenu:a.showSDURLMenu},on:{getChangeLogData:a.esSearchDataChange}})],1):a._e()],1),a._v(" "),e("timing-task-pop",{attrs:{editData:a.editTaskItem,editTaskId:a.editTaskId,isShow:a.isShowTimingTaskEdit,isShowTimingTaskEdit:a.isShowTimingTaskEdit,myTaskType:a.editTaskItem.taskType,myTaskTypeTxt:a.editTaskItem.taskTypeTxt,alertmark:a.alertMark},on:{getTimingTask:a.getTimingTask,setTimingTaskClose:function(t){a.isShowTimingTaskEdit=!1}}})],1)},staticRenderFns:[]};var S=e("VU/8")(I,M,!1,function(a){e("zl49")},null,null);t.default=S.exports},j5eg:function(a,t,e){"use strict";var s=e("Icdr");e("Vb+l"),e("4UDB"),e("Oq2I"),e("miEh"),e("80cc");var i={props:{data:{type:Array},piedata:{type:Object},linechartdata:{type:Object}},watch:{data:function(){if(this.data.length>0){this.piechart(this.piedata.legend,this.piedata.data),this.linechart(this.linechartdata.legend,this.linechartdata.xaxisdata,this.linechartdata.seriesdata)}},"$store.state.isMenuShow":function(){this.pieChart.resize(),this.lineChart.resize()}},mounted:function(){var a=this;a.data.length>0&&(a.piechart(a.piedata.legend,a.piedata.data),a.linechart(a.linechartdata.legend,a.linechartdata.xaxisdata,a.linechartdata.seriesdata)),window.addEventListener("resize",function(){a.pieChart.resize(),a.lineChart.resize()})},data:function(){return{intervals:[{value:"5m",name:"5分钟"},{value:"30m",name:"30分钟"},{value:"1h",name:"1小时"},{value:"5h",name:"5小时"},{value:"1d",name:"1天"},{value:"7d",name:"7天"},{value:"1M",name:"1个月"}],qinterval:"5m",pieChart:null,lineChart:null}},methods:{intervalChange:function(){this.$emit("getChangeLogInterval",this.qinterval)},piechart:function(a,t){this.pieChart=s.init(document.getElementById("piechart"));var e={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:a},series:[{name:"占比",type:"pie",radius:["45%","60%"],center:["70%","35%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:t}]};this.pieChart.setOption(e,!0)},linechart:function(a,t,e){this.lineChart=s.init(document.getElementById("linechart"));var i={title:{},tooltip:{trigger:"axis"},legend:{data:a},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:t},yAxis:{type:"value"},series:e};this.lineChart.setOption(i,!0)}},beforeDestroy:function(){window.removeEventListener("resize",function(){})}},r={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return a.data.length>0?e("div",[e("div",[e("span",[a._v(a._s(a.$t("lg.frequency"))+"：")]),a._v(" "),e("el-select",{attrs:{placeholder:a.$t("lg.frequency")},on:{change:a.intervalChange},model:{value:a.qinterval,callback:function(t){a.qinterval=t},expression:"qinterval"}},a._l(a.intervals,function(a,t){return e("el-option",{key:t,attrs:{label:a.name,value:a.value}})}))],1),a._v(" "),e("div",{staticClass:"search-result-wrapper"},[e("div",{staticClass:"search-result",staticStyle:{"margin-right":"20px"}},[e("table",[a._m(0),a._v(" "),e("tbody",a._l(a.data,function(t){return e("tr",[e("td",[a._v(a._s(t.key))]),a._v(" "),e("td",[a._v(a._s(t.doc_count))])])}))])]),a._v(" "),a._m(1)]),a._v(" "),a._m(2)]):a._e()},staticRenderFns:[function(){var a=this.$createElement,t=this._self._c||a;return t("thead",[t("tr",[t("th",{attrs:{width:"80%"}},[this._v("key")]),this._v(" "),t("th",[this._v("doc_count")])])])},function(){var a=this.$createElement,t=this._self._c||a;return t("div",{staticClass:"search-result"},[t("div",{staticStyle:{height:"260px",width:"100%"},attrs:{id:"piechart"}})])},function(){var a=this.$createElement,t=this._self._c||a;return t("div",{staticStyle:{"margin-top":"20px"}},[t("div",{staticStyle:{height:"320px",width:"100%"},attrs:{id:"linechart"}})])}]};var n=e("VU/8")(i,r,!1,function(a){e("7tBt")},null,null);t.a=n.exports},zl49:function(a,t){}});
//# sourceMappingURL=6.de9b663a2f7a2e579d3b.js.map