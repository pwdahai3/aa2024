webpackJsonp([36],{VNEU:function(e,t){},bbDD:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("fZjL"),i=a.n(o),r=a("mvHQ"),s=a.n(r),n=a("Gu7T"),l=a.n(n),c=a("mtWM"),d=a.n(c),g=a("yJCr"),u=a("gQxQ"),h=a("5reh"),m=a("0aWm"),p=a("rBmc"),f=a("XLwt"),y=a.n(f),b=a("HFmO"),v=a("GfiX"),w=a("7uT9"),C=a("EjLO"),_=a("ufP2"),T=a("ryR9"),x=a("InnB"),L=a("Hkju"),O={mixins:[_.a],components:{pienodata:m.a,queryPanel:b.a,logRebuild:w.a,logTables:C.a},data:function(){return{forFastShow:!1,mustOptions:[],fromTime:0,endTime:0,timeinterval:"",myChartType:"protectChart",isFalg:!1,checkDomain:"",checkUrl:"",filterObj:{match_all:{}},wholeCtMax:0,wholeCtMin:0,normalCtMax:0,normalCtMin:0,businessLineLoading:!1,urlVisitCtLoading:!1,eCodeTypeLoading:!1,orgIpLineLoading:!1,orgIpPieLoading:!1,domainLineLoading:!1,domainPieLoading:!1,fingerPieLoading:!1,autoToolPieLoading:!1,regionBarLoading:!1,businessLineChart:null,urlVisitCtBarChart:null,eCodeTypeChart:null,orgIpLineChart:null,orgIpPieChart:null,domainLineChart:null,domainPieChart:null,fingerPieChart:null,autoToolPieChart:null,regionBarChart:null,businessNodata:!1,urlVisitCtBarNodata:!1,eCodeTypeNodata:!1,orgIpLineNodata:!1,orgIpPieNodata:!1,domainLineNodata:!1,domainPieNodata:!1,fingerPieNodata:!1,autoToolPieNodata:!1,regionBarNodata:!1,totalNum:0,attackSumNum:0,isRegionBarOrg:!1,isLineOrg:!1,isPieOrg:!1,fingerPieLegendShow:!1,popQueryObj:{bool:{must:[{bool:{should:[]}}]}},logDialogVisible:!1,logDialogTitle:"",tableKeyArrAccess:[].concat(l()(v.a.access)),chartLogsHeadData:[],chartLogsBodyData:[],chartLogsTotalNum:0,fromPage:0,pageSize:10,requeryObj:null,searchGeoip:"params._source.shadow.access.geoip",searchGeoip2:"shadow.access.geoip",mapScript:"geoip",searchIp:"",esSearchTimer:null,isShowQueryPanel:!0,isShowGridMenu:!0}},created:function(){var e=this;this.getCustomHeadData(),window.addEventListener("resize",function(){e.eCodeTypeChart.resize(),e.orgIpLineChart.resize(),e.orgIpPieChart.resize(),e.domainLineChart.resize(),e.domainPieChart.resize(),e.fingerPieChart.resize(),e.autoToolPieChart.resize(),e.businessLineChart.resize(),e.forFastShow&&(e.urlVisitCtBarChart.resize(),e.regionBarChart.resize())})},watch:{"$store.state.mydatedata.timestampnow":function(){this.handleTime(),this.getAllchart()},"$store.state.isMenuShow":function(){this.eCodeTypeChart.resize(),this.orgIpLineChart.resize(),this.orgIpPieChart.resize(),this.domainLineChart.resize(),this.domainPieChart.resize(),this.fingerPieChart.resize(),this.autoToolPieChart.resize(),this.businessLineChart.resize(),this.forFastShow&&(this.urlVisitCtBarChart.resize(),this.regionBarChart.resize())}},mounted:function(){this.$route.query.timeInterval||(this.handleTime(),this.getAllchart())},methods:{getChartTypeAllQuery:function(e){this.myChartType=e,this.getAllchart()},forfastloadmore:function(){var e=this;this.forFastShow=!0,this.$nextTick(function(){e.drawUrlVisitCtBar(),e.drawRegionBar()})},getAllchart:function(e){e&&(this.isFalg=e.isQuery,this.checkDomain=e.domainName,this.checkUrl=e.urlArr,this.filterObj=this.getFilterObj(this.isFalg)),this.getRequestNum(),this.attackSum(),this.drawECodeTypePie(),this.drawOrgIpLine(),this.drawOrgIpPie(),this.drawDomainLine(),this.drawDomainPie(),this.drawFingerPie(),this.drawAutoToolPie(),this.drawBusinessLine(),this.forFastShow&&(this.drawUrlVisitCtBar(),this.drawRegionBar())},getFilterObj:function(e){var t={match_all:{}};if(e){var a=this.checkDomain,o=this.checkUrl;if(t={bool:{must:[{query_string:{query:'shadow.access.http_host:"'+a+'"'}}]}},o){var i=o.replace(/(\/)+/g,"\\$1");t.bool.must.push({query_string:{query:'shadow.access.org_url:"'+i+'"'}})}}else t={match_all:{}};return t},handleTime:function(){var e=this.$store.state.mydatedata.starttime,t=this.$store.state.mydatedata.endtime,a=Object(p.a)(e),o=Object(p.a)(t),i=a||Object(p.a)(new Date(Date.now()-this.$store.state.dateTimeLong)),r=o||Object(p.a)(new Date);this.fromTime=i,this.endTime=r,this.timeinterval=this.$store.state.mydatedata.interval||"5m"},getCustomHeadData:function(){var e=this,t=g.b+"/pe/shadow/kv/visitChartAccess";d.a.get(t).then(function(t){t.data.data?e.chartLogsHeadData=t.data.data.value:e.chartLogsHeadData=[].concat(l()(v.a.access))})},drawBusinessLine:function(){var e=this;e.businessLineLoading=!0;var t=document.getElementById("businessContainer");e.businessLineChart=y.a.init(t),e.businessLineChart.off("brushSelected");var a=!1;t.addEventListener("mousedown",function(){a=!1}),t.addEventListener("mouseup",function(){a=!0});var o={color:["#27727b","#e87c25"],title:{text:"恶意访问业务防护",x:"left",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow",label:{show:!0}}},legend:{top:"20px",data:["总请求数","恶意访问"],itemGap:5},grid:{left:"5%",right:"3%",bottom:"4%",top:"20%",containLabel:!0},brush:{toolbox:["lineX"],xAxisIndex:"all",transformable:!1,throttleType:"debounce",throttleDelay:1e3,brushStyle:{borderWidth:0}},toolbox:{right:"20",top:"10"},xAxis:{show:!1,data:[]},yAxis:{show:!1,name:e.$t("lg.counts")},series:[]};u.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{filter:e.filterObj,must:[{term:{"log.file.path":"/usr/local/shadow/logs/access.log"}},{range:{"@timestamp":{from:e.fromTime,to:e.endTime,include_lower:!0,include_upper:!0}}},{exists:{field:"shadow.access.method"}}]}},aggs:{GroupByMe:{date_histogram:{field:"@timestamp",interval:e.timeinterval,extended_bounds:{min:e.fromTime,max:e.endTime}}}}}}).then(function(t){for(var i=t.aggregations?t.aggregations.GroupByMe.buckets:[],r=[],s=[],n=[],l=[],c=0;c<i.length;c++){var d=i[c],g=d.doc_count;0!=g&&l.push(g),g||(g=0),r.push(g),s.push(e.transformMyDate(d.key))}l.sort(function(e,t){return e-t}),e.wholeCtMin=l[0]||0,e.wholeCtMax=l[l.length-1]||0,n.push({name:"总请求数",type:"bar",data:r,barMaxWidth:10,large:!0});var m="shadow-filebeat-*";"protectChart"==e.myChartType?(m="shadow-filebeat-warn*",e.mustOptions=[{range:{"@timestamp":{from:e.fromTime,to:e.endTime,include_lower:!0,include_upper:!0}}}]):"monitorChart"==e.myChartType&&(e.mustOptions=[{query_string:{query:"shadow.access.error_code:>0"}},{query_string:{query:"shadow.access.response_code:200"}},{range:{"@timestamp":{from:e.fromTime,to:e.endTime,include_lower:!0,include_upper:!0}}}]),u.a.search({index:m,body:{size:0,query:{bool:{filter:e.filterObj,must:e.mustOptions}},aggs:{GroupByMe:{date_histogram:{field:"@timestamp",interval:e.timeinterval,extended_bounds:{min:e.fromTime,max:e.endTime}}}}}}).then(function(t){var i=t.aggregations?t.aggregations.GroupByMe.buckets:[],r=[],l=[];0==i.length?(o.xAxis.show=!1,o.yAxis.show=!1,e.businessNodata=!0):(o.xAxis.show=!0,o.yAxis.show=!0,e.businessNodata=!1);for(var c=0;c<i.length;c++){var d=i[c].doc_count;0!=d&&l.push(d),d||(d=0),r.push(d)}l.sort(function(e,t){return e-t}),e.normalCtMin=l[0]||0,e.normalCtMax=l[l.length-1]||0,n.push({name:"恶意访问",type:"bar",data:r,large:!0,barMaxWidth:10}),o.xAxis.data=s,o.series=n,e.businessLineChart.setOption(o,!0),e.businessLineLoading=!1,e.businessLineChart.on("brushSelected",function(t){if(a&&t.batch&&t.batch[0].areas[0]){var o="-0"==t.batch[0].areas[0].coordRange[0]||t.batch[0].areas[0].coordRange[0]<0?0:t.batch[0].areas[0].coordRange[0],i=t.batch[0].areas[0].coordRange[1],r=s[o],n=s[i]?s[i]:s[i-1];if(r==n){var l=new Date(r).getTime(),c=new Date(n).getTime();"5m"==e.$store.state.mydatedata.interval?(l-=3e5,c+=3e5):"10s"==e.$store.state.mydatedata.interval?(l-=1e4,c+=1e4):e.$store.state.mydatedata.interval,r=e.transformMyDate(l),n=e.transformMyDate(c)}e.$store.state.nowTimeVal=[new Date(r),new Date(n)],clearTimeout(e.$store.state.refreshTimeout),e.$store.state.refreshAble=!0,setTimeout(function(){e.$store.commit(h.j)},0)}})})})},getRequestNum:function(){var e=this;u.a.search({index:"shadow-filebeat-*",body:{track_total_hits:!0,query:{bool:{filter:e.filterObj,must:[{term:{"log.file.path":"/usr/local/shadow/logs/access.log"}},{exists:{field:"shadow.access.method"}},{range:{"@timestamp":{from:e.fromTime,to:e.endTime,include_lower:!0,include_upper:!0}}}]}}}}).then(function(t){e.totalNum=t.hits.total.value})},attackSum:function(){var e=this,t="shadow-filebeat-*";"protectChart"==e.myChartType?(t="shadow-filebeat-warn*",e.mustOptions=[{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]):"monitorChart"==e.myChartType&&(e.mustOptions=[{query_string:{query:"shadow.access.error_code:>0"}},{query_string:{query:"shadow.access.response_code:200"}},{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]),u.a.search({index:t,body:{track_total_hits:!0,query:{bool:{filter:e.filterObj,must:e.mustOptions}}}}).then(function(t){e.attackSumNum=t.hits.total.value})},drawUrlVisitCtBar:function(){var e=this;e.urlVisitCtLoading=!0,e.urlVisitCtBarChart=y.a.init(document.getElementById("urlVisitCtBarContainer"));var t,a={normal:{show:!0,rotate:0,align:"left",verticalAlign:"middle",position:"insideLeft",distance:10,formatter:function(e){return e.data.name},fontSize:12}},o={color:["#eb8146"],title:{text:"被恶意访问的url次数/Top10",x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{show:!0,trigger:"axis",confine:!0,axisPointer:{type:"shadow"},extraCssText:"white-space:normal;word-break: break-all",formatter:function(t,a,o){if("protectChart"==e.myChartType)return e.esSearchTimer&&clearTimeout(e.esSearchTimer),e.esSearchTimer=setTimeout(function(){var i="",r="",s="";t.forEach(function(t){r=t.name,i=t.data.name+e.$t("lg.numaccessis")+":"+t.data.value+e.$t("lg.count")});var n='"'+r+'"';u.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{must:[{query_string:{query:"shadow.access.response_code:200"}},{query_string:{query:"shadow.access.response_code:302"}},{query_string:{query:"shadow.access.shadow_url:"+n}}],must_not:{query_string:{query:"shadow.access.org_url:\\/40*\\.html"}}}},_source:["shadow.access.org_url"]}}).then(function(e){e.hits.hits[0]?(s=e.hits.hits[0]._source.shadow.access.org_url,o(a,"其对应的明文为："+s+"</br>"+i)):o(a,"其对应的明文为：-</br>"+i)})},1e3),'<i class="el-icon-loading"></i>Loading...';var i="";return t.forEach(function(t){i=t.data.name+e.$t("lg.numaccessis")+":"+t.data.value+e.$t("lg.count")}),i}},grid:{top:"12%",left:"0",right:"50",bottom:"2%",containLabel:!0},xAxis:{show:!1,type:"value",name:e.$t("lg.counts"),boundaryGap:[0,.01],position:"top",splitLine:{show:!1},minInterval:1},yAxis:{show:!1,type:"category",data:[],inverse:!0},series:[]};t="",t="protectChart"==e.myChartType?"shadow.access.shadow_url":"shadow.access.org_url",u.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{filter:e.filterObj,must:[].concat(l()(T.a[e.myChartType].a2),[{query_string:{query:"shadow.access.http_host:*"}},{query_string:{query:"shadow.access.org_url:*"}},{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}])}},aggs:{GroupByMe:{terms:{field:t,size:10}}}}}).then(function(t){for(var i=t.aggregations?t.aggregations.GroupByMe.buckets:[],r=[],s=i.length,n=0;n<s;n++)r.push("top"+(n+1));o.yAxis.data=r;var l=[];for(n=0;n<r.length;n++)i[n]&&l.push({value:i[n].doc_count,name:i[n].key});o.series=[{type:"bar",label:a,data:l,barMaxWidth:30}],0==i.length?(o.xAxis.show=!1,o.yAxis.show=!1,o.tooltip.show=!1,e.urlVisitCtBarNodata=!0):(o.xAxis.show=!0,o.yAxis.show=!0,o.tooltip.show=!0,e.urlVisitCtBarNodata=!1),e.urlVisitCtBarChart.setOption(o,!0),e.urlVisitCtLoading=!1}),e.urlVisitCtBarChart.off("click"),e.urlVisitCtBarChart.on("click",function(a){e.logDialogVisible=!0,e.logDialogTitle=a.name,e.popQueryObj.bool.filter=e.filterObj,e.popQueryObj.bool.must=JSON.parse(s()(T.a[e.myChartType].a2)),e.popQueryObj.bool.must.push({query_string:{query:t+":"+e.logDialogTitle.replace(/\//g,"\\/")}}),e.getOnepieceFromPie()})},drawECodeTypePie:function(){var e=this;e.eCodeTypeLoading=!0,e.eCodeTypeChart=y.a.init(document.getElementById("eCodeTypeContainer"));var t,a={color:["#2b821d","#e6b600","#339ca8","#c12e34","#0098d9","#005eaa","#97b552","#cc70af"],title:{text:"恶意访问类型展示/Top10",x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"访问类型：",type:"pie",radius:["25%","35%"],data:[].sort(function(e,t){return e.value-t.value}),label:{position:"outside",normal:{textStyle:{fontSize:"12"},formatter:"{b}: {c}"},emphasis:{show:!0,textStyle:{fontSize:"14",fontWeight:"normal"}}},labelLine:{normal:{smooth:0,length:10,length2:20}},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(e){return 200*Math.random()}}]};t="shadow-filebeat-*","protectChart"==e.myChartType?(t="shadow-filebeat-warn*",e.mustOptions=[{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]):"monitorChart"==e.myChartType&&(e.mustOptions=[{query_string:{query:"shadow.access.error_code:>0"}},{query_string:{query:"shadow.access.response_code:200"}},{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]),u.a.search({index:t,body:{size:0,query:{bool:{filter:e.filterObj,must:e.mustOptions}},aggs:{groupbyerrorcode:{terms:{field:"shadow.access.error_code",size:10},aggs:{groupbyresp:{terms:{field:"shadow.access.response_code",size:10}}}}}}}).then(function(t){var o=[];(t.aggregations?t.aggregations.groupbyerrorcode.buckets:[]).forEach(function(e){var t=e.key,a="";"0"==t?e.groupbyresp.buckets.forEach(function(e){var i=e.key;a=L.a[0].hasOwnProperty(i)?L.a[0][i]:"其他异常",o.push({key:[t,i],name:a,value:e.doc_count})}):(a=L.a.hasOwnProperty(t)?L.a[t]:"其他异常",o.push({key:[t],name:a,value:e.doc_count}))}),a.series[0].data=o,0==o.length?e.eCodeTypeNodata=!0:e.eCodeTypeNodata=!1,e.eCodeTypeChart.setOption(a,!0),e.eCodeTypeLoading=!1,e.eCodeTypeChart.off("click"),e.eCodeTypeChart.on("click",function(t){console.log(t),e.logDialogVisible=!0,e.logDialogTitle=t.name;var a=t.data.key,o=a[0],i={bool:{filter:{match_all:{}},must:[{bool:{should:[]}}]}};"0"==o?(i.bool.must[0].bool.should.push({bool:{must:[{query_string:{query:"shadow.access.error_code:0"}},{query_string:{query:"shadow.access.response_code:"+a[1]}}]}}),"200"==a[1]&&i.bool.must[0].bool.should[0].bool.must.push({query_string:{query:"shadow.access.org_url:\\/402\\.html"}})):("protectChart"==e.myChartType&&i.bool.must[0].bool.should.push({bool:{must:[{query_string:{query:"shadow.access.error_code:"+o}},{query_string:{query:"shadow.access.response_code:(400 OR 444 OR 404 OR 405)"}}]}}),"monitorChart"==e.myChartType&&i.bool.must[0].bool.should.push({bool:{must:[{query_string:{query:"shadow.access.error_code:"+o}},{query_string:{query:"shadow.access.response_code:200"}}]}})),i.bool.filter=e.filterObj,e.popQueryObj=i,e.getOnepieceFromPie()})})},drawOrgIpLine:function(){var e=this;e.orgIpLineLoading=!0;var t=document.getElementById("orgIpLineContainer");e.orgIpLineChart=y.a.init(t),e.orgIpLineChart.off("brushSelected");var a=!1;t.addEventListener("mousedown",function(){a=!1}),t.addEventListener("mouseup",function(){a=!0});var o={color:["#4ea397","#22c3aa","#7bd9a5","#d0648a","#f58db2"],title:{text:"恶意访问源IP次数/Top5",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow",label:{show:!0}}},legend:{top:"20px",data:[]},grid:{left:"5%",right:"3%",bottom:"4%",top:"25%",containLabel:!0},brush:{toolbox:["switchOrg"],xAxisIndex:"all",transformable:!1,throttleType:"debounce",throttleDelay:1e3,brushStyle:{borderWidth:0}},toolbox:{right:"10",top:"10",feature:{myTool1:{name:"switchOrg",show:!0,title:"代理IP",icon:"image://static/icon/switch.png",onclick:function(){i(e.isLineOrg)}}}},xAxis:{show:!1,type:"category",data:[]},yAxis:{show:!1,type:"value",name:e.$t("lg.counts"),minInterval:1},series:[]};function i(t){t?(e.isLineOrg=!1,e.searchIp="shadow.access.org_remote_ip",o.title.text="恶意访问代理IP次数/Top5",o.toolbox.feature.myTool1.title="源IP"):(e.isLineOrg=!0,e.searchIp="shadow.access.remote_ip",o.title.text="恶意访问源IP次数/Top5",o.toolbox.feature.myTool1.title="代理IP");var i="shadow-filebeat-*";"protectChart"==e.myChartType?(i="shadow-filebeat-warn*",e.mustOptions=[{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]):"monitorChart"==e.myChartType&&(e.mustOptions=[{query_string:{query:"shadow.access.error_code:>0"}},{query_string:{query:"shadow.access.response_code:200"}},{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]),u.a.search({index:i,body:{size:0,query:{bool:{filter:e.filterObj,must:e.mustOptions}},aggs:{ip:{terms:{field:e.searchIp,size:5},aggs:{time_his:{date_histogram:{field:"@timestamp",interval:e.timeinterval,extended_bounds:{min:e.fromTime,max:e.endTime}}}}}}}}).then(function(t){var i=t.aggregations?t.aggregations.ip.buckets:[],r=[],s=[];0==i.length?(o.xAxis.show=!1,o.yAxis.show=!1,o.brush.toolbox=["switchOrg"],e.orgIpLineNodata=!0):(o.xAxis.show=!0,o.yAxis.show=!0,o.brush.toolbox=["lineX","switchOrg"],e.orgIpLineNodata=!1);for(var n=0;n<i.length;n++){var l=[],c=[],d=i[n];r.push(d.key);for(var g=0;g<d.time_his.buckets.length;g++){var u=d.time_his.buckets[g],m=u.doc_count;m||(m=0),l.push(e.transformMyDate(u.key)),c.push(m)}s.push({name:d.key,type:"line",data:c})}o.legend.data=r,o.xAxis.data=l,o.series=s,e.orgIpLineChart.setOption(o,!0),e.orgIpLineLoading=!1,e.orgIpLineChart.on("brushSelected",function(t){if(a&&t.batch&&t.batch[0].areas[0]){var o="-0"==t.batch[0].areas[0].coordRange[0]||t.batch[0].areas[0].coordRange[0]<0?0:t.batch[0].areas[0].coordRange[0],i=t.batch[0].areas[0].coordRange[1],r=l[o],s=l[i]?l[i]:l[i-1];if(r==s){var n=new Date(r).getTime(),c=new Date(s).getTime();"5m"==e.$store.state.mydatedata.interval?(n-=3e5,c+=3e5):"10s"==e.$store.state.mydatedata.interval?(n-=1e4,c+=1e4):e.$store.state.mydatedata.interval,r=e.transformMyDate(n),s=e.transformMyDate(c)}e.$store.state.nowTimeVal=[new Date(r),new Date(s)],clearTimeout(e.$store.state.refreshTimeout),e.$store.state.refreshAble=!0,setTimeout(function(){e.$store.commit(h.j)},0)}})})}i()},drawOrgIpPie:function(){var e=this;e.orgIpPieLoading=!0,e.orgIpPieChart=y.a.init(document.getElementById("orgIpPieContainer"));var t={color:["#516b91","#59c4e6","#edafda","#93b7e3","#a5e7f0","#4ea397","#22c3aa","#7bd9a5","#d0648a","#f58db2"],title:{text:"恶意访问源IP次数/Top10",x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},toolbox:{right:"10",top:"10",feature:{myTool1:{show:!0,title:"代理IP",icon:"image://static/icon/switch.png",onclick:function(){a(e.isPieOrg)}}}},series:[{name:"访问来源：",type:"pie",radius:["25%","35%"],data:[].sort(function(e,t){return e.value-t.value}),label:{position:"outside",normal:{textStyle:{fontSize:"12"},formatter:"{b}: {c}"},emphasis:{show:!0,textStyle:{fontSize:"14",fontWeight:"normal"}}},labelLine:{normal:{smooth:0,length:10,length2:20}},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(e){return 200*Math.random()}}]};function a(a){a?(e.isPieOrg=!1,e.searchIp="shadow.access.org_remote_ip",t.title.text="恶意访问代理IP次数/Top10",t.toolbox.feature.myTool1.title="源IP"):(e.isPieOrg=!0,e.searchIp="shadow.access.remote_ip",t.title.text="恶意访问源IP次数/Top10",t.toolbox.feature.myTool1.title="代理IP");var o="shadow-filebeat-*";"protectChart"==e.myChartType?(o="shadow-filebeat-warn*",e.mustOptions=[{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]):"monitorChart"==e.myChartType&&(e.mustOptions=[{query_string:{query:"shadow.access.error_code:>0"}},{query_string:{query:"shadow.access.response_code:200"}},{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]),u.a.search({index:o,body:{size:0,query:{bool:{filter:e.filterObj,must:e.mustOptions}},aggs:{ip:{terms:{field:e.searchIp,size:10}}}}}).then(function(a){for(var o=a.aggregations?a.aggregations.ip.buckets:[],i=[],r=[],n=0;n<o.length;n++){var l=o[n];i.push({value:l.doc_count,name:l.key}),r.push(l.key)}t.series[0].data=i,0==i.length?e.orgIpPieNodata=!0:e.orgIpPieNodata=!1,e.orgIpPieChart.setOption(t,!0),e.orgIpPieLoading=!1,e.orgIpPieChart.off("click"),e.orgIpPieChart.on("click",function(t){e.logDialogVisible=!0,e.logDialogTitle=t.name,e.popQueryObj.bool.filter=e.filterObj,e.popQueryObj.bool.must=JSON.parse(s()(T.a[e.myChartType].a1)),e.popQueryObj.bool.must.push({query_string:{query:e.searchIp+':"'+e.logDialogTitle+'"'}}),e.getOnepieceFromPie()})})}a()},drawDomainLine:function(){var e=this;e.domainLineLoading=!0;var t=document.getElementById("domainLineContainer");e.domainLineChart=y.a.init(t),e.domainLineChart.off("brushSelected");var a=!1;t.addEventListener("mousedown",function(){a=!1}),t.addEventListener("mouseup",function(){a=!0});var o={color:["#c1232b","#27727b","#fcce10","#e87c25","#b5c334"],title:{text:"恶意访问域名次数/Top5",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow",label:{show:!0}}},legend:{top:"20px",data:[]},grid:{left:"5%",right:"3%",bottom:"4%",top:"25%",containLabel:!0},brush:{toolbox:["lineX"],xAxisIndex:"all",transformable:!1,throttleType:"debounce",throttleDelay:1e3,brushStyle:{borderWidth:0}},toolbox:{show:!1,right:"10",top:"10"},xAxis:{show:!1,type:"category",data:[]},yAxis:{show:!1,type:"value",name:e.$t("lg.counts"),minInterval:1},series:[]},i="shadow-filebeat-*";"protectChart"==e.myChartType?(i="shadow-filebeat-warn*",e.mustOptions=[{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]):"monitorChart"==e.myChartType&&(e.mustOptions=[{query_string:{query:"shadow.access.error_code:>0"}},{query_string:{query:"shadow.access.response_code:200"}},{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]),u.a.search({index:i,body:{size:0,query:{bool:{filter:e.filterObj,must:e.mustOptions}},aggs:{host:{terms:{field:"shadow.access.http_host",size:5},aggs:{time_his:{date_histogram:{field:"@timestamp",interval:e.timeinterval,extended_bounds:{min:e.fromTime,max:e.endTime}}}}}}}}).then(function(t){var i=t.aggregations?t.aggregations.host.buckets:[],r=[],s=[];0==i.length?(o.xAxis.show=!1,o.yAxis.show=!1,o.toolbox.show=!1,e.domainLineNodata=!0):(o.xAxis.show=!0,o.yAxis.show=!0,o.toolbox.show=!0,e.domainLineNodata=!1);for(var n=0;n<i.length;n++){var l=[],c=[],d=i[n];r.push(d.key);for(var g=0;g<d.time_his.buckets.length;g++){var u=d.time_his.buckets[g],m=u.doc_count;m||(m=0),l.push(e.transformMyDate(u.key)),c.push(m)}s.push({name:d.key,type:"line",data:c})}o.legend.data=r,o.xAxis.data=l,o.series=s,e.domainLineChart.setOption(o,!0),e.domainLineLoading=!1,e.domainLineChart.on("brushSelected",function(t){if(a&&t.batch&&t.batch[0].areas[0]){var o="-0"==t.batch[0].areas[0].coordRange[0]||t.batch[0].areas[0].coordRange[0]<0?0:t.batch[0].areas[0].coordRange[0],i=t.batch[0].areas[0].coordRange[1],r=l[o],s=l[i]?l[i]:l[i-1];if(r==s){var n=new Date(r).getTime(),c=new Date(s).getTime();"5m"==e.$store.state.mydatedata.interval?(n-=3e5,c+=3e5):"10s"==e.$store.state.mydatedata.interval?(n-=1e4,c+=1e4):e.$store.state.mydatedata.interval,r=e.transformMyDate(n),s=e.transformMyDate(c)}e.$store.state.nowTimeVal=[new Date(r),new Date(s)],clearTimeout(e.$store.state.refreshTimeout),e.$store.state.refreshAble=!0,setTimeout(function(){e.$store.commit(h.j)},0)}})})},drawDomainPie:function(){var e=this;e.domainPieLoading=!0,e.domainPieChart=y.a.init(document.getElementById("domainPieContainer"));var t,a={color:["#27727b","#fcce10","#e87c25","#b5c334","#60c0dd","#d7504b","#c6e579","#f0805a","#26c0c0","#c1232b"],title:{text:"恶意访问域名次数/Top10",x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"访问来源：",type:"pie",radius:["25%","35%"],data:[].sort(function(e,t){return e.value-t.value}),label:{position:"outside",normal:{textStyle:{fontSize:"12"},formatter:"{b}: {c}"},emphasis:{show:!0,textStyle:{fontSize:"14",fontWeight:"normal"}}},labelLine:{normal:{smooth:0,length:10,length2:20}},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(e){return 200*Math.random()}}]};t="shadow-filebeat-*","protectChart"==e.myChartType?(t="shadow-filebeat-warn*",e.mustOptions=[{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]):"monitorChart"==e.myChartType&&(e.mustOptions=[{query_string:{query:"shadow.access.error_code:>0"}},{query_string:{query:"shadow.access.response_code:200"}},{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]),u.a.search({index:t,body:{size:0,query:{bool:{filter:e.filterObj,must:e.mustOptions}},aggs:{url:{terms:{field:"shadow.access.http_host",size:10}}}}}).then(function(t){for(var o=t.aggregations?t.aggregations.url.buckets:[],i=[],r=[],n=0;n<o.length;n++){var l=o[n];i.push({value:l.doc_count,name:l.key}),r.push(l.key)}a.series[0].data=i,0==i.length?e.domainPieNodata=!0:e.domainPieNodata=!1,e.domainPieChart.setOption(a,!0),e.domainPieLoading=!1,e.domainPieChart.off("click"),e.domainPieChart.on("click",function(t){e.logDialogVisible=!0,e.logDialogTitle=t.name,e.popQueryObj.bool.filter=e.filterObj,e.popQueryObj.bool.must=JSON.parse(s()(T.a[e.myChartType].a1)),e.popQueryObj.bool.must.push({query_string:{query:'shadow.access.http_host:"'+e.logDialogTitle.replace(/:/g,"\\:")+'"'}}),e.getOnepieceFromPie()})})},drawFingerPie:function(){var e=this;e.fingerPieLoading=!0,e.fingerPieChart=y.a.init(document.getElementById("fingerPieContainer"));var t,a={color:["#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4"],title:{text:"指纹访问记录/Top10",x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{show:e.fingerPieLegendShow,backgroundColor:"#fff",orient:"vertical",top:"30",right:"right",data:[]},series:{name:"访问来源",type:"pie",radius:"40%",center:["50%","50%"],data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{position:"outside",normal:{textStyle:{fontSize:"12"},formatter:"{b}: {c}"},emphasis:{show:!0,textStyle:{fontSize:"14",fontWeight:"normal"}}},labelLine:{normal:{smooth:0,length:10,length2:20}}}};t="shadow-filebeat-*","protectChart"==e.myChartType?(t="shadow-filebeat-warn*",e.mustOptions=[{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]):"monitorChart"==e.myChartType&&(e.mustOptions=[{query_string:{query:"shadow.access.error_code:>0"}},{query_string:{query:"shadow.access.response_code:200"}},{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]),u.a.search({index:t,body:{size:0,query:{bool:{filter:e.filterObj,must:e.mustOptions}},aggs:{tokenName:{terms:{field:"shadow.access.token",size:10}}}}}).then(function(t){var o=[];0==(o=t.aggregations?t.aggregations.tokenName.buckets:[]).length?e.fingerPieNodata=!0:e.fingerPieNodata=!1;for(var i=[],r=[],n=0;n<o.length;n++){var l=o[n];i.push({value:l.doc_count,name:l.key}),r.push(l.key)}a.series.data=i,a.legend.data=r,e.fingerPieChart.setOption(a,!0),e.fingerPieLoading=!1,e.fingerPieChart.off("click"),e.fingerPieChart.on("click",function(t){e.logDialogVisible=!0,e.logDialogTitle=t.name,e.popQueryObj.bool.filter=e.filterObj,e.popQueryObj.bool.must=JSON.parse(s()(T.a[e.myChartType].a1)),e.popQueryObj.bool.must.push({query_string:{query:'shadow.access.token:"'+e.logDialogTitle+'"'}}),e.getOnepieceFromPie()})})},drawAutoToolPie:function(){var e=this;e.autoToolPieLoading=!0,e.autoToolPieChart=y.a.init(document.getElementById("autoToolPieContainer"));var t,a={title:{text:"自动化工具类型/Top10",x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"axis",axisPointer:{type:"none"},formatter:function(e){return e[0].name+": "+e[0].value}},grid:{top:"12%",left:"-10",right:"5%",bottom:"10%",containLabel:!0},xAxis:{show:!1,data:[],axisTick:{show:!0},axisLine:{show:!0},axisLabel:{textStyle:{color:"#e54035"},interval:0,rotate:-30}},yAxis:{show:!1},color:["#e54035"],series:[{name:"hill",type:"pictorialBar",barCategoryGap:"-5%",symbol:"path://M0,10 L10,10 C5.5,10 5.5,5 5,0 C4.5,5 4.5,10 0,10 z",itemStyle:{normal:{opacity:.6},emphasis:{opacity:1}},data:[],z:10},{name:"glyph",type:"pictorialBar",barGap:"-100%",symbolPosition:"end",symbolSize:5,symbolOffset:[0,"-120%"],data:[]}]};t="shadow-filebeat-*","protectChart"==e.myChartType?(t="shadow-filebeat-warn*",e.mustOptions=[{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]):"monitorChart"==e.myChartType&&(e.mustOptions=[{query_string:{query:"shadow.access.error_code:>0"}},{query_string:{query:"shadow.access.response_code:200"}},{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]),u.a.search({index:t,body:{size:0,query:{bool:{filter:e.filterObj,must:e.mustOptions}},aggs:{user_agent:{terms:{field:"shadow.access.user_agent.name",size:10}}}}}).then(function(t){var o=t.aggregations?t.aggregations.user_agent.buckets:[],i=[],r=[],n=[];o.length>0?(e.autoToolPieNodata=!1,a.xAxis.show=!0,o.forEach(function(e){n.push(e.key),i.push(e.doc_count),r.push({value:e.doc_count})})):(e.autoToolPieNodata=!0,a.xAxis.show=!1),a.series[0].data=i,a.series[1].data=r,a.xAxis.data=n,e.autoToolPieChart.setOption(a,!0),e.autoToolPieLoading=!1,e.autoToolPieChart.off("click"),e.autoToolPieChart.on("click",function(t){e.logDialogVisible=!0,e.logDialogTitle=t.name,e.popQueryObj.bool.filter=e.filterObj,e.popQueryObj.bool.must=JSON.parse(s()(T.a[e.myChartType].a1)),e.popQueryObj.bool.must.push({query_string:{query:'shadow.access.user_agent.name:"'+e.logDialogTitle+'"'}}),e.getOnepieceFromPie()})})},drawRegionBar2:function(){var e=this;e.regionBarLoading=!0,e.regionBarChart=y.a.init(document.getElementById("regionBarContainer"));var t={normal:{show:!0,rotate:0,align:"left",verticalAlign:"middle",position:"insideLeft",distance:10,formatter:function(e){return e.data.name},fontSize:12}},a={color:["#e6b600"],title:{text:e.$t("lg.geographicinfosourceip"),x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{show:!1,trigger:"axis",confine:!0,axisPointer:{type:"shadow"},extraCssText:"white-space:normal;word-break: break-all",formatter:function(t,a,o){var i="";return t.forEach(function(t){i=t.data.name+"发起恶意访问的次数为:"+t.data.value+e.$t("lg.count")}),i}},toolbox:{right:"10",top:"10",feature:{myTool1:{show:!0,title:"代理IP",icon:"image://static/icon/switch.png",onclick:function(){o(e.isRegionBarOrg),console.log(e.isRegionBarOrg)}}}},grid:{top:"12%",left:"0",right:"50",bottom:"2%",containLabel:!0},xAxis:{show:!1,type:"value",name:e.$t("lg.counts"),boundaryGap:[0,.01],position:"top",splitLine:{show:!1},minInterval:1},yAxis:{show:!1,type:"category",data:[],inverse:!0},series:[]};function o(o){o?(e.isRegionBarOrg=!1,e.searchGeoip="params._source.shadow.access.org_geoip",e.mapScript="org_geoip",a.title.text=e.$t("lg.geographicinfoproxyip"),a.toolbox.feature.myTool1.title=e.$t("lg.sourceip")):(e.isRegionBarOrg=!0,e.searchGeoip="params._source.shadow.access.geoip",e.mapScript="geoip",a.title.text=e.$t("lg.geographicinfosourceip"),a.toolbox.feature.myTool1.title=e.$t("lg.agentip"));var i="shadow-filebeat-*";"protectChart"==e.myChartType?(i="shadow-filebeat-warn*",e.mustOptions=[{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]):"monitorChart"==e.myChartType&&(e.mustOptions=[{query_string:{query:"shadow.access.error_code:>0"}},{query_string:{query:"shadow.access.response_code:200"}},{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]),u.a.search({index:i,body:{size:0,query:{bool:{filter:e.filterObj,must:e.mustOptions}},aggs:{GroupByGeo:{terms:{script:{inline:e.searchGeoip,lang:"painless"},size:10},aggs:{total_count:{scripted_metric:{init_script:"params._agg.count = []",map_script:"Map cnt = new HashMap();cnt.put('loc',params['_source']['shadow']['access']['"+e.mapScript+"']);params._agg.count.add(cnt)",combine_script:"return params._agg.count.get(0)",reduce_script:"return params._aggs.get(0)"}}}}}}}).then(function(o){for(var i=o.aggregations?o.aggregations.GroupByGeo.buckets:[],r=[],n=i.length,l=0;l<n;l++)r.push("top"+(l+1));a.yAxis.data=r;var c=[];for(l=0;l<r.length;l++)if(i[l]){var d=i[l].total_count.value.loc.city_name?i[l].total_count.value.loc.city_name:"["+i[l].total_count.value.loc.location.lon+","+i[l].total_count.value.loc.location.lat+"]";c.push({value:i[l].doc_count,name:d})}a.series=[{type:"bar",label:t,data:c,barMaxWidth:30}],0==i.length?(a.xAxis.show=!1,a.yAxis.show=!1,a.tooltip.show=!1,e.regionBarNodata=!0):(a.xAxis.show=!0,a.yAxis.show=!0,a.tooltip.show=!0,e.regionBarNodata=!1),e.regionBarChart.setOption(a,!0),e.regionBarLoading=!1,e.regionBarChart.off("click"),e.regionBarChart.on("click",function(t){if(e.logDialogVisible=!0,e.logDialogTitle=t.name,e.popQueryObj.bool.filter=e.filterObj,e.popQueryObj.bool.must=JSON.parse(s()(T.a[e.myChartType].a1)),/^\[.+\]$/.test(t.name)){var a=JSON.parse(t.name),o=a[0],i=a[1],r="shadow.access."+e.mapScript+".location",n={};n.distance="1mm",n[r]={lat:i,lon:o},e.popQueryObj.bool.filter.bool?e.popQueryObj.bool.filter.bool.must.push({geo_distance:n}):(e.popQueryObj.bool.filter={bool:{must:[]}},e.popQueryObj.bool.filter.bool.must.push({geo_distance:n}))}else e.popQueryObj.bool.must.push({query_string:{query:"shadow.access."+e.mapScript+".city_name:"+e.logDialogTitle}});e.getOnepieceFromPie()})})}o()},drawRegionBar:function(){var e=this;e.regionBarLoading=!0,e.regionBarChart=y.a.init(document.getElementById("regionBarContainer"));var t={color:["#3fb1e3","#6be6c1","#626c91","#a0a7e6","#91ca8c","#96dee8","#4ea397","#22c3aa","#97b552","#9a7fd1"],title:{text:e.$t("lg.geographicinfosourceip"),x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},toolbox:{right:"10",top:"10",feature:{myTool1:{show:!0,title:e.$t("lg.agentip"),icon:"image://static/icon/switch.png",onclick:function(){a(e.isRegionPieOrg)}}}},series:{type:"pie",radius:["25%","35%"],data:[].sort(function(e,t){return e.value-t.value}),label:{position:"outside",normal:{textStyle:{fontSize:"12"},formatter:"{b}: {c}"},emphasis:{show:!0,textStyle:{fontSize:"14",fontWeight:"normal"}}},labelLine:{normal:{smooth:0,length:10,length2:20}},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(e){return 200*Math.random()}}};function a(a){a?(e.isRegionPieOrg=!1,e.searchGeoip="params._source.shadow.access.org_geoip",e.mapScript="org_geoip",t.title.text=e.$t("lg.geographicinfoproxyip"),t.toolbox.feature.myTool1.title=e.$t("lg.sourceip")):(e.isRegionPieOrg=!0,e.searchGeoip="params._source.shadow.access.geoip",e.mapScript="geoip",t.title.text=e.$t("lg.geographicinfosourceip"),t.toolbox.feature.myTool1.title=e.$t("lg.agentip")),u.a.search({index:"shadow-filebeat-warn*",body:{track_total_hits:!0,query:{bool:{filter:e.filterObj,must:[{range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}]}},aggs:{GroupByGeo:{terms:{script:{lang:"painless",source:e.searchGeoip+".city_name+';'+"+e.searchGeoip+".location.lon+', '+"+e.searchGeoip+".location.lat"},field:e.searchGeoip2+".city_name"}}}}}).then(function(a){var o=[];(a.aggregations?a.aggregations.GroupByGeo.buckets:[]).forEach(function(e){var t=e.key.split(";"),a=t[0],i=(t[1].split(",").map(function(e){return parseInt(e,10)}),e.doc_count);o.push({name:a,value:i})}),0==o.length?e.regionBarNodata=!0:e.regionBarNodata=!1,t.series.data=o,e.regionBarChart.setOption(t,!0),e.regionBarLoading=!1,e.regionBarChart.off("click"),e.regionBarChart.on("click",function(t){if(e.logDialogVisible=!0,e.logDialogTitle=t.name,e.popQueryObj.bool.filter=e.filterObj,/^\[.+\]$/.test(t.name)){var a=JSON.parse(t.name),o=a[0],i=a[1],r="shadow.access."+e.mapScript+".location",s={};s.distance="1mm",s[r]={lat:i,lon:o},e.popQueryObj.bool.filter.bool?e.popQueryObj.bool.filter.bool.must.push({geo_distance:s}):(e.popQueryObj.bool.filter={bool:{must:[]}},e.popQueryObj.bool.filter.bool.must.push({geo_distance:s}))}else e.popQueryObj.bool.must.push({query_string:{query:"shadow.access."+e.mapScript+".city_name:"+e.logDialogTitle}});e.getOnepieceFromPie()})})}a()},fullScreen:function(){var e=this;document.getElementsByClassName("visitChart-wrapper")[0].requestFullscreen(),window.addEventListener("fullscreenchange",function(t){document.fullscreenElement?(e.isShowQueryPanel=!1,e.isShowGridMenu=!1):(e.isShowQueryPanel=!0,e.isShowGridMenu=!0)})},downLoadPdf:function(){var e=this;if(0!=this.attackSumNum){var t=this.businessLineChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),a=void 0,o=void 0;this.forFastShow&&(a=this.urlVisitCtBarChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),o=this.regionBarChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""));var i=this.eCodeTypeChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),r=this.orgIpLineChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),s=this.orgIpPieChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),n=this.domainLineChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),l=this.domainPieChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),c=this.fingerPieChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),u=this.autoToolPieChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),m=void 0;m=a&&o?[t,a,i,r,s,n,l,c,u,o]:[t,i,r,s,n,l,c,u];var p=g.b+"pe/download/conversion/jpg2pdf";d.a.post(p,{base64StringList:m},{responseType:"blob"}).then(function(t){if(200==t.status){e.$store.commit(h.i,{pdfdata:t.data,pdfname:"恶意访问数据图表.pdf"})}}).catch(function(e){console.log(e)})}else this.$message.error("暂无可导出数据")},goBackMap:function(){this.$router.push("/visit")},getChangeLogData:function(e){this.fromPage=e.curPage-1,this.pageSize=e.pageNum,this.requeryObj?this.getOnepieceFromPie(this.requeryObj):this.getOnepieceFromPie()},getOnepieceFromPie:function(e){var t=this,a=JSON.parse(s()(t.popQueryObj));if(a.bool.must.push({range:{"@timestamp":{gte:t.fromTime,lte:t.endTime}}}),e){var o=e.bool.must;a.bool.filter.bool?o.forEach(function(e){a.bool.filter.bool.must.push(e)}):(a.bool.filter={bool:{must:[]}},o.forEach(function(e){a.bool.filter.bool.must.push(e)}))}u.a.search({index:"shadow-filebeat*",body:{from:t.fromPage*t.pageSize,size:t.pageSize,sort:{"@timestamp":"desc"},query:a}}).then(function(e){t.chartLogsTotalNum=e.hits.total.value;var a=e.hits.hits;t.chartLogsBodyData=Object(x.c)(a)})},requeryRowByAccess:function(e){this.requeryObj=e.requeryObj,this.fromPage=0,this.getOnepieceFromPie(this.requeryObj),this.$refs.log_tables&&(this.$refs.log_tables.tabCurPage=1)},refilterColByAccess:function(e){var t=g.b+"/pe/shadow/kv";d.a.post(t,{visitChartAccess:e}).then(function(a){i()(a.data.data.Failure)&&d.a.patch(t,{visitChartAccess:e}).then(function(e){})}),this.chartLogsHeadData=e},showSDURLMenu:function(e){this.chartLogsBodyData.forEach(function(e){e.showUMenuList=!1}),this.$set(this.chartLogsBodyData[e],"showUMenuList",!0)},hideSDURLMenu:function(){this.chartLogsBodyData.forEach(function(e){e.showUMenuList=!1})},logDialogClose:function(){this.logDialogVisible=!1,this.logDialogTitle="",this.fromPage=0,this.chartLogsTotalNum=0,this.popQueryObj={bool:{must:[{bool:{should:[]}}]}},this.broadcast("logRequery","clearData"),this.requeryObj=null},transformMyDate:function(e){function t(e){return e<10?"0"+e:e}return t((e=new Date(e)).getFullYear())+"-"+t(parseInt(e.getMonth())+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())}},beforeDestroy:function(){window.removeEventListener("resize",function(){})}},P={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"visitChart-wrapper",on:{click:e.hideSDURLMenu}},[a("query-panel",{directives:[{name:"show",rawName:"v-show",value:e.isShowQueryPanel,expression:"isShowQueryPanel"}],attrs:{myChartType:e.myChartType},on:{getAllQuerychart:e.getAllchart,getChartTypeAllQuery:e.getChartTypeAllQuery,handleTime:e.handleTime}}),e._v(" "),a("div",{staticClass:"visitChartContent"},[a("el-row",{staticClass:"chartRow chartRowBusi",attrs:{gutter:10}},[a("el-col",{staticStyle:{"padding-left":"0px"},attrs:{span:20}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.businessLineLoading,expression:"businessLineLoading"}],staticClass:"chart-content",staticStyle:{padding:"15px","box-sizing":"border-box"},attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[e.businessNodata?a("pienodata",{attrs:{mystyle:"linenodata"}}):e._e(),e._v(" "),a("div",{ref:"businessContainer",attrs:{id:"businessContainer"}})],1)]),e._v(" "),a("el-col",{staticClass:"busiNumBox",attrs:{span:4}},[a("ul",{staticClass:"totalList"},[a("li",{staticClass:"listTitle"},[e._v("总请求数：")]),e._v(" "),a("li",[a("i",{staticClass:"liLable"},[e._v("MAX:")]),e._v(" "),a("p",{staticClass:"liValue"},[e._v(e._s(e.wholeCtMax))])]),e._v(" "),a("li",[a("i",{staticClass:"liLable"},[e._v("MIN:")]),e._v(" "),a("p",{staticClass:"liValue"},[e._v(e._s(e.wholeCtMin))])])]),e._v(" "),a("ul",{staticClass:"someList"},[a("li",{staticClass:"listTitle"},[e._v("恶意访问：")]),e._v(" "),a("li",[a("i",{staticClass:"liLable"},[e._v("MAX:")]),e._v(" "),a("p",{staticClass:"liValue"},[e._v(e._s(e.normalCtMax))])]),e._v(" "),a("li",[a("i",{staticClass:"liLable"},[e._v("MIN:")]),e._v(" "),a("p",{staticClass:"liValue"},[e._v(e._s(e.normalCtMin))])])])])],1),e._v(" "),a("el-row",{staticClass:"chartRow",attrs:{gutter:10}},[a("el-col",{attrs:{span:16}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.orgIpLineLoading,expression:"orgIpLineLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[e.orgIpLineNodata?a("pienodata",{attrs:{mystyle:"linenodata"}}):e._e(),e._v(" "),a("div",{attrs:{id:"orgIpLineContainer"}})],1)]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"chart-content numBox txtOverflow"},[a("p",{staticClass:"text-center numBoxTitle",staticStyle:{"padding-top":"10px"}},[e._v("总数据量")]),e._v(" "),a("div",{staticClass:"totalBox"},[a("p",{staticClass:"numTitle"},[e._v("请求总量")]),e._v(" "),a("p",{staticClass:"totalNum"},[e._v(e._s(e.totalNum)),a("span",{staticClass:"uTxt"},[e._v("次")])])]),e._v(" "),a("div",{staticClass:"abnormalBox"},[a("p",{staticClass:"numTitle"},[e._v("恶意访问总量")]),e._v(" "),a("p",{staticClass:"abnormalNum"},[e._v(e._s(e.attackSumNum)),a("span",{staticClass:"uTxt"},[e._v("次")])])])])])],1),e._v(" "),a("el-row",{staticClass:"chartRow",attrs:{gutter:10}},[a("el-col",{attrs:{span:16}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.domainLineLoading,expression:"domainLineLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[e.domainLineNodata?a("pienodata",{attrs:{mystyle:"linenodata"}}):e._e(),e._v(" "),a("div",{attrs:{id:"domainLineContainer"}})],1)]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.domainPieLoading,expression:"domainPieLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[e.domainPieNodata?a("div",{staticClass:"adaptive-circle"},[a("div",{staticClass:"layout middle"},[a("div",[a("p",[e._v("暂无数据")])])])]):e._e(),e._v(" "),a("div",{attrs:{id:"domainPieContainer"}})])])],1),e._v(" "),a("el-row",{staticClass:"chartRow",attrs:{gutter:10}},[a("el-col",{attrs:{span:16}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.eCodeTypeLoading,expression:"eCodeTypeLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[e.eCodeTypeNodata?a("div",{staticClass:"adaptive-circle"},[a("div",{staticClass:"layout middle"},[a("div",[a("p",[e._v("暂无数据")])])])]):e._e(),e._v(" "),a("div",{attrs:{id:"eCodeTypeContainer"}})])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.orgIpPieLoading,expression:"orgIpPieLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[e.orgIpPieNodata?a("div",{staticClass:"adaptive-circle"},[a("div",{staticClass:"layout middle"},[a("div",[a("p",[e._v("暂无数据")])])])]):e._e(),e._v(" "),a("div",{attrs:{id:"orgIpPieContainer"}})])])],1),e._v(" "),a("el-row",{staticClass:"chartRow",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.fingerPieLoading,expression:"fingerPieLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[e.fingerPieNodata?a("div",{staticClass:"adaptive-circle fingerPie-circle"},[a("div",{staticClass:"layout middle"},[a("div",[a("p",[e._v("暂无数据")])])])]):e._e(),e._v(" "),a("div",{attrs:{id:"fingerPieContainer"}})])]),e._v(" "),a("el-col",{attrs:{span:10}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.autoToolPieLoading,expression:"autoToolPieLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[e.autoToolPieNodata?a("div",{staticClass:"adaptive-circle"},[a("div",{staticClass:"layout middle"},[a("div",[a("p",[e._v("暂无数据")])])])]):e._e(),e._v(" "),a("div",{attrs:{id:"autoToolPieContainer"}})])])],1),e._v(" "),e.forFastShow?a("el-row",{staticClass:"chartRow",attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.urlVisitCtLoading,expression:"urlVisitCtLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[e.urlVisitCtBarNodata?a("pienodata",{attrs:{mystyle:"linenodata"}}):e._e(),e._v(" "),a("div",{attrs:{id:"urlVisitCtBarContainer"}})],1)])],1):e._e(),e._v(" "),e.forFastShow?a("el-row",{staticClass:"chartRow",attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.regionBarLoading,expression:"regionBarLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[e.regionBarNodata?a("div",{staticClass:"adaptive-circle"},[a("div",{staticClass:"layout middle"},[a("div",[a("p",[e._v(e._s(e.$t("lg.nodata")))])])])]):e._e(),e._v(" "),a("div",{attrs:{id:"regionBarContainer"}})])]),e._v(" "),a("el-col",{attrs:{span:10}})],1):e._e(),e._v(" "),a("div",[e.forFastShow?e._e():a("p",{staticClass:"fastloadmore",on:{click:e.forfastloadmore}},[e._v("点击查看更多图表")])])],1),e._v(" "),a("el-dialog",{attrs:{title:e.logDialogTitle,visible:e.logDialogVisible,width:"80%","before-close":e.logDialogClose},on:{"update:visible":function(t){e.logDialogVisible=t}}},[a("log-rebuild",{attrs:{tableKeyArr:e.tableKeyArrAccess,dynamicTag:e.chartLogsHeadData},on:{refilterColBy:e.refilterColByAccess,requeryRowBy:e.requeryRowByAccess}}),e._v(" "),0==e.chartLogsTotalNum?a("div",{staticClass:"nodata-box"},[e._v("暂无数据")]):e._e(),e._v(" "),e.chartLogsTotalNum>0?a("div",{staticClass:"logTableHeight"},[a("log-tables",{ref:"log_tables",attrs:{tabheadData:e.chartLogsHeadData,tabodyData:e.chartLogsBodyData,totalNum:e.chartLogsTotalNum,isLogLoding:!1,showSDURLMenu:e.showSDURLMenu},on:{getChangeLogData:e.getChangeLogData}})],1):e._e()],1),e._v(" "),a("ul",{directives:[{name:"show",rawName:"v-show",value:e.isShowGridMenu,expression:"isShowGridMenu"}],staticClass:"operationBtnUl"},[a("li",[a("img",{attrs:{src:"static/icon/fullScreen.png",alt:"大屏展示",title:"大屏展示"},on:{click:e.fullScreen}})]),e._v(" "),a("li",[a("img",{attrs:{src:"static/icon/downpdfChart.png",alt:"导出pdf",title:"导出pdf"},on:{click:e.downLoadPdf}})]),e._v(" "),a("li",[a("img",{attrs:{src:"static/icon/map.png",alt:"返回地图",title:"返回地图"},on:{click:e.goBackMap}})])])],1)},staticRenderFns:[]};var S=a("VU/8")(O,P,!1,function(e){a("VNEU")},null,null);t.default=S.exports}});
//# sourceMappingURL=36.caedbdf8f9e88200d152.js.map