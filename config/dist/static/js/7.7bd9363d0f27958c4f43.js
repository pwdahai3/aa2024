webpackJsonp([7],{HrHl:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=e("mtWM"),i=e.n(r),s=e("yJCr"),l=e("5reh"),o=e("qqiS"),n=e("Yg/C"),h={data:function(){return{aggregationXOptions:[{value:"date_histogram",label:"Date Histogram"}],aggregationYOptions:[{value:"count",label:"Count"},{value:"avg",label:"Average"},{value:"sum",label:"Sum"},{value:"min",label:"Min"},{value:"max",label:"Max"},{value:"cardinality",label:"Unique Count"}],fieldXOptions:[{value:"Data",disabled:!0},{value:"@timestamp"}],intervalOptions:[{value:"s",label:this.$t("lg.second")},{value:"m",label:this.$t("lg.minite")},{value:"h",label:this.$t("lg.hour")},{value:"d",label:this.$t("lg.day")},{value:"w",label:this.$t("lg.week")},{value:"M",label:this.$t("lg.month")},{value:"y",label:this.$t("lg.year")}],orderByOptions:[{value:"metric:Count"}],orderOptions:[{value:"desc",label:"Descending"},{value:"asc",label:"Ascending"}],areaChartForm:{aggregationX:"date_histogram",fieldX:"@timestamp",intervalNumX:"500",intervalUnitX:"s",intervalLimitAble:!1,orderByX:"metric:Count",sizeX:"5",orderX:"desc",areaChartYAxis:[{aggregationY:"",fieldY:""}]},areaChartFormRules:{aggregationX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],fieldX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],intervalNumX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"},{pattern:/^[0-9]+$/,message:this.$t("lg.requirepositive"),trigger:"change"}],orderByX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],sizeX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"},{pattern:/^[0-9]+$/,message:this.$t("lg.requirepositive"),trigger:"change"}],orderX:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}]},isSetChartShow:!1,setChartForm:{describeTxt:""},setChartFormRules:{describeTxt:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}]},setChartLoading:!1,myChartFlag:!1,itemParams:{}}},methods:{intervalLimit:function(t){"w"==t||"M"==t||"y"==t?(this.areaChartForm.intervalLimitAble=!0,this.areaChartForm.intervalNumX=1):this.areaChartForm.intervalLimitAble=!1},addItem:function(){this.areaChartForm.areaChartYAxis.push({aggregationY:"",fieldY:""})},deleteItem:function(t){1!=this.areaChartForm.areaChartYAxis.length&&this.areaChartForm.areaChartYAxis.splice(t,1)},aggregationYchange:function(t){this.areaChartForm.areaChartYAxis[t].fieldY=""},fieldYchange:function(t,a){this.$store.commit(l.d,a)},getAreaChartData:function(){var t=this;this.$refs.areaChartForm.validate(function(a){if(a){var e=t,r=(s.b,e.$store.state.mydatedata.starttime),i=e.$store.state.mydatedata.endtime,l=r.getTime(),o=i.getTime(),n=[];e.areaChartForm.areaChartYAxis.forEach(function(t){"count"!=t.aggregationY?n.push({agg:t.aggregationY,field:t.fieldY}):n.push({agg:t.aggregationY})});var h={timeRange:{from:l,to:o},x:{agg:e.areaChartForm.aggregationX,field:e.areaChartForm.fieldX,interval:e.areaChartForm.intervalNumX+e.areaChartForm.intervalUnitX,min_doc_count:1},y:n};e.myChartFlag=!0,e.itemParams=h}})},fatherChange:function(){this.myChartFlag=!1},showSetChart:function(){var t=this;this.$refs.areaChartForm.validate(function(a){a&&(t.isSetChartShow=!0)})},setChartClose:function(){this.isSetChartShow=!1,this.$refs.setChartForm.resetFields()},setAreaChartData:function(){var t=this;this.$refs.setChartForm.validate(function(a){if(a){var e=t;e.setChartLoading=!0;var r=s.b+"dp/es/datachart",l=e.$store.state.mydatedata.starttime,o=e.$store.state.mydatedata.endtime,n=l.getTime(),h=o.getTime(),g=[];e.areaChartForm.areaChartYAxis.forEach(function(t){"count"!=t.aggregationY?g.push({agg:t.aggregationY,field:t.fieldY}):g.push({agg:t.aggregationY})});var c={timeRange:{from:n,to:h},x:{agg:e.areaChartForm.aggregationX,field:e.areaChartForm.fieldX,interval:e.areaChartForm.intervalNumX+e.areaChartForm.intervalUnitX,min_doc_count:1},y:g};i.a.post(r,{chartType:"areaChart",description:e.setChartForm.describeTxt,params:c,title:"areaChart"}).then(function(a){console.log(a),0==a.data.responseCode?(t.$message({type:"success",message:e.$t("lg.success")}),e.setChartLoading=!1,e.setChartClose()):(e.$message.error(e.$t("lg.failed")+": "+a.data.data.message),e.setChartLoading=!1)}).catch(function(t){console.log(t)})}})}},components:{loading:o.a,areaPic:n.a}},g={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"lineChart-wrapper"},[e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:8}},[e("el-form",{ref:"areaChartForm",attrs:{model:t.areaChartForm,rules:t.areaChartFormRules,"label-width":"120px"}},[e("div",{staticClass:"form-bg"},[e("p",{staticClass:"chartformTitle"},[t._v("X-Axis")]),t._v(" "),e("el-form-item",{attrs:{label:"Aggregation",prop:"aggregationX"}},[e("el-select",{staticStyle:{width:"60%"},model:{value:t.areaChartForm.aggregationX,callback:function(a){t.$set(t.areaChartForm,"aggregationX",a)},expression:"areaChartForm.aggregationX"}},t._l(t.aggregationXOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),t.areaChartForm.aggregationX?e("el-form-item",{attrs:{label:"Field",prop:"fieldX"}},[e("el-select",{staticStyle:{width:"70%"},model:{value:t.areaChartForm.fieldX,callback:function(a){t.$set(t.areaChartForm,"fieldX",a)},expression:"areaChartForm.fieldX"}},t._l(t.fieldXOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.value,value:t.value,disabled:t.disabled}})}))],1):t._e(),t._v(" "),"date_histogram"==t.areaChartForm.aggregationX?e("div",[e("el-form-item",{attrs:{label:"Interval",prop:"intervalNumX"}},[e("el-input",{staticStyle:{width:"45%"},attrs:{placeholder:t.$t("lg.interval"),disabled:t.areaChartForm.intervalLimitAble},model:{value:t.areaChartForm.intervalNumX,callback:function(a){t.$set(t.areaChartForm,"intervalNumX","string"==typeof a?a.trim():a)},expression:"areaChartForm.intervalNumX"}}),t._v(" "),e("el-select",{staticStyle:{width:"35%"},attrs:{placeholder:t.$t("lg.select")},on:{change:function(a){t.intervalLimit(t.areaChartForm.intervalUnitX)}},model:{value:t.areaChartForm.intervalUnitX,callback:function(a){t.$set(t.areaChartForm,"intervalUnitX",a)},expression:"areaChartForm.intervalUnitX"}},t._l(t.intervalOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)],1):t._e()],1),t._v(" "),e("div",{staticClass:"form-bg"},[e("p",{staticClass:"chartformTitle"},[t._v("Y-Axis")]),t._v(" "),t._l(t.areaChartForm.areaChartYAxis,function(a,r){return e("div",{key:r,staticClass:"addItemBox"},[e("span",{staticClass:"delItemStyle",on:{click:function(a){t.deleteItem(r)}}},[e("i",{staticClass:"el-icon-close"})]),t._v(" "),e("el-form-item",{attrs:{label:"Aggregation",prop:"areaChartYAxis."+r+".aggregationY",rules:[{required:!0,message:t.$t("lg.required"),trigger:"blur"}]}},[e("el-select",{staticStyle:{width:"60%"},on:{change:function(a){t.aggregationYchange(r)}},model:{value:a.aggregationY,callback:function(e){t.$set(a,"aggregationY",e)},expression:"items.aggregationY"}},t._l(t.aggregationYOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a.aggregationY&&"count"!=a.aggregationY?e("el-form-item",{attrs:{label:"Field",prop:"areaChartYAxis."+r+".fieldY",rules:[{required:!0,message:t.$t("lg.required"),trigger:"blur"}]}},[e("el-select",{staticStyle:{width:"70%"},on:{"visible-change":function(e){t.fieldYchange(e,a.aggregationY)}},model:{value:a.fieldY,callback:function(e){t.$set(a,"fieldY",e)},expression:"items.fieldY"}},t._l(t.$store.state.fieldYOptions,function(t,a){return e("el-option",{key:a,attrs:{label:t.value,value:t.value,disabled:t.disabled}})}))],1):t._e()],1)}),t._v(" "),e("span",{staticClass:"addItemStyle",attrs:{title:t.$t("lg.addmoreyaxis")},on:{click:t.addItem}},[e("i",{staticClass:"el-icon-circle-plus-outline"})])],2),t._v(" "),e("div",{staticClass:"form-bg"},[e("el-button",{attrs:{size:"small",type:"primary",icon:"fa fa-play"},on:{click:t.getAreaChartData}},[t._v(" "+t._s(t.$t("lg.generateview")))]),t._v(" "),e("el-button",{attrs:{size:"small",type:"success",icon:"fa fa-cloud"},on:{click:t.showSetChart}},[t._v(" "+t._s(t.$t("lg.saverecord")))])],1)])],1),t._v(" "),e("el-col",{attrs:{span:16}},[e("div",{staticClass:"chartBox"},[e("area-pic",{attrs:{isShow:t.myChartFlag,itemParams:t.itemParams,isAreaChart:!0},on:{changeFlag:t.fatherChange}})],1),t._v(" "),e("router-link",{attrs:{to:"/chartMenu"}},[e("el-button",{staticClass:"backBtn el-icon-back",attrs:{size:"small",type:"info",plain:""}},[t._v(" "+t._s(t.$t("lg.back")))])],1)],1)],1),t._v(" "),e("el-dialog",{attrs:{title:t.$t("lg.saveviewrecord"),visible:t.isSetChartShow,width:"45%","before-close":t.setChartClose},on:{"update:visible":function(a){t.isSetChartShow=a}}},[e("el-form",{ref:"setChartForm",attrs:{model:t.setChartForm,rules:t.setChartFormRules,"label-width":"80px"}},[e("el-form-item",{attrs:{label:t.$t("lg.viewdesc"),prop:"describeTxt"}},[e("el-input",{attrs:{placeholder:t.$t("lg.description")},model:{value:t.setChartForm.describeTxt,callback:function(a){t.$set(t.setChartForm,"describeTxt","string"==typeof a?a.trim():a)},expression:"setChartForm.describeTxt"}})],1),t._v(" "),e("el-form-item",[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.setAreaChartData}},[t._v(" "+t._s(t.$t("lg.yes")))])],1)],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.setChartLoading,expression:"setChartLoading"}]},[e("loading",{attrs:{title:t.$t("lg.handling")}})],1)],1)],1)},staticRenderFns:[]};var c=e("VU/8")(h,g,!1,function(t){e("jZ5K")},"data-v-76f4c63c",null);a.default=c.exports},"Yg/C":function(t,a,e){"use strict";var r=e("fZjL"),i=e.n(r),s=e("mtWM"),l=e.n(s),o=(e("5reh"),e("yJCr")),n=e("XLwt"),h=e.n(n),g={props:{isShow:{type:Boolean},isAreaChart:{type:Boolean},itemParams:{type:Object}},data:function(){return{chartLoadingShow:!1,myChart:null,legendData:[],xAxisData:[],yAxisData:[]}},created:function(){this.isAreaChart||this.getAreaChartData()},mounted:function(){this.isAreaChart&&this.drawChart()},watch:{isShow:function(){var t=this;this.isShow?(this.getAreaChartData(),this.myChart&&(this.myChart.resize(),window.addEventListener("resize",function(){t.myChart.resize()}))):this.myChart&&this.myChart.clear()}},methods:{getAreaChartData:function(){var t=this;t.chartLoadingShow=!0;var a=o.b+"dp/es/datachart/process";console.log(t.itemParams),l.a.post(a,{chartType:"areaChart",description:"",params:t.itemParams,title:"areaChart"}).then(function(a){if(console.log(a),0==a.data.responseCode){var e=a.data.data.aggregations[2].buckets,r=[],s=[],l=[],o={},n=[],h=!1;t.itemParams.y.forEach(function(t,a){"count"==t.agg?h=!0:l.push(t.field+"("+t.agg+")")}),e.forEach(function(a){n.push(a.doc_count);var e=t.transformMyDate(a.key);-1==r.indexOf(e)&&r.push(e),i()(a).forEach(function(t){isNaN(t)||(o[t]?o[t].push(a[t].value):o[t]=[a[t].value])})}),l.forEach(function(t,a){s.push({name:t,type:"line",data:o[a+3],areaStyle:{opacity:"1"}})}),h&&(s.push({name:"count",type:"line",data:n,areaStyle:{opacity:"1"}}),l.push("count")),t.xAxisData=r,t.yAxisData=s,t.legendData=l,t.drawChart(),t.chartLoadingShow=!1}else t.$message.error(t.$t("lg.failed")+": "+a.data.data.message),t.chartLoadingShow=!1}).catch(function(a){console.log(a),t.chartLoadingShow=!1}),t.$emit("changeFlag",!1)},drawChart:function(){var t=document.getElementById("chartContainer");this.myChart=h.a.init(t);var a={title:{text:"Area Chart",left:"20",textStyle:{fontSize:"16",fontWeight:"normal",color:"#606266"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:this.legendData},grid:{left:"3%",right:"5%",top:"8%",bottom:"4%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:this.xAxisData},yAxis:{type:"value"},series:this.yAxisData};this.myChart.clear(),this.myChart.setOption(a)},transformMyDate:function(t){function a(t){return t<10?"0"+t:t}return(t=new Date(t)).getFullYear()+"-"+a(parseInt(t.getMonth())+1)+"-"+a(t.getDate())+" "+a(t.getHours())+":"+a(t.getMinutes())+":"+a(t.getSeconds())}}},c={render:function(){var t=this.$createElement,a=this._self._c||t;return a("div",[a("p",{staticClass:"nodataTxt"},[this.chartLoadingShow?a("span",[a("i",{staticClass:"el-icon-loading"}),this._v(" "+this._s(this.$t("lg.loading")))]):this._e(),0!=this.yAxisData.length||this.chartLoadingShow?this._e():a("span",[this._v(this._s(this.$t("lg.nodata")))])]),this._v(" "),a("div",{staticClass:"chartContainer",attrs:{id:"chartContainer"}})])},staticRenderFns:[]};var d=e("VU/8")(g,c,!1,function(t){e("uuJh")},"data-v-78b15d34",null);a.a=d.exports},jZ5K:function(t,a){},uuJh:function(t,a){}});
//# sourceMappingURL=7.7bd9363d0f27958c4f43.js.map