webpackJsonp([29],{"4Fmb":function(e,t){},AdWm:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});a("mtWM");var r=a("5reh"),s=a("gQxQ"),i=a("rBmc"),o=(a("yJCr"),{data:function(){return{behaviorform:{domain:"",url:"",multiple:"",counts:""},behaviorformRules:{domain:[{required:!0,message:this.$t("lg.inputdomain"),trigger:"blur"}],url:[],multiple:[{required:!0,message:this.$t("lg.inputtimefactor"),trigger:"blur"},{pattern:/^[0-9]+$/,message:this.$t("lg.requirepositive"),trigger:"change"}],counts:[{required:!0,message:this.$t("lg.inputcounts"),trigger:"blur"},{pattern:/^[0-9]+$/,message:this.$t("lg.requirepositive"),trigger:"change"}]},queryTimeData:[],queryTimeTreeProps:{children:"children",label:"label"},isShowTimingTask:!1}},methods:{getDomains:function(e){e&&(this.behaviorform.domain="",this.behaviorform.url="",this.$store.commit(r.b,!0))},getUrls:function(e){if(e){this.behaviorform.url="";var t=this.behaviorform.domain;this.$store.commit(r.c,{domain:t,flag:!0})}},getTokenTimeData:function(){var e=this;this.$refs.behaviorform.validate(function(t){if(t){var a=e,r=a.behaviorform.domain,o=a.behaviorform.url?'"'+a.behaviorform.url+'"':"*",n=a.behaviorform.multiple,l=a.behaviorform.counts,c=a.$store.state.mydatedata.starttime,m=a.$store.state.mydatedata.endtime,u=Object(i.a)(c),d=Object(i.a)(m),g=u||Object(i.a)(new Date(Date.now()-a.$store.state.dateTimeLong)),h=d||Object(i.a)(new Date);a.$store.state.contentLoading=!0,s.a.search({index:"shadow-filebeat*",body:{size:0,query:{bool:{filter:[{range:{"@timestamp":{gte:g,lte:h}}}],must:[{query_string:{query:"shadow.access.error_code:0"}},{query_string:{query:"shadow.access.response_code:200"}},{bool:{should:[{query_string:{query:"shadow.access.decrypted:1"}},{query_string:{query:"shadow.access.api_indicator:1"}}]}},{term:{"shadow.access.http_host":r}},{query_string:{query:"shadow.access.org_url:"+o}}],must_not:[{match:{"shadow.access.token":"00000000000000000000000000000000"}},{match:{"shadow.access.token":"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"}}]}},aggs:{GroupByUrl:{terms:{field:"shadow.access.org_url",size:500},aggs:{GroupByToken:{terms:{field:"shadow.access.token",size:500},aggs:{avg_starttime:{avg:{field:"shadow.access.send_time"}},avg_endtime:{avg:{field:"shadow.access.rec_time"}},avg_time:{bucket_script:{buckets_path:{avg_starttime:"avg_starttime",avg_endtime:"avg_endtime"},script:"params.avg_endtime-params.avg_starttime"}},suspects:{scripted_metric:{init_script:"params._agg.suspects=[]",map_script:"params._agg.suspects.add(Long.parseLong(params._source.shadow.access.rec_time)-Long.parseLong(params._source.shadow.access.send_time))",combine_script:"ArrayList list=new ArrayList();for(s in params._agg.suspects){list.add(s);}return list",reduce_script:"double total_time=0;int length=0;for(a in params._aggs){for(i in a){total_time+=i;length+=1;}}double avg_time=total_time/length;int count=0;for(a in params._aggs){for(i in a){if(i>(avg_time*"+n+")){count+=1;}}}if(count>="+l+"){return count;}else{return null;}"}}}}}}}}}).then(function(e){var t=[];e.aggregations.GroupByUrl.buckets.forEach(function(e){var a={label:e.key,children:[]};e.GroupByToken.buckets.forEach(function(e){e.suspects.value&&a.children.push({label:e.key,counts:e.doc_count,avgTime:(e.avg_time.value/1e3).toFixed(2),suspects:e.suspects.value})}),a.children.length>0&&t.push(a)}),a.queryTimeData=t,a.$store.state.contentLoading=!1})}})},queryTimeRenderContent:function(e,t){var a=t.node,r=t.data;t.store;return r.children?e("span",{class:"my-tree-node"},[e("span",null,[a.label])]):e("p",{class:"my-tree-node"},[e("span",null,["浏览器指纹：",a.label,"，其平均访问时间为：",r.avgTime,"秒，访问次数为：",r.counts,"次"])])}},components:{timingTaskPop:a("1r8X").a}}),n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"behavior-wrapper"},[a("h2",{staticClass:"breadcrumb"},[e._v(e._s(e.$t("lg.jiyushijiang")))]),e._v(" "),a("el-form",{ref:"behaviorform",staticClass:"form-bg",staticStyle:{"padding-bottom":"0"},attrs:{model:e.behaviorform,rules:e.behaviorformRules,"label-width":"0"}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"grid-content"},[a("el-form-item",{attrs:{prop:"domain"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("lg.selectdomain"),loading:e.$store.state.getEsDomainArrLoading},on:{"visible-change":function(t){e.getDomains(t)}},model:{value:e.behaviorform.domain,callback:function(t){e.$set(e.behaviorform,"domain",t)},expression:"behaviorform.domain"}},[e._l(e.$store.state.esDomainArr,function(e){return[a("el-option",{key:e.key,attrs:{label:e.key,value:e.key}})]})],2)],1)],1)]),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content"},[a("el-form-item",{attrs:{prop:"url"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("lg.selecturl"),clearable:"",loading:e.$store.state.getEsUrlArrLoading},on:{"visible-change":function(t){e.getUrls(t)}},model:{value:e.behaviorform.url,callback:function(t){e.$set(e.behaviorform,"url",t)},expression:"behaviorform.url"}},[e._l(e.$store.state.esUrlArr,function(e){return[a("el-option",{key:e.key,attrs:{label:e.key,value:e.key}})]})],2)],1)],1)]),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content"},[a("el-form-item",{attrs:{prop:"multiple"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("lg.timefactor")},model:{value:e.behaviorform.multiple,callback:function(t){e.$set(e.behaviorform,"multiple",t)},expression:"behaviorform.multiple"}})],1)],1)]),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content"},[a("el-form-item",{attrs:{prop:"counts"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("lg.counts")},model:{value:e.behaviorform.counts,callback:function(t){e.$set(e.behaviorform,"counts",t)},expression:"behaviorform.counts"}})],1)],1)]),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content"},[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.getTokenTimeData}},[e._v(e._s(e.$t("lg.query")))])],1)])],1)],1),e._v(" "),a("div",{staticClass:"myTreeBox"},[a("el-tree",{ref:"tree",attrs:{data:e.queryTimeData,props:e.queryTimeTreeProps,"render-content":e.queryTimeRenderContent}})],1),e._v(" "),a("div",{staticClass:"text-right"},[a("el-button",{attrs:{type:"success",icon:"el-icon-time"},on:{click:function(t){e.isShowTimingTask=!0}}},[e._v(e._s(e.$t("lg.arrangealerting")))])],1),e._v(" "),a("timing-task-pop",{attrs:{isShow:e.isShowTimingTask,myTaskType:"tokenTime",myTaskTypeTxt:e.$t("lg.tokentimebased")},on:{setTimingTaskClose:function(t){e.isShowTimingTask=!1}}})],1)},staticRenderFns:[]};var l=a("VU/8")(o,n,!1,function(e){a("4Fmb")},null,null);t.default=l.exports}});
//# sourceMappingURL=29.166a1f26f03626b9eee2.js.map