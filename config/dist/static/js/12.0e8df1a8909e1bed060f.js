webpackJsonp([12],{"4nFv":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=e("mtWM"),i=e.n(r),l=e("yJCr"),s=e("5reh"),o=e("qqiS"),n=e("zk15"),c={data:function(){return{aggregationXOptions:[{value:"date_histogram",label:"Date Histogram"}],aggregationYOptions:[{value:"count",label:"Count"},{value:"avg",label:"Average"},{value:"sum",label:"Sum"},{value:"min",label:"Min"},{value:"max",label:"Max"},{value:"cardinality",label:"Unique Count"}],fieldXOptions:[{value:"Data",disabled:!0},{value:"@timestamp"}],intervalOptions:[{value:"s",label:this.$t("lg.second")},{value:"m",label:this.$t("lg.minite")},{value:"h",label:this.$t("lg.hour")},{value:"d",label:this.$t("lg.day")},{value:"w",label:this.$t("lg.week")},{value:"M",label:this.$t("lg.month")},{value:"y",label:this.$t("lg.year")}],orderByOptions:[{value:"metric:Count"}],orderOptions:[{value:"desc",label:"Descending"},{value:"asc",label:"Ascending"}],verticalBarChartForm:{aggregationX:"date_histogram",fieldX:"@timestamp",intervalNumX:"500",intervalUnitX:"s",intervalLimitAble:!1,orderByX:"metric:Count",sizeX:"5",orderX:"desc",verticalBarChartYAxis:[{aggregationY:"",fieldY:""}]},verticalBarChartFormRules:{aggregationX:[{required:!0,message:"不能为空",trigger:"blur"}],fieldX:[{required:!0,message:"不能为空",trigger:"blur"}],intervalNumX:[{required:!0,message:"不能为空",trigger:"blur"},{pattern:/^[0-9]+$/,message:this.$t("lg.requirepositive"),trigger:"change"}],orderByX:[{required:!0,message:"不能为空",trigger:"blur"}],sizeX:[{required:!0,message:"不能为空",trigger:"blur"},{pattern:/^[0-9]+$/,message:this.$t("lg.requirepositive"),trigger:"change"}],orderX:[{required:!0,message:"不能为空",trigger:"blur"}]},isSetChartShow:!1,setChartForm:{describeTxt:""},setChartFormRules:{describeTxt:[{required:!0,message:"不能为空",trigger:"blur"}]},setChartLoading:!1,myChartFlag:!1,itemParams:{}}},methods:{intervalLimit:function(t){"w"==t||"M"==t||"y"==t?(this.verticalBarChartForm.intervalLimitAble=!0,this.verticalBarChartForm.intervalNumX=1):this.verticalBarChartForm.intervalLimitAble=!1},addItem:function(){this.verticalBarChartForm.verticalBarChartYAxis.push({aggregationY:"",fieldY:""})},deleteItem:function(t){1!=this.verticalBarChartForm.verticalBarChartYAxis.length&&this.verticalBarChartForm.verticalBarChartYAxis.splice(t,1)},aggregationYchange:function(t){this.verticalBarChartForm.verticalBarChartYAxis[t].fieldY=""},fieldYchange:function(t,a){this.$store.commit(s.d,a)},getVerticalBarChartData:function(){var t=this;this.$refs.verticalBarChartForm.validate(function(a){if(a){var e=t,r=(l.b,e.$store.state.mydatedata.starttime),i=e.$store.state.mydatedata.endtime,s=r.getTime(),o=i.getTime(),n=[];e.verticalBarChartForm.verticalBarChartYAxis.forEach(function(t){"count"!=t.aggregationY?n.push({agg:t.aggregationY,field:t.fieldY}):n.push({agg:t.aggregationY})});var c={timeRange:{from:s,to:o},x:{agg:e.verticalBarChartForm.aggregationX,field:e.verticalBarChartForm.fieldX,interval:e.verticalBarChartForm.intervalNumX+e.verticalBarChartForm.intervalUnitX,min_doc_count:1},y:n};e.myChartFlag=!0,e.itemParams=c}})},fatherChange:function(){this.myChartFlag=!1},showSetChart:function(){var t=this;this.$refs.verticalBarChartForm.validate(function(a){a&&(t.isSetChartShow=!0)})},setChartClose:function(){this.isSetChartShow=!1,this.$refs.setChartForm.resetFields()},setVerticalBarChartData:function(){var t=this;this.$refs.setChartForm.validate(function(a){if(a){var e=t;e.setChartLoading=!0;var r=l.b+"dp/es/datachart",s=e.$store.state.mydatedata.starttime,o=e.$store.state.mydatedata.endtime,n=s.getTime(),c=o.getTime(),h=[];e.verticalBarChartForm.verticalBarChartYAxis.forEach(function(t){"count"!=t.aggregationY?h.push({agg:t.aggregationY,field:t.fieldY}):h.push({agg:t.aggregationY})});var g={timeRange:{from:n,to:c},x:{agg:e.verticalBarChartForm.aggregationX,field:e.verticalBarChartForm.fieldX,interval:e.verticalBarChartForm.intervalNumX+e.verticalBarChartForm.intervalUnitX,min_doc_count:1},y:h};i.a.post(r,{chartType:"verticalBarChart",description:e.setChartForm.describeTxt,params:g,title:"verticalBarChart"}).then(function(a){console.log(a),0==a.data.responseCode?(t.$message({type:"success",message:e.$t("lg.success")}),e.setChartLoading=!1,e.setChartClose()):(e.$message.error(e.$t("lg.failed")+": "+a.data.data.message),e.setChartLoading=!1)}).catch(function(t){console.log(t)})}})}},components:{loading:o.a,verticalBarPic:n.a}},h={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"verticalBarChart-wrapper"},[e("el-row",{attrs:{gutter:10}},[e("el-col",{attrs:{span:8}},[e("el-form",{ref:"verticalBarChartForm",attrs:{model:t.verticalBarChartForm,rules:t.verticalBarChartFormRules,"label-width":"120px"}},[e("div",{staticClass:"form-bg"},[e("p",{staticClass:"chartformTitle"},[t._v("X-Axis")]),t._v(" "),e("el-form-item",{attrs:{label:"Aggregation",prop:"aggregationX"}},[e("el-select",{staticStyle:{width:"60%"},model:{value:t.verticalBarChartForm.aggregationX,callback:function(a){t.$set(t.verticalBarChartForm,"aggregationX",a)},expression:"verticalBarChartForm.aggregationX"}},t._l(t.aggregationXOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),t.verticalBarChartForm.aggregationX?e("el-form-item",{attrs:{label:"Field",prop:"fieldX"}},[e("el-select",{staticStyle:{width:"70%"},model:{value:t.verticalBarChartForm.fieldX,callback:function(a){t.$set(t.verticalBarChartForm,"fieldX",a)},expression:"verticalBarChartForm.fieldX"}},t._l(t.fieldXOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.value,value:t.value,disabled:t.disabled}})}))],1):t._e(),t._v(" "),"date_histogram"==t.verticalBarChartForm.aggregationX?e("div",[e("el-form-item",{attrs:{label:"Interval",prop:"intervalNumX"}},[e("el-input",{staticStyle:{width:"45%"},attrs:{placeholder:t.$t("lg.interval"),disabled:t.verticalBarChartForm.intervalLimitAble},model:{value:t.verticalBarChartForm.intervalNumX,callback:function(a){t.$set(t.verticalBarChartForm,"intervalNumX","string"==typeof a?a.trim():a)},expression:"verticalBarChartForm.intervalNumX"}}),t._v(" "),e("el-select",{staticStyle:{width:"35%"},attrs:{placeholder:t.$t("lg.select")},on:{change:function(a){t.intervalLimit(t.verticalBarChartForm.intervalUnitX)}},model:{value:t.verticalBarChartForm.intervalUnitX,callback:function(a){t.$set(t.verticalBarChartForm,"intervalUnitX",a)},expression:"verticalBarChartForm.intervalUnitX"}},t._l(t.intervalOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)],1):t._e()],1),t._v(" "),e("div",{staticClass:"form-bg"},[e("p",{staticClass:"chartformTitle"},[t._v("Y-Axis")]),t._v(" "),t._l(t.verticalBarChartForm.verticalBarChartYAxis,function(a,r){return e("div",{key:r,staticClass:"addItemBox"},[e("span",{staticClass:"delItemStyle",on:{click:function(a){t.deleteItem(r)}}},[e("i",{staticClass:"el-icon-close"})]),t._v(" "),e("el-form-item",{attrs:{label:"Aggregation",prop:"verticalBarChartYAxis."+r+".aggregationY",rules:[{required:!0,message:"不能为空",trigger:"blur"}]}},[e("el-select",{staticStyle:{width:"60%"},on:{change:function(a){t.aggregationYchange(r)}},model:{value:a.aggregationY,callback:function(e){t.$set(a,"aggregationY",e)},expression:"items.aggregationY"}},t._l(t.aggregationYOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a.aggregationY&&"count"!=a.aggregationY?e("el-form-item",{attrs:{label:"Field",prop:"verticalBarChartYAxis."+r+".fieldY",rules:[{required:!0,message:"不能为空",trigger:"blur"}]}},[e("el-select",{staticStyle:{width:"70%"},on:{"visible-change":function(e){t.fieldYchange(e,a.aggregationY)}},model:{value:a.fieldY,callback:function(e){t.$set(a,"fieldY",e)},expression:"items.fieldY"}},t._l(t.$store.state.fieldYOptions,function(t,a){return e("el-option",{key:a,attrs:{label:t.value,value:t.value,disabled:t.disabled}})}))],1):t._e()],1)}),t._v(" "),e("span",{staticClass:"addItemStyle",attrs:{title:t.$t("lg.addmoreyaxis")},on:{click:t.addItem}},[e("i",{staticClass:"el-icon-circle-plus-outline"})])],2),t._v(" "),e("div",{staticClass:"form-bg"},[e("el-button",{attrs:{size:"small",type:"primary",icon:"fa fa-play"},on:{click:t.getVerticalBarChartData}},[t._v(" "+t._s(t.$t("lg.generateview")))]),t._v(" "),e("el-button",{attrs:{size:"small",type:"success",icon:"fa fa-cloud"},on:{click:t.showSetChart}},[t._v(" "+t._s(t.$t("lg.saverecord")))])],1)])],1),t._v(" "),e("el-col",{attrs:{span:16}},[e("div",{staticClass:"chartBox"},[e("vertical-bar-pic",{attrs:{isShow:t.myChartFlag,itemParams:t.itemParams,isVerticalBarChart:!0},on:{changeFlag:t.fatherChange}})],1),t._v(" "),e("router-link",{attrs:{to:"/chartMenu"}},[e("el-button",{staticClass:"backBtn el-icon-back",attrs:{size:"small",type:"info",plain:""}},[t._v(" "+t._s(t.$t("lg.back")))])],1)],1)],1),t._v(" "),e("el-dialog",{attrs:{title:t.$t("lg.saveviewrecord"),visible:t.isSetChartShow,width:"45%","before-close":t.setChartClose},on:{"update:visible":function(a){t.isSetChartShow=a}}},[e("el-form",{ref:"setChartForm",attrs:{model:t.setChartForm,rules:t.setChartFormRules,"label-width":"80px"}},[e("el-form-item",{attrs:{label:t.$t("lg.viewdesc"),prop:"describeTxt"}},[e("el-input",{attrs:{placeholder:t.$t("lg.description")},model:{value:t.setChartForm.describeTxt,callback:function(a){t.$set(t.setChartForm,"describeTxt","string"==typeof a?a.trim():a)},expression:"setChartForm.describeTxt"}})],1),t._v(" "),e("el-form-item",[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.setVerticalBarChartData}},[t._v(" "+t._s(t.$t("lg.yes")))])],1)],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.setChartLoading,expression:"setChartLoading"}]},[e("loading",{attrs:{title:t.$t("lg.handling")}})],1)],1)],1)},staticRenderFns:[]};var g=e("VU/8")(c,h,!1,function(t){e("ahZN")},"data-v-2d5e161b",null);a.default=g.exports},ahZN:function(t,a){},vkMs:function(t,a){},zk15:function(t,a,e){"use strict";var r=e("fZjL"),i=e.n(r),l=e("mtWM"),s=e.n(l),o=(e("5reh"),e("yJCr")),n=e("XLwt"),c=e.n(n),h={props:{isShow:{type:Boolean},isVerticalBarChart:{type:Boolean},itemParams:{type:Object}},data:function(){return{chartLoadingShow:!1,myChart:null,legendData:[],xAxisData:[],yAxisData:[]}},created:function(){this.isVerticalBarChart||this.getVerticalBarChartData()},mounted:function(){this.isVerticalBarChart&&this.drawChart()},watch:{isShow:function(){var t=this;this.isShow?(this.getVerticalBarChartData(),this.myChart&&(this.myChart.resize(),window.addEventListener("resize",function(){t.myChart.resize()}))):this.myChart&&this.myChart.clear()}},methods:{getVerticalBarChartData:function(){var t=this;t.chartLoadingShow=!0;var a=o.b+"dp/es/datachart/process";console.log(t.itemParams),s.a.post(a,{chartType:"verticalBarChart",description:"",params:t.itemParams,title:"verticalBarChart"}).then(function(a){if(console.log(a),0==a.data.responseCode){var e=a.data.data.aggregations[2].buckets,r=[],l=[],s=[],o={},n=[],c=!1;t.itemParams.y.forEach(function(t,a){"count"==t.agg?c=!0:s.push(t.field+"("+t.agg+")")}),e.forEach(function(a){n.push(a.doc_count);var e=t.transformMyDate(a.key);-1==r.indexOf(e)&&r.push(e),i()(a).forEach(function(t){isNaN(t)||(o[t]?o[t].push(a[t].value):o[t]=[a[t].value])})}),s.forEach(function(t,a){l.push({name:t,type:"bar",data:o[a+3]})}),console.log(o),console.log(s),c&&(l.push({name:"count",type:"bar",data:n}),s.push("count")),t.xAxisData=r,t.yAxisData=l,t.legendData=s,t.drawChart(),t.chartLoadingShow=!1}else t.$message.error(t.$t("lg.failed")+": "+a.data.data.message),t.chartLoadingShow=!1}).catch(function(a){console.log(a),t.chartLoadingShow=!1}),t.$emit("changeFlag",!1)},drawChart:function(){var t=document.getElementById("chartContainer");this.myChart=c.a.init(t);var a={title:{text:"Vertical Bar Chart",left:"20",textStyle:{fontSize:"16",fontWeight:"normal",color:"#606266"}},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:this.legendData},grid:{left:"3%",right:"5%",top:"8%",bottom:"4%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:this.xAxisData},yAxis:{type:"value"},series:this.yAxisData};this.myChart.clear(),this.myChart.setOption(a)},transformMyDate:function(t){function a(t){return t<10?"0"+t:t}return(t=new Date(t)).getFullYear()+"-"+a(parseInt(t.getMonth())+1)+"-"+a(t.getDate())+" "+a(t.getHours())+":"+a(t.getMinutes())+":"+a(t.getSeconds())}}},g={render:function(){var t=this.$createElement,a=this._self._c||t;return a("div",[a("p",{staticClass:"nodataTxt"},[this.chartLoadingShow?a("span",[a("i",{staticClass:"el-icon-loading"}),this._v(" "+this._s(this.$t("lg.loading")))]):this._e(),0!=this.yAxisData.length||this.chartLoadingShow?this._e():a("span",[this._v(this._s(this.$t("lg.nodata")))])]),this._v(" "),a("div",{staticClass:"chartContainer",attrs:{id:"chartContainer"}})])},staticRenderFns:[]};var d=e("VU/8")(h,g,!1,function(t){e("vkMs")},"data-v-ca7777dc",null);a.a=d.exports}});
//# sourceMappingURL=12.0e8df1a8909e1bed060f.js.map