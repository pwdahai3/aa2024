webpackJsonp([28],{n6n0:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("fZjL"),i=a.n(o),s=a("mvHQ"),r=a.n(s),n=a("Gu7T"),l=a.n(n),d=a("mtWM"),c=a.n(d),g=a("yJCr"),h=a("XLwt"),u=a.n(h),m=a("5reh"),p=a("gQxQ"),f=a("T+n0"),b=a("rBmc"),v=a("HFmO"),y=a("0aWm"),w=a("GfiX"),C=a("7uT9"),x=a("EjLO"),_=a("ufP2"),L=a("InnB"),k={mixins:[_.a],components:{pienodata:y.a,queryPanel:v.a,logRebuild:C.a,logTables:x.a},data:function(){return{forFastShow:!1,fromTime:0,endTime:0,fromTimeUTC:0,endTimeUTC:0,timeinterval:"",isFalg:!1,checkDomain:"",checkUrl:"",filterObj:{match_all:{}},wholeCtMax:0,wholeCtMin:0,normalCtMax:0,normalCtMin:0,businessLineLoading:!1,urlAtckCtLoading:!1,attackTypeLoading:!1,orgIpLineLoading:!1,orgIpPieLoading:!1,domainLineLoading:!1,domainPieLoading:!1,regionBarLoading:!1,businessLineChart:null,urlAtckCtBarChart:null,attackTypeChart:null,orgIpLineChart:null,orgIpPieChart:null,domainLineChart:null,domainPieChart:null,regionBarChart:null,businessNodata:!1,urlAtckCtBarNodata:!1,attackTypeNodata:!1,orgIpLineNodata:!1,orgIpPieNodata:!1,domainLineNodata:!1,domainPieNodata:!1,regionBarNodata:!1,totalNum:0,attackSumNum:0,popQueryObj:{bool:{must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}}]}},logDialogVisible:!1,logDialogTitle:"",tableKeyArrWaf:[].concat(l()(w.a.waf)),chartLogsHeadData:[],chartLogsBodyData:[],chartLogsTotalNum:0,fromPage:0,pageSize:10,requeryObj:null,isShowQueryPanel:!0,isShowGridMenu:!0}},created:function(){var t=this;this.getCustomHeadData(),window.addEventListener("resize",function(){t.urlAtckCtBarChart.resize(),t.attackTypeChart.resize(),t.orgIpLineChart.resize(),t.orgIpPieChart.resize(),t.domainLineChart.resize(),t.domainPieChart.resize(),t.businessLineChart.resize(),t.regionBarChart.resize()})},watch:{"$store.state.mydatedata.timestampnow":function(){this.handleTime(),this.getAllchart()},"$store.state.isMenuShow":function(){this.urlAtckCtBarChart.resize(),this.attackTypeChart.resize(),this.orgIpLineChart.resize(),this.orgIpPieChart.resize(),this.domainLineChart.resize(),this.domainPieChart.resize(),this.forFastShow&&this.businessLineChart.resize(),this.regionBarChart.resize()}},mounted:function(){this.$route.query.timeInterval||(this.handleTime(),this.getAllchart())},methods:{forfastloadmore:function(){var t=this;this.forFastShow=!0,this.$nextTick(function(){t.drawBusinessLine()})},getAllchart:function(t){t&&(this.isFalg=t.isQuery,this.checkDomain=t.domainName,this.checkUrl=t.urlArr,this.filterObj=this.getFilterObjWAF(this.isFalg)),this.forFastShow&&this.drawBusinessLine(),this.getRequestNum(this.isFalg),this.attackSum(),this.drawUrlAtckCtBar(),this.drawAttackTypePie(),this.drawOrgIpLine(),this.drawOrgIpPie(),this.drawDomainLine(),this.drawDomainPie(),this.drawRegionBar()},getFilterObjWAF:function(t,e){var a={match_all:{}},o="shadow.waf.host:",i="shadow.waf.uri:";if(e&&(o="shadow.access.domain:",i="shadow.access.org_url:"),t){var s=this.checkDomain,r=this.checkUrl;if(a={bool:{must:[{query_string:{query:o+'"'+s+'"'}}]}},r){var n=r.replace(/(\/)+/g,"\\$1");a.bool.must.push({query_string:{query:i+'"'+n+'"'}})}}else a={match_all:{}};return a},handleTime:function(){var t=this.$store.state.mydatedata.starttime,e=this.$store.state.mydatedata.endtime,a=Object(f.a)(t),o=Object(f.a)(e),i=a||Object(f.a)(new Date(Date.now()-this.$store.state.dateTimeLong)),s=o||Object(f.a)(new Date);this.fromTime=i,this.endTime=s;var r=Object(b.a)(t),n=Object(b.a)(e),l=r||Object(b.a)(new Date(Date.now()-this.$store.state.dateTimeLong)),d=n||Object(b.a)(new Date);this.fromTimeUTC=l,this.endTimeUTC=d,this.timeinterval=this.$store.state.mydatedata.interval||"5m"},getCustomHeadData:function(){var t=this,e=g.b+"/pe/shadow/kv/attackChartWaf";c.a.get(e).then(function(e){e.data.data?t.chartLogsHeadData=e.data.data.value:t.chartLogsHeadData=[].concat(l()(w.a.waf))})},drawBusinessLine:function(){var t=this;t.businessLineLoading=!0;var e=document.getElementById("businessContainer");t.businessLineChart=u.a.init(e),t.businessLineChart.off("brushSelected");var a=!1;e.addEventListener("mousedown",function(){a=!1}),e.addEventListener("mouseup",function(){a=!0});var o={color:["#27727b","#d95850"],title:{text:t.$t("lg.attackbusinessprotect"),x:"left",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow",label:{show:!0}}},legend:{top:"20px",data:[t.$t("lg.totalrequests"),t.$t("lg.gongji")],itemGap:5},grid:{left:"5%",right:"3%",bottom:"4%",top:"20%",containLabel:!0},brush:{toolbox:["lineX"],xAxisIndex:"all",transformable:!1,throttleType:"debounce",throttleDelay:1e3,brushStyle:{borderWidth:0}},toolbox:{right:"20",top:"10"},xAxis:{show:!1,data:[]},yAxis:{show:!1,name:t.$t("lg.counts")},series:[]};p.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{filter:t.filterObj,must:[{term:{"log.file.path":"/usr/local/shadow/logs/access.log"}},{exists:{field:"shadow.access.method"}},{range:{"@timestamp":{from:t.fromTimeUTC,to:t.endTimeUTC,include_lower:!0,include_upper:!0}}}]}},aggs:{time_histo:{date_histogram:{field:"@timestamp",interval:t.timeinterval,extended_bounds:{min:t.fromTimeUTC,max:t.endTimeUTC}}}}}}).then(function(e){for(var i=e.aggregations?e.aggregations.time_histo.buckets:[],s=[],r=[],n=[],l=[],d=0;d<i.length;d++){var c=i[d],g=c.doc_count;0!=g&&l.push(g),g||(g=0),s.push(g),r.push(t.transformMyDate(c.key))}l.sort(function(t,e){return t-e}),t.wholeCtMin=l[0]||0,t.wholeCtMax=l[l.length-1]||0,n.push({name:t.$t("lg.totalrequests"),type:"bar",data:s,barMaxWidth:10,large:!0}),p.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{filter:t.filterObj,must_not:{exists:{field:"error"}},must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}},{range:{"@timestamp":{from:t.fromTime,to:t.endTime,include_lower:!0,include_upper:!0}}}]}},aggs:{time_histo:{date_histogram:{field:"@timestamp",interval:t.timeinterval,extended_bounds:{min:t.fromTime,max:t.endTime}}}}}}).then(function(e){var i=e.aggregations?e.aggregations.time_histo.buckets:[],s=[],l=[];0==i.length?(o.xAxis.show=!1,o.yAxis.show=!1,t.businessNodata=!0):(o.xAxis.show=!0,o.yAxis.show=!0,t.businessNodata=!1);for(var d=0;d<i.length;d++){var c=i[d].doc_count;0!=c&&l.push(c),c||(c=0),s.push(c)}l.sort(function(t,e){return t-e}),t.normalCtMin=l[0]||0,t.normalCtMax=l[l.length-1]||0,n.push({name:t.$t("lg.gongji"),type:"bar",data:s,barMaxWidth:10,large:!0}),o.xAxis.data=r,o.series=n,t.businessLineChart.setOption(o,!0),t.businessLineLoading=!1,t.businessLineChart.on("brushSelected",function(e){if(a&&e.batch&&e.batch[0].areas[0]){var o="-0"==e.batch[0].areas[0].coordRange[0]||e.batch[0].areas[0].coordRange[0]<0?0:e.batch[0].areas[0].coordRange[0],i=e.batch[0].areas[0].coordRange[1],s=r[o],n=r[i]?r[i]:r[i-1];if(s==n){var l=new Date(s).getTime(),d=new Date(n).getTime();"5m"==t.$store.state.mydatedata.interval?(l-=3e5,d+=3e5):"10s"==t.$store.state.mydatedata.interval?(l-=1e4,d+=1e4):t.$store.state.mydatedata.interval,s=t.transformMyDate(l),n=t.transformMyDate(d)}t.$store.state.nowTimeVal=[new Date(s),new Date(n)],clearTimeout(t.$store.state.refreshTimeout),t.$store.state.refreshAble=!0,setTimeout(function(){t.$store.commit(m.j)},0)}})})})},getRequestNum:function(t){var e=this,a=e.getFilterObjWAF(t,!0);p.a.search({index:"shadow-filebeat-*",body:{track_total_hits:!0,sort:{"@timestamp":"desc"},query:{bool:{filter:a,must:[{term:{"log.file.path":"/usr/local/shadow/logs/access.log"}},{exists:{field:"shadow.access.method"}},{range:{"@timestamp":{from:e.fromTimeUTC,to:e.endTimeUTC,include_lower:!0,include_upper:!0}}}]}}}}).then(function(t){e.totalNum=t.hits.total.value})},attackSum:function(){var t=this;p.a.search({index:"shadow-filebeat-*",body:{track_total_hits:!0,query:{bool:{filter:t.filterObj,must_not:{exists:{field:"error"}},must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}},{range:{"@timestamp":{from:t.fromTime,to:t.endTime,include_lower:!0,include_upper:!0}}}]}}}}).then(function(e){t.attackSumNum=e.hits.total.value})},drawUrlAtckCtBar:function(){var t=this;t.urlAtckCtLoading=!0,t.urlAtckCtBarChart=u.a.init(document.getElementById("urlAtckCtContainer"));var e={normal:{show:!0,rotate:0,align:"left",verticalAlign:"middle",position:"insideLeft",distance:10,formatter:function(t){return t.data.name},fontSize:12}},a={color:["#c1232b"],title:{text:t.$t("lg.numattacktop10"),x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{show:!1,trigger:"axis",confine:!0,axisPointer:{type:"shadow"},extraCssText:"white-space:normal;word-break: break-all",formatter:function(e,a,o){var i="";return e.forEach(function(e){i=e.data.name+t.$t("lg.numattackis")+":"+e.data.value+t.$t("lg.count")}),i}},grid:{top:"12%",left:"0",right:"50",bottom:"2%",containLabel:!0},xAxis:{show:!1,type:"value",name:t.$t("lg.counts"),boundaryGap:[0,.01],position:"top",splitLine:{show:!1},minInterval:1},yAxis:{show:!1,type:"category",data:[],inverse:!0},series:[]};p.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{filter:t.filterObj,must_not:{exists:{field:"error"}},must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}},{range:{"@timestamp":{gte:t.fromTime,lte:t.endTime}}}]}},aggs:{url:{terms:{field:"shadow.waf.uri",size:10}}}}}).then(function(o){for(var i=o.aggregations?o.aggregations.url.buckets:[],s=[],r=i.length,n=0;n<r;n++)s.push("top"+(n+1));a.yAxis.data=s;var l=[];for(n=0;n<s.length;n++)i[n]?l.push({value:i[n].doc_count,name:i[n].key}):l.push({name:"-",value:"-"});a.series=[{type:"bar",label:e,data:l,barMaxWidth:30}],0==i.length?(a.xAxis.show=!1,a.yAxis.show=!1,a.tooltip.show=!1,t.urlAtckCtBarNodata=!0):(a.xAxis.show=!0,a.yAxis.show=!0,a.tooltip.show=!0,t.urlAtckCtBarNodata=!1),t.urlAtckCtBarChart.setOption(a,!0),t.urlAtckCtLoading=!1,t.urlAtckCtBarChart.off("click"),t.urlAtckCtBarChart.on("click",function(e){t.logDialogVisible=!0,t.logDialogTitle=e.name,t.popQueryObj.bool.filter=t.filterObj,t.popQueryObj.bool.must.push({query_string:{query:"shadow.waf.uri:"+t.logDialogTitle.replace(/\//g,"\\/")}}),t.getOnepieceFromPie()})})},drawAttackTypePie:function(){var t=this;t.attackTypeLoading=!0,t.attackTypeChart=u.a.init(document.getElementById("attackTypeContainer"));var e={color:["#e87c25","#b5c334","#fe8463","#9bca63","#f3a43b","#60c0dd","#d7504b","#f0805a","#26c0c0"],title:{text:t.$t("lg.numattacktypetop10"),x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:t.$t("lg.attacktype"),type:"pie",radius:["25%","35%"],data:[].sort(function(t,e){return t.value-e.value}),label:{position:"outside",normal:{textStyle:{fontSize:"12"},formatter:"{b}: {c}"},emphasis:{show:!0,textStyle:{fontSize:"14",fontWeight:"normal"}}},labelLine:{normal:{smooth:0,length:10,length2:20}},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(t){return 200*Math.random()}}]};p.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{filter:t.filterObj,must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}},{range:{"@timestamp":{gte:t.fromTime,lte:t.endTime}}}]}},aggs:{attacktype:{terms:{field:"shadow.waf.attacktype",size:10}}}}}).then(function(a){for(var o=a.aggregations?a.aggregations.attacktype.buckets:[],i=[],s=[],r=0;r<o.length;r++){var n=o[r];i.push({value:n.doc_count,name:n.key}),s.push(n.key)}e.series[0].data=i,0==i.length?t.attackTypeNodata=!0:t.attackTypeNodata=!1,t.attackTypeChart.setOption(e,!0),t.attackTypeLoading=!1,t.attackTypeChart.off("click"),t.attackTypeChart.on("click",function(e){t.logDialogVisible=!0,t.logDialogTitle=e.name,t.popQueryObj.bool.filter=t.filterObj,t.popQueryObj.bool.must.push({query_string:{query:"shadow.waf.attacktype:"+t.logDialogTitle}}),t.getOnepieceFromPie()})})},drawOrgIpLine:function(){var t=this;t.orgIpLineLoading=!0;var e=document.getElementById("orgIpLineContainer");t.orgIpLineChart=u.a.init(e),t.orgIpLineChart.off("brushSelected");var a=!1;e.addEventListener("mousedown",function(){a=!1}),e.addEventListener("mouseup",function(){a=!0});var o={color:["#4ea397","#22c3aa","#7bd9a5","#d0648a","#f58db2"],title:{text:t.$t("lg.numattacksiptop5"),textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow",label:{show:!0}}},legend:{top:"20px",data:[]},grid:{left:"5%",right:"3%",bottom:"4%",top:"25%",containLabel:!0},brush:{toolbox:["lineX"],xAxisIndex:"all",transformable:!1,throttleType:"debounce",throttleDelay:1e3,brushStyle:{borderWidth:0}},toolbox:{show:!1,right:"10",top:"10"},xAxis:{show:!1,type:"category",data:[]},yAxis:{show:!1,type:"value",name:t.$t("lg.counts"),minInterval:1},series:[]};p.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{filter:t.filterObj,must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}},{range:{"@timestamp":{gte:t.fromTime,lte:t.endTime}}}]}},aggs:{ip:{terms:{field:"shadow.waf.clientip",size:5},aggs:{time_histo:{date_histogram:{field:"@timestamp",interval:t.timeinterval,extended_bounds:{min:t.fromTime,max:t.endTime}}}}}}}}).then(function(e){var i=e.aggregations?e.aggregations.ip.buckets:[],s=[],r=[];0==i.length?(o.xAxis.show=!1,o.yAxis.show=!1,o.toolbox.show=!1,t.orgIpLineNodata=!0):(o.xAxis.show=!0,o.yAxis.show=!0,o.toolbox.show=!0,t.orgIpLineNodata=!1);for(var n=0;n<i.length;n++){var l=[],d=[],c=i[n];s.push(c.key);for(var g=0;g<c.time_histo.buckets.length;g++){var h=c.time_histo.buckets[g],u=h.doc_count;u||(u=0),l.push(t.transformMyDate2(h.key)),d.push(u)}r.push({name:c.key,type:"line",data:d})}o.legend.data=s,o.xAxis.data=l,o.series=r,t.orgIpLineChart.setOption(o,!0),t.orgIpLineLoading=!1,t.orgIpLineChart.on("brushSelected",function(e){if(a&&e.batch&&e.batch[0].areas[0]){var o="-0"==e.batch[0].areas[0].coordRange[0]||e.batch[0].areas[0].coordRange[0]<0?0:e.batch[0].areas[0].coordRange[0],i=e.batch[0].areas[0].coordRange[1],s=l[o],r=l[i]?l[i]:l[i-1];if(s==r){var n=new Date(s).getTime(),d=new Date(r).getTime();"5m"==t.$store.state.mydatedata.interval?(n-=3e5,d+=3e5):"10s"==t.$store.state.mydatedata.interval?(n-=1e4,d+=1e4):t.$store.state.mydatedata.interval,s=t.transformMyDate(n),r=t.transformMyDate(d)}t.$store.state.nowTimeVal=[new Date(s),new Date(r)],clearTimeout(t.$store.state.refreshTimeout),t.$store.state.refreshAble=!0,setTimeout(function(){t.$store.commit(m.j)},0)}})})},drawOrgIpPie:function(){var t=this;t.orgIpPieLoading=!0,t.orgIpPieChart=u.a.init(document.getElementById("orgIpPieContainer"));var e={color:["#516b91","#59c4e6","#edafda","#93b7e3","#a5e7f0","#4ea397","#22c3aa","#7bd9a5","#d0648a","#f58db2"],title:{text:t.$t("lg.numattacksopcountstop10"),x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:t.$t("lg.accesssource"),type:"pie",radius:["25%","35%"],data:[].sort(function(t,e){return t.value-e.value}),label:{position:"outside",normal:{textStyle:{fontSize:"12"},formatter:"{b}: {c}"},emphasis:{show:!0,textStyle:{fontSize:"14",fontWeight:"normal"}}},labelLine:{normal:{smooth:0,length:10,length2:20}},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(t){return 200*Math.random()}}]};p.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{filter:t.filterObj,must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}},{range:{"@timestamp":{gte:t.fromTime,lte:t.endTime}}}]}},aggs:{ip:{terms:{field:"shadow.waf.clientip",size:10}}}}}).then(function(a){for(var o=a.aggregations?a.aggregations.ip.buckets:[],i=[],s=[],r=0;r<o.length;r++){var n=o[r];i.push({value:n.doc_count,name:n.key}),s.push(n.key)}e.series[0].data=i,0==i.length?t.orgIpPieNodata=!0:t.orgIpPieNodata=!1,t.orgIpPieChart.setOption(e,!0),t.orgIpPieLoading=!1,t.orgIpPieChart.off("click"),t.orgIpPieChart.on("click",function(e){t.logDialogVisible=!0,t.logDialogTitle=e.name,t.popQueryObj.bool.filter=t.filterObj,t.popQueryObj.bool.must.push({query_string:{query:'shadow.waf.clientip:"'+t.logDialogTitle+'"'}}),t.getOnepieceFromPie()})})},drawDomainLine:function(){var t=this;t.domainLineLoading=!0;var e=document.getElementById("domainLineContainer");t.domainLineChart=u.a.init(e),t.domainLineChart.off("brushSelected");var a=!1;e.addEventListener("mousedown",function(){a=!1}),e.addEventListener("mouseup",function(){a=!0});var o={color:["#c1232b","#27727b","#fcce10","#e87c25","#b5c334"],title:{text:t.$t("lg.numattackdomaintop5"),textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow",label:{show:!0}}},legend:{top:"20px",data:[]},grid:{left:"5%",right:"3%",bottom:"4%",top:"25%",containLabel:!0},brush:{toolbox:["lineX"],xAxisIndex:"all",transformable:!1,throttleType:"debounce",throttleDelay:1e3,brushStyle:{borderWidth:0}},toolbox:{show:!1,right:"10",top:"10"},xAxis:{show:!0,type:"category",data:[]},yAxis:{show:!1,type:"value",name:t.$t("lg.counts"),minInterval:1},series:[]};p.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{filter:t.filterObj,must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}},{range:{"@timestamp":{gte:t.fromTime,lte:t.endTime}}}]}},aggs:{host:{terms:{field:"shadow.waf.host",size:5},aggs:{time_histo:{date_histogram:{field:"@timestamp",interval:t.timeinterval,extended_bounds:{min:t.fromTime,max:t.endTime}}}}}}}}).then(function(e){var i=e.aggregations?e.aggregations.host.buckets:[],s=[],r=[];0==i.length?(o.xAxis.show=!1,o.yAxis.show=!1,o.toolbox.show=!1,t.domainLineNodata=!0):(o.xAxis.show=!0,o.yAxis.show=!0,o.toolbox.show=!0,t.domainLineNodata=!1);for(var n=0;n<i.length;n++){var l=[],d=[],c=i[n];s.push(c.key);for(var g=0;g<c.time_histo.buckets.length;g++){var h=c.time_histo.buckets[g],u=h.doc_count;u||(u=0),l.push(t.transformMyDate2(h.key)),d.push(u)}r.push({name:c.key,type:"line",data:d})}o.legend.data=s,o.xAxis.data=l,o.series=r,t.domainLineChart.setOption(o,!0),t.domainLineLoading=!1,t.domainLineChart.on("brushSelected",function(e){if(a&&e.batch&&e.batch[0].areas[0]){var o="-0"==e.batch[0].areas[0].coordRange[0]||e.batch[0].areas[0].coordRange[0]<0?0:e.batch[0].areas[0].coordRange[0],i=e.batch[0].areas[0].coordRange[1],s=l[o],r=l[i]?l[i]:l[i-1];if(s==r){var n=new Date(s).getTime(),d=new Date(r).getTime();"5m"==t.$store.state.mydatedata.interval?(n-=3e5,d+=3e5):"10s"==t.$store.state.mydatedata.interval?(n-=1e4,d+=1e4):t.$store.state.mydatedata.interval,s=t.transformMyDate(n),r=t.transformMyDate(d)}t.$store.state.nowTimeVal=[new Date(s),new Date(r)],clearTimeout(t.$store.state.refreshTimeout),t.$store.state.refreshAble=!0,setTimeout(function(){t.$store.commit(m.j)},0)}})})},drawDomainPie:function(){var t=this;t.domainPieLoading=!0,t.domainPieChart=u.a.init(document.getElementById("domainPieContainer"));var e={color:["#27727b","#fcce10","#e87c25","#b5c334","#60c0dd","#d7504b","#c6e579","#f0805a","#26c0c0","#c1232b"],title:{text:t.$t("lg.attackdomaintop10"),x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:t.$t("lg.accesssource"),type:"pie",radius:["25%","35%"],data:[].sort(function(t,e){return t.value-e.value}),label:{position:"outside",normal:{textStyle:{fontSize:"12"},formatter:"{b}: {c}"},emphasis:{show:!0,textStyle:{fontSize:"14",fontWeight:"normal"}}},labelLine:{normal:{smooth:0,length:10,length2:20}},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(t){return 200*Math.random()}}]};p.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{filter:t.filterObj,must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}},{range:{"@timestamp":{gte:t.fromTime,lte:t.endTime}}}]}},aggs:{host:{terms:{field:"shadow.waf.host",size:10}}}}}).then(function(a){for(var o=a.aggregations?a.aggregations.host.buckets:[],i=[],s=[],r=0;r<o.length;r++){var n=o[r];i.push({value:n.doc_count,name:n.key}),s.push(n.key)}e.series[0].data=i,0==i.length?t.domainPieNodata=!0:t.domainPieNodata=!1,t.domainPieChart.setOption(e,!0),t.domainPieLoading=!1,t.domainPieChart.off("click"),t.domainPieChart.on("click",function(e){t.logDialogVisible=!0,t.logDialogTitle=e.name,t.popQueryObj.bool.filter=t.filterObj,t.popQueryObj.bool.must.push({query_string:{query:"shadow.waf.host:"+t.logDialogTitle.replace(/:/g,"\\:")}}),t.getOnepieceFromPie()})})},drawRegionBar:function(){var t=this;t.regionBarLoading=!0,t.regionBarChart=u.a.init(document.getElementById("regionBarContainer"));var e={normal:{show:!0,rotate:0,align:"left",verticalAlign:"middle",position:"insideLeft",distance:10,formatter:function(t){return t.data.name},fontSize:12}},a={color:["#d95850"],title:{text:"地域信息/Top10",x:"center",textStyle:{fontSize:"16",fontWeight:"normal"}},tooltip:{show:!1,trigger:"axis",confine:!0,axisPointer:{type:"shadow"},extraCssText:"white-space:normal;word-break: break-all",formatter:function(e,a,o){var i="";return e.forEach(function(e){i=e.data.name+"发起恶意攻击的次数为:"+e.data.value+t.$t("lg.count")}),i}},grid:{top:"12%",left:"0",right:"50",bottom:"2%",containLabel:!0},xAxis:{show:!1,type:"value",name:t.$t("lg.counts"),boundaryGap:[0,.01],position:"top",splitLine:{show:!1},minInterval:1},yAxis:{show:!1,type:"category",data:[],inverse:!0},series:[]};p.a.search({index:"shadow-filebeat-*",body:{size:0,query:{bool:{filter:t.filterObj,must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}},{range:{"@timestamp":{gte:t.fromTime,lte:t.endTime}}}]}},aggs:{GroupByGeo:{terms:{script:{inline:"params._source.shadow.waf.geoip",lang:"painless"},size:10},aggs:{total_count:{scripted_metric:{init_script:"params._agg.count = []",map_script:"Map cnt = new HashMap();cnt.put('loc',params['_source']['shadow']['access']['geoip']);params._agg.count.add(cnt)",combine_script:"return params._agg.count.get(0)",reduce_script:"return params._aggs.get(0)"}}}}}}}).then(function(o){for(var i=o.aggregations?o.aggregations.GroupByGeo.buckets:[],s=[],r=i.length,n=0;n<r;n++)s.push("top"+(n+1));a.yAxis.data=s;var l=[];for(n=0;n<s.length;n++)if(i[n]){var d=i[n].total_count.value.loc.city_name?i[n].total_count.value.loc.city_name:"["+i[n].total_count.value.loc.location.lon+","+i[n].total_count.value.loc.location.lat+"]";l.push({value:i[n].doc_count,name:d})}a.series=[{type:"bar",label:e,data:l,barMaxWidth:30}],0==i.length?(a.xAxis.show=!1,a.yAxis.show=!1,a.tooltip.show=!1,t.regionBarNodata=!0):(a.xAxis.show=!0,a.yAxis.show=!0,a.tooltip.show=!0,t.regionBarNodata=!1),t.regionBarChart.setOption(a,!0),t.regionBarLoading=!1,t.regionBarChart.off("click"),t.regionBarChart.on("click",function(e){if(t.logDialogVisible=!0,t.logDialogTitle=e.name,t.popQueryObj.bool.filter=t.filterObj,/^\[.+\]$/.test(e.name)){var a=JSON.parse(e.name),o=a[0],i=a[1],s={};s.distance="1mm",s["shadow.waf.geoip.location"]={lat:i,lon:o},t.popQueryObj.bool.filter.bool?t.popQueryObj.bool.filter.bool.must.push({geo_distance:s}):(t.popQueryObj.bool.filter={bool:{must:[]}},t.popQueryObj.bool.filter.bool.must.push({geo_distance:s}))}else t.popQueryObj.bool.must.push({query_string:{query:"shadow.waf.geoip.city_name:"+t.logDialogTitle.replace(/:/g,"\\:")}});t.getOnepieceFromPie()})})},fullScreen:function(){var t=this;document.getElementsByClassName("attackChart-wrapper")[0].requestFullscreen(),window.addEventListener("fullscreenchange",function(e){document.fullscreenElement?(t.isShowQueryPanel=!1,t.isShowGridMenu=!1):(t.isShowQueryPanel=!0,t.isShowGridMenu=!0)})},downLoadPdf:function(){var t=this,e=this;if(0!=this.attackSumNum){var a=void 0;this.forFastShow&&(a=this.businessLineChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""));var o=this.urlAtckCtBarChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),i=this.attackTypeChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),s=this.orgIpLineChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),r=this.orgIpPieChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),n=this.domainLineChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),l=this.domainPieChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),d=this.regionBarChart.getDataURL({type:"jpeg",pixelRatio:2,backgroundColor:"#fff"}).replace("data:image/jpeg;base64,",""),h=void 0;h=a?[a,o,i,s,r,n,l,d]:[o,i,s,r,n,l,d];var u=g.b+"pe/download/conversion/jpg2pdf";c.a.post(u,{base64StringList:h},{responseType:"blob"}).then(function(a){if(200==a.status){var o=e.$t("lg.attackdatachart")+".pdf";t.$store.commit(m.i,{pdfdata:a.data,pdfname:o})}}).catch(function(t){console.log(t)})}else this.$message.error(e.$t("lg.nodata"))},goBackMap:function(){this.$router.push("/attack")},getChangeLogData:function(t){this.fromPage=t.curPage-1,this.pageSize=t.pageNum,this.requeryObj?this.getOnepieceFromPie(this.requeryObj):this.getOnepieceFromPie()},getOnepieceFromPie:function(t){var e=this,a=JSON.parse(r()(e.popQueryObj));if(a.bool.must.push({range:{"@timestamp":{gte:e.fromTime,lte:e.endTime}}}),t){var o=t.bool.must;a.bool.filter.bool?o.forEach(function(t){a.bool.filter.bool.must.push(t)}):(a.bool.filter={bool:{must:[]}},o.forEach(function(t){a.bool.filter.bool.must.push(t)}))}p.a.search({index:"shadow-filebeat*",body:{from:e.fromPage*e.pageSize,size:e.pageSize,sort:{"@timestamp":"desc"},query:a}}).then(function(t){e.chartLogsTotalNum=t.hits.total.value;var a=t.hits.hits;e.chartLogsBodyData=Object(L.e)(a)})},requeryRowByWaf:function(t){this.requeryObj=t.requeryObj,this.fromPage=0,this.getOnepieceFromPie(this.requeryObj),this.$refs.log_tables&&(this.$refs.log_tables.tabCurPage=1)},refilterColByWaf:function(t){var e=g.b+"/pe/shadow/kv";c.a.post(e,{attackChartWaf:t}).then(function(a){i()(a.data.data.Failure)&&c.a.patch(e,{attackChartWaf:t}).then(function(t){})}),this.chartLogsHeadData=t},logDialogClose:function(){this.logDialogVisible=!1,this.logDialogTitle="",this.fromPage=0,this.chartLogsTotalNum=0,this.popQueryObj={bool:{must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}}]}},this.broadcast("logRequery","clearData"),this.requeryObj=null},transformMyDate:function(t){function e(t){return t<10?"0"+t:t}return e((t=new Date(t)).getFullYear())+"-"+e(parseInt(t.getMonth())+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())},transformMyDate2:function(t){function e(t){return t<10?"0"+t:t}return e((t=new Date(t-288e5)).getFullYear())+"-"+e(parseInt(t.getMonth())+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getMinutes())+":"+e(t.getSeconds())}},beforeDestroy:function(){window.removeEventListener("resize",function(){})}},T={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"attackChart-wrapper"},[a("query-panel",{directives:[{name:"show",rawName:"v-show",value:t.isShowQueryPanel,expression:"isShowQueryPanel"}],on:{getAllQuerychart:t.getAllchart,handleTime:t.handleTime}}),t._v(" "),a("div",{staticClass:"attackChartContent"},[a("el-row",{staticClass:"chartRow",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.urlAtckCtLoading,expression:"urlAtckCtLoading"}],staticClass:"chart-content",staticStyle:{position:"relative"},attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[t.urlAtckCtBarNodata?a("pienodata",{attrs:{mystyle:"linenodata"}}):t._e(),t._v(" "),a("div",{attrs:{id:"urlAtckCtContainer"}})],1)]),t._v(" "),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"chart-content numBox txtOverflow"},[a("p",{staticClass:"text-center numBoxTitle"},[t._v(t._s(t.$t("lg.totaldatav")))]),t._v(" "),a("div",{staticClass:"totalBox"},[a("p",{staticClass:"numTitle"},[t._v(t._s(t.$t("lg.totalrquestammount")))]),t._v(" "),a("p",{staticClass:"totalNum"},[t._v(t._s(t.totalNum)),a("span",{staticClass:"uTxt"},[t._v(t._s(t.$t("lg.count")))])])]),t._v(" "),a("div",{staticClass:"abnormalBox"},[a("p",{staticClass:"numTitle"},[t._v(t._s(t.$t("lg.totalattack")))]),t._v(" "),a("p",{staticClass:"abnormalNum"},[t._v(t._s(t.attackSumNum)),a("span",{staticClass:"uTxt"},[t._v(t._s(t.$t("lg.count")))])])])])])],1),t._v(" "),a("el-row",{staticClass:"chartRow",attrs:{gutter:10}},[a("el-col",{attrs:{span:16}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.orgIpLineLoading,expression:"orgIpLineLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[t.orgIpLineNodata?a("pienodata",{attrs:{mystyle:"linenodata"}}):t._e(),t._v(" "),a("div",{attrs:{id:"orgIpLineContainer"}})],1)]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.orgIpPieLoading,expression:"orgIpPieLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[t.orgIpPieNodata?a("div",{staticClass:"adaptive-circle"},[a("div",{staticClass:"layout middle"},[a("div",[a("p",[t._v(t._s(t.$t("lg.nodata")))])])])]):t._e(),t._v(" "),a("div",{attrs:{id:"orgIpPieContainer"}})])])],1),t._v(" "),a("el-row",{staticClass:"chartRow",attrs:{gutter:10}},[a("el-col",{attrs:{span:16}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.domainLineLoading,expression:"domainLineLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[t.domainLineNodata?a("pienodata",{attrs:{mystyle:"linenodata"}}):t._e(),t._v(" "),a("div",{attrs:{id:"domainLineContainer"}})],1)]),t._v(" "),a("el-col",{attrs:{span:8}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.domainPieLoading,expression:"domainPieLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[t.domainPieNodata?a("div",{staticClass:"adaptive-circle"},[a("div",{staticClass:"layout middle"},[a("div",[a("p",[t._v(t._s(t.$t("lg.nodata")))])])])]):t._e(),t._v(" "),a("div",{attrs:{id:"domainPieContainer"}})])])],1),t._v(" "),a("el-row",{staticClass:"chartRow lastChartRow",attrs:{gutter:10}},[a("el-col",{attrs:{span:14}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.regionBarLoading,expression:"regionBarLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[t.regionBarNodata?a("pienodata",{attrs:{mystyle:"linenodata"}}):t._e(),t._v(" "),a("div",{attrs:{id:"regionBarContainer"}})],1)]),t._v(" "),a("el-col",{attrs:{span:10}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.attackTypeLoading,expression:"attackTypeLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[t.attackTypeNodata?a("div",{staticClass:"adaptive-circle"},[a("div",{staticClass:"layout middle"},[a("div",[a("p",[t._v(t._s(t.$t("lg.nodata")))])])])]):t._e(),t._v(" "),a("div",{attrs:{id:"attackTypeContainer"}})])])],1),t._v(" "),t.forFastShow?a("el-row",{staticClass:"chartRow chartRowBusi",attrs:{gutter:20}},[a("el-col",{staticStyle:{"padding-left":"0px"},attrs:{span:20}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.businessLineLoading,expression:"businessLineLoading"}],staticClass:"chart-content",attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0)"}},[t.businessNodata?a("pienodata",{attrs:{mystyle:"linenodata"}}):t._e(),t._v(" "),a("div",{attrs:{id:"businessContainer"}})],1)]),t._v(" "),a("el-col",{staticClass:"busiNumBox",attrs:{span:4}},[a("ul",{staticClass:"totalList"},[a("li",{staticClass:"listTitle"},[t._v(t._s(t.$t("lg.totalrequests"))+"：")]),t._v(" "),a("li",[a("i",{staticClass:"liLable"},[t._v("MAX:")]),t._v(" "),a("p",{staticClass:"liValue"},[t._v(t._s(t.wholeCtMax))])]),t._v(" "),a("li",[a("i",{staticClass:"liLable"},[t._v("MIN:")]),t._v(" "),a("p",{staticClass:"liValue"},[t._v(t._s(t.wholeCtMin))])])]),t._v(" "),a("ul",{staticClass:"someList"},[a("li",{staticClass:"listTitle"},[t._v(t._s(t.$t("lg.gongji"))+"：")]),t._v(" "),a("li",[a("i",{staticClass:"liLable"},[t._v("MAX:")]),t._v(" "),a("p",{staticClass:"liValue"},[t._v(t._s(t.normalCtMax))])]),t._v(" "),a("li",[a("i",{staticClass:"liLable"},[t._v("MIN:")]),t._v(" "),a("p",{staticClass:"liValue"},[t._v(t._s(t.normalCtMin))])])])])],1):t._e()],1),t._v(" "),t.forFastShow?t._e():a("p",{staticClass:"fastloadmore",on:{click:t.forfastloadmore}},[t._v("点击查看更多图表")]),t._v(" "),a("el-dialog",{attrs:{title:t.logDialogTitle,visible:t.logDialogVisible,width:"80%","before-close":t.logDialogClose},on:{"update:visible":function(e){t.logDialogVisible=e}}},[a("log-rebuild",{attrs:{tableKeyArr:t.tableKeyArrWaf,dynamicTag:t.chartLogsHeadData},on:{refilterColBy:t.refilterColByWaf,requeryRowBy:t.requeryRowByWaf}}),t._v(" "),0==t.chartLogsTotalNum?a("div",{staticClass:"nodata-box"},[t._v(t._s(t.$t("lg.nodata")))]):t._e(),t._v(" "),t.chartLogsTotalNum>0?a("div",{staticClass:"logTableHeight"},[a("log-tables",{ref:"log_tables",attrs:{tabheadData:t.chartLogsHeadData,tabodyData:t.chartLogsBodyData,totalNum:t.chartLogsTotalNum,isLogLoding:!1},on:{getChangeLogData:t.getChangeLogData}})],1):t._e()],1),t._v(" "),a("ul",{directives:[{name:"show",rawName:"v-show",value:t.isShowGridMenu,expression:"isShowGridMenu"}],staticClass:"operationBtnUl"},[a("li",[a("img",{attrs:{src:"static/icon/fullScreen.png",alt:"大屏展示",title:"大屏展示"},on:{click:t.fullScreen}})]),t._v(" "),a("li",[a("img",{attrs:{src:"static/icon/downpdfChart.png",alt:"导出pdf",title:"导出pdf"},on:{click:t.downLoadPdf}})]),t._v(" "),a("li",[a("img",{attrs:{src:"static/icon/map.png",alt:"返回地图",title:"返回地图"},on:{click:t.goBackMap}})])])],1)},staticRenderFns:[]};var D=a("VU/8")(k,T,!1,function(t){a("tpJR")},null,null);e.default=D.exports},tpJR:function(t,e){}});
//# sourceMappingURL=28.cad7e6e06daa2fec166a.js.map