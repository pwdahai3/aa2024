webpackJsonp([33],{"c3b/":function(a,e){},nonE:function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=t("fZjL"),o=t.n(s),l=t("mvHQ"),i=t.n(l),r=t("Gu7T"),c=t.n(r),n=t("mtWM"),g=t.n(n),u=t("yJCr"),d=(t("5reh"),t("gQxQ")),m=t("T+n0"),h=t("rBmc"),f=t("ufP2"),y=t("GfiX"),b=t("EjLO"),L=t("7uT9"),p=(t("ryR9"),t("InnB")),D={mixins:[f.a],componentName:"logs",components:{logRebuild:L.a,logTables:b.a},created:function(){var a=sessionStorage.getItem("myRoles");"ADMIN"==a?(this.adminRoles=!0,this.auditRoles=!1):"USER"==a?(this.adminRoles=!1,this.auditRoles=!1):"AUDIT"==a&&(this.adminRoles=!1,this.auditRoles=!0,this.logsActiveName="audit"),this.getCustomHeadData(),this.getAllAccesslogs({curPage:this.allAceCurPage,pageNum:this.allAcePageNum}),this.isen="en"==localStorage.getItem("lang")},watch:{"$store.state.mydatedata.timestampnow":function(){this.logsHandleClick({name:this.logsActiveName})}},data:function(){return{adminRoles:!1,auditRoles:!1,logsActiveName:"allaccess",allAccessLoading:!1,tableKeyArrAllAccess:[].concat(c()(y.a.access)),allAceLogsHeadData:[],allAceLogsBodyData:[],allAceCurPage:1,allAcePageNum:10,allAceTotalNum:0,passQuerystring:{},wafLoading:!1,tableKeyArrWaf:[].concat(c()(y.a.waf)),wafLogsHeadData:[],wafLogsBodyData:[],wafCurPage:1,wafPageNum:10,wafTotalNum:0,accessLoading:!1,tableKeyArrAccess:[].concat(c()(y.a.access)),aceLogsHeadData:[],aceLogsBodyData:[],aceCurPage:1,acePageNum:10,aceTotalNum:0,auditLoading:!1,tableKeyArrAudit:[].concat(c()(y.a.audit)),audLogsHeadData:[],audLogsBodyData:[],audCurPage:1,audPageNum:10,audTotalNum:0,errorLoading:!1,errLogsHeadData:[],errLogsBodyData:[],errCurPage:1,errPageNum:10,errTotalNum:0,systemLoading:!1,systemLogsHeadData:[],systemLogsBodyData:[],systemCurPage:1,systemPageNum:10,systemTotalNum:0,cmLoading:!1,cmLogsHeadData:[],cmLogsBodyData:[],cmCurPage:1,cmPageNum:10,cmTotalNum:0,cmform:{level:""},isShowPage:!1,filterObj:{match_all:{}},keyObj:{allaccess:"logsAllAccess",waf:"logsWaf",access:"logsAccess",audit:"logsAudit"},isen:!1}},methods:{logsHandleClick:function(a,e){e&&(this.allAceLogsBodyData=[],this.wafLogsBodyData=[],this.aceLogsBodyData=[],this.audLogsBodyData=[],this.errLogsBodyData=[],this.systemLogsBodyData=[],this.cmLogsBodyData=[],this.cmform.level="",this.isShowPage=!1,this.broadcast("logRequery","clearData"),this.filterObj={match_all:{}});var t=a.name,s={allaccess:{curPage:this.allAceCurPage,pageNum:this.allAcePageNum,getLogsFun:this.getAllAccesslogs},waf:{curPage:this.wafCurPage,pageNum:this.wafPageNum,getLogsFun:this.getWaflogs},access:{curPage:this.aceCurPage,pageNum:this.acePageNum,getLogsFun:this.getAccesslogs},audit:{curPage:this.audCurPage,pageNum:this.audPageNum,getLogsFun:this.getAuditlogs},error:{curPage:this.errCurPage,pageNum:this.errPageNum,getLogsFun:this.getErrorlogs},system:{curPage:this.systemCurPage,pageNum:this.systemPageNum,getLogsFun:this.getSystemlogs},cm:{curPage:this.cmCurPage,pageNum:this.cmPageNum,getLogsFun:this.getCmlogs}};this.$nextTick(function(){s[t].getLogsFun({curPage:s[t].curPage,pageNum:s[t].pageNum})})},getCustomHeadData:function(){var a=this,e=u.b+"/pe/shadow/kv/"+this.keyObj.allaccess;g.a.get(e).then(function(e){e.data.data?a.allAceLogsHeadData=e.data.data.value:a.allAceLogsHeadData=[].concat(c()(y.a.access))});e=u.b+"/pe/shadow/kv/"+this.keyObj.waf;g.a.get(e).then(function(e){e.data.data?a.wafLogsHeadData=e.data.data.value:a.wafLogsHeadData=[].concat(c()(y.a.waf))});var t=u.b+"/pe/shadow/kv/"+this.keyObj.access;g.a.get(t).then(function(e){e.data.data?a.aceLogsHeadData=e.data.data.value:a.aceLogsHeadData=[].concat(c()(y.a.access))});var s=u.b+"/pe/shadow/kv/"+this.keyObj.audit;g.a.get(s).then(function(e){e.data.data?a.audLogsHeadData=e.data.data.value:a.audLogsHeadData=[].concat(c()(y.a.audit))})},getAllAccesslogs:function(a){var e,t,s=this;e=(a.curPage-1)*a.pageNum,t=a.pageNum;var o=s.$store.state.mydatedata.starttime,l=s.$store.state.mydatedata.endtime,r=Object(h.a)(o),c=Object(h.a)(l),n=r||Object(h.a)(new Date(Date.now()-s.$store.state.dateTimeLong)),g=c||Object(h.a)(new Date);s.allAccessLoading=!0;var u={track_total_hits:!0,sort:{"@timestamp":"desc"},query:{bool:{filter:s.filterObj,must:[{exists:{field:"shadow.access.method"}},{range:{"@timestamp":{gte:n,lte:g}}}]}}};s.passQuerystring=i()(u),d.a.search({index:"shadow-filebeat*",from:e,size:t,body:u}).then(function(a){s.allAceTotalNum=a.hits.total.value;var e=a.hits.hits;s.allAceLogsBodyData=Object(p.c)(e),s.allAccessLoading=!1}).catch(function(a){console.log(a)})},getWaflogs:function(a){var e,t,s=this;e=(a.curPage-1)*a.pageNum,t=a.pageNum;var o=s.$store.state.mydatedata.starttime,l=s.$store.state.mydatedata.endtime,i=Object(m.a)(o),r=Object(m.a)(l),c=i||Object(m.a)(new Date(Date.now()-s.$store.state.dateTimeLong)),n=r||Object(m.a)(new Date);s.wafLoading=!0,d.a.search({index:"shadow-filebeat*",from:e,size:t,body:{sort:{"@timestamp":"desc"},query:{bool:{filter:s.filterObj,must_not:{exists:{field:"error"}},must:[{term:{"log.file.path":"/usr/local/shadow/logs/shadow_waf.log"}},{range:{"@timestamp":{from:c,to:n,include_lower:!0,include_upper:!0}}}]}}}}).then(function(a){s.wafTotalNum=a.hits.total.value;var e=a.hits.hits;s.wafLogsBodyData=Object(p.e)(e),s.wafLoading=!1}).catch(function(a){console.log(a)})},getAccesslogs:function(a){var e,t,s=this;e=(a.curPage-1)*a.pageNum,t=a.pageNum;var o=s.$store.state.mydatedata.starttime,l=s.$store.state.mydatedata.endtime,r=Object(h.a)(o),c=Object(h.a)(l),n=r||Object(h.a)(new Date(Date.now()-s.$store.state.dateTimeLong)),g=c||Object(h.a)(new Date);s.accessLoading=!0;var u={sort:{"@timestamp":"desc"},track_total_hits:!0,query:{bool:{filter:s.filterObj,must:[{exists:{field:"shadow.access.method"}},{range:{"@timestamp":{gte:n,lte:g}}}]}}};s.passQuerystring=i()(u),d.a.search({index:"shadow-filebeat-warn*",from:e,size:t,body:u}).then(function(a){s.aceTotalNum=a.hits.total.value,console.log(s.aceTotalNum);var e=a.hits.hits;s.aceLogsBodyData=Object(p.c)(e),s.accessLoading=!1}).catch(function(a){console.log(a)})},getAuditlogs:function(a){var e,t,s=this;e=(a.curPage-1)*a.pageNum,t=a.pageNum;var o=s.$store.state.mydatedata.starttime,l=s.$store.state.mydatedata.endtime,i=Object(m.a)(o),r=Object(m.a)(l),c=i||Object(m.a)(new Date(Date.now()-s.$store.state.dateTimeLong)),n=r||Object(m.a)(new Date);s.auditLoading=!0;var d={sort:[{"json.timestamp":{order:"desc"}}],query:{bool:{filter:s.filterObj,must:[{term:{tags:"audit"}},{range:{"@timestamp":{gte:c,lte:n}}}]}}},h=u.b+"pe/shadow/audit?page="+e+"&size="+t;g.a.post(h,d).then(function(a){if(0==a.data.responseCode){s.audTotalNum=a.data.data.hits.total.value;var e=a.data.data.hits.hits,t=s.$options.filters.iso8601,o=[];e.forEach(function(a){var e=a._source.json,s={};s.date=t(e.timestamp),s.name=e.principal.name,s.method=e.request.method,s.queryPara=e.request.queryPara,s.remoteAddress=e.request.remoteAddress,s.uri=e.request.description?e.request.uri+"（说明:"+e.request.description+"）":e.request.uri,s.status=e.response.status,s.timeTaken=e.timeTaken,o.push(s)}),s.audLogsBodyData=o,s.auditLoading=!1}}).catch(function(a){console.log(a)})},getErrorlogs:function(a){var e,t,s=this;e=(a.curPage-1)*a.pageNum,t=a.pageNum;var o=s.$store.state.mydatedata.starttime,l=s.$store.state.mydatedata.endtime,i=Object(m.a)(o),r=Object(m.a)(l),c=i||Object(m.a)(new Date(Date.now()-s.$store.state.dateTimeLong)),n=r||Object(m.a)(new Date);s.errorLoading=!0,d.a.search({index:"shadow-filebeat*",from:e,size:t,body:{sort:{"@timestamp":"desc"},query:{bool:{filter:[{range:{"@timestamp":{from:c,to:n,include_lower:!0,include_upper:!0}}}],must:[{term:{"log.file.path":"/usr/local/shadow/logs/error.log"}}],must_not:[{match:{"shadow.access.token":"00000000000000000000000000000000"}},{match:{"shadow.access.token":"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"}},{match:{"shadow.error.level":"notcie"}},{exists:{field:"error"}}]}}}}).then(function(a){s.errTotalNum=a.hits.total.value;var e=a.hits.hits,t=y.a.error;s.errLogsHeadData=t;var o=s.$options.filters.toSdDate,l=[];e.forEach(function(a){var e=a._source,t={};t.date=o(e.read_timestamp),t.level=e.shadow.error.level,t.message=e.shadow.error.message,l.push(t)}),s.errLogsBodyData=l,s.errorLoading=!1}).catch(function(a){console.log(a)})},getSystemlogs:function(a){var e,t,s=this;e=(a.curPage-1)*a.pageNum,t=a.pageNum;var o=s.$store.state.mydatedata.starttime,l=s.$store.state.mydatedata.endtime,i=Object(m.a)(o),r=Object(m.a)(l),c=i||Object(m.a)(new Date(Date.now()-s.$store.state.dateTimeLong)),n=r||Object(m.a)(new Date);s.systemLoading=!0,d.a.search({index:"cm-system-*",from:e,size:t,body:{sort:{"@timestamp":"desc"},query:{bool:{filter:[{range:{"@timestamp":{from:c,to:n,include_lower:!0,include_upper:!0}}}]}}}}).then(function(a){s.systemTotalNum=a.hits.total.value;var e=a.hits.hits,t=y.a.system;s.systemLogsHeadData=t;var o=s.$options.filters.toSdDate,l=[];e.forEach(function(a){var e=a._source,t={};t.date=o(e["@timestamp"]),t.name=e.process.name,t.message=e.message,l.push(t)}),s.systemLogsBodyData=l,s.systemLoading=!1}).catch(function(a){console.log(a)})},cmlogs:function(a){var e=this,t=e.$store.state.mydatedata.starttime,s=e.$store.state.mydatedata.endtime,o=Object(m.a)(t),l=Object(m.a)(s),i=o||Object(m.a)(new Date(Date.now()-e.$store.state.dateTimeLong)),r=l||Object(m.a)(new Date);e.cmLoading=!0,d.a.search({index:"cm-log-*",from:0,size:1e3,body:{sort:{"@timestamp":"desc"},query:{bool:{filter:[{range:{"@timestamp":{from:i,to:r,include_lower:!0,include_upper:!0}}}],must:[{match:{"cm.level":a}}]}}}}).then(function(a){e.cmTotalNum=0,e.isShowPage=!0;var t=a.hits.hits,s=y.a.cm;e.cmLogsHeadData=s;var o,l=e.$options.filters.toSdDate,i=[],r={};t.forEach(function(a){(o=a._source).cm&&(r.date=l(o["@timestamp"]),r.pid=o.cm.pid,r.level=o.cm.level,r.message=o.cm.message,r.system_info=o.cm.system_info,r.class_name=o.cm.class_name),i.push(r)}),e.cmLogsBodyData=i,e.cmLoading=!1}).catch(function(a){console.log(a)})},getCmlogs:function(a){var e,t,s=this;e=(a.curPage-1)*a.pageNum,t=a.pageNum;var o=s.$store.state.mydatedata.starttime,l=s.$store.state.mydatedata.endtime,i=Object(m.a)(o),r=Object(m.a)(l),c=i||Object(m.a)(new Date(Date.now()-s.$store.state.dateTimeLong)),n=r||Object(m.a)(new Date);s.cmLoading=!0,d.a.search({index:"cm-log-*",from:e,size:t,body:{sort:{"@timestamp":"desc"},query:{bool:{filter:[{range:{"@timestamp":{from:c,to:n,include_lower:!0,include_upper:!0}}}]}}}}).then(function(a){s.cmTotalNum=a.hits.total.value;var e=a.hits.hits,t=y.a.cm;s.cmLogsHeadData=t;var o,l=s.$options.filters.toSdDate,i=[],r={};e.forEach(function(a){(o=a._source).cm&&(r.date=l(o["@timestamp"]),r.pid=o.cm.pid,r.level=o.cm.level,r.message=o.cm.message,r.system_info=o.cm.system_info,r.class_name=o.cm.class_name),i.push(r)}),s.cmLogsBodyData=i,s.cmLoading=!1}).catch(function(a){console.log(a)})},requeryRowByAllAccess:function(a){this.filterObj=a.requeryObj,this.getAllAccesslogs({curPage:this.allAceCurPage,pageNum:this.allAcePageNum}),this.$refs.log_tablesAllAccess&&(this.$refs.log_tablesAllAccess.tabCurPage=1)},requeryRowByWaf:function(a){this.filterObj=a.requeryObj,this.getWaflogs({curPage:this.wafCurPage,pageNum:this.wafPageNum}),this.$refs.log_tablesWaf&&(this.$refs.log_tablesWaf.tabCurPage=1)},requeryRowByAccess:function(a){this.filterObj=a.requeryObj,this.getAccesslogs({curPage:this.aceCurPage,pageNum:this.acePageNum}),this.$refs.log_tablesAccess&&(this.$refs.log_tablesAccess.tabCurPage=1)},requeryRowByAudit:function(a){this.filterObj=a.requeryObj,this.getAuditlogs({curPage:this.audCurPage,pageNum:this.audPageNum}),this.$refs.log_tablesAudit&&(this.$refs.log_tablesAudit.tabCurPage=1)},refilterColByAllAccess:function(a){var e=u.b+"/pe/shadow/kv";g.a.post(e,{logsAllAccess:a}).then(function(t){o()(t.data.data.Failure)&&g.a.patch(e,{logsAllAccess:a}).then(function(a){})}),this.allAceLogsHeadData=a},refilterColByWaf:function(a){var e=u.b+"/pe/shadow/kv";g.a.post(e,{logsWaf:a}).then(function(t){o()(t.data.data.Failure)&&g.a.patch(e,{logsWaf:a}).then(function(a){})}),this.wafLogsHeadData=a},refilterColByAccess:function(a){var e=u.b+"/pe/shadow/kv";g.a.post(e,{logsAccess:a}).then(function(t){o()(t.data.data.Failure)&&g.a.patch(e,{logsAccess:a}).then(function(a){})}),this.aceLogsHeadData=a},refilterColByAudit:function(a){var e=u.b+"/pe/shadow/kv";g.a.post(e,{logsAudit:a}).then(function(t){o()(t.data.data.Failure)&&g.a.patch(e,{logsAudit:a}).then(function(a){})}),this.audLogsHeadData=a},showSDURLMenu:function(a){this.aceLogsBodyData.forEach(function(a){a.showUMenuList=!1}),this.$set(this.aceLogsBodyData[a],"showUMenuList",!0)},hideSDURLMenu:function(){this.aceLogsBodyData.forEach(function(a){a.showUMenuList=!1})}},filters:{toSdDate:function(a){if(a){var e=new Date(a);return e.getFullYear()+"/"+t(parseInt(e.getMonth())+1)+"/"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())}function t(a){return a<10?"0"+a:a}},iso8601:function(a){if(a){var e=new Date(a);return e.getUTCFullYear()+"/"+t(e.getUTCMonth()+1)+"/"+t(e.getUTCDate())+" "+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())}function t(a){return a<10?"0"+a:a}}}},A={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"logs-wrapper",on:{click:a.hideSDURLMenu}},[t("el-tabs",{staticClass:"big-tabs",on:{"tab-click":a.logsHandleClick},model:{value:a.logsActiveName,callback:function(e){a.logsActiveName=e},expression:"logsActiveName"}},[a.adminRoles||!a.auditRoles?t("el-tab-pane",{attrs:{label:"日志记录",name:"allaccess"}},[t("log-rebuild",{key:1,attrs:{tableKeyArr:a.tableKeyArrAllAccess,dynamicTag:a.allAceLogsHeadData},on:{refilterColBy:a.refilterColByAllAccess,requeryRowBy:a.requeryRowByAllAccess}}),a._v(" "),t("log-tables",{key:2,ref:"log_tablesAllAccess",attrs:{isZhEn:a.isen,logType:a.logsActiveName,tabheadData:a.allAceLogsHeadData,tabodyData:a.allAceLogsBodyData,totalNum:a.allAceTotalNum,passquerystring:a.passQuerystring,isLogLoding:a.allAccessLoading},on:{getChangeLogData:a.getAllAccesslogs}})],1):a._e(),a._v(" "),a.adminRoles||!a.auditRoles?t("el-tab-pane",{attrs:{label:a.$t("lg.gongji"),name:"waf"}},[t("log-rebuild",{key:3,attrs:{tableKeyArr:a.tableKeyArrWaf,dynamicTag:a.wafLogsHeadData},on:{refilterColBy:a.refilterColByWaf,requeryRowBy:a.requeryRowByWaf}}),a._v(" "),t("log-tables",{key:4,ref:"log_tablesWaf",attrs:{isZhEn:a.isen,logType:a.logsActiveName,tabheadData:a.wafLogsHeadData,tabodyData:a.wafLogsBodyData,totalNum:a.wafTotalNum,isLogLoding:a.wafLoading},on:{getChangeLogData:a.getWaflogs}})],1):a._e(),a._v(" "),a.adminRoles||!a.auditRoles?t("el-tab-pane",{attrs:{label:a.$t("lg.fangwen"),name:"access"}},[t("log-rebuild",{key:5,attrs:{tableKeyArr:a.tableKeyArrAccess,dynamicTag:a.aceLogsHeadData},on:{refilterColBy:a.refilterColByAccess,requeryRowBy:a.requeryRowByAccess}}),a._v(" "),t("log-tables",{key:6,ref:"log_tablesAccess",attrs:{isZhEn:a.isen,logType:a.logsActiveName,tabheadData:a.aceLogsHeadData,tabodyData:a.aceLogsBodyData,totalNum:a.aceTotalNum,isLogLoding:a.accessLoading,passquerystring:a.passQuerystring,showSDURLMenu:a.showSDURLMenu},on:{getChangeLogData:a.getAccesslogs}})],1):a._e(),a._v(" "),a.adminRoles||a.auditRoles?t("el-tab-pane",{attrs:{label:"审计日志",name:"audit"}},[t("log-rebuild",{key:7,attrs:{tableKeyArr:a.tableKeyArrAudit,dynamicTag:a.audLogsHeadData},on:{refilterColBy:a.refilterColByAudit,requeryRowBy:a.requeryRowByAudit}}),a._v(" "),t("log-tables",{key:8,ref:"log_tablesAudit",attrs:{isZhEn:a.isen,logType:a.logsActiveName,tabheadData:a.audLogsHeadData,tabodyData:a.audLogsBodyData,totalNum:a.audTotalNum,isLogLoding:a.auditLoading},on:{getChangeLogData:a.getAuditlogs}})],1):a._e(),a._v(" "),a.adminRoles||!a.auditRoles?t("el-tab-pane",{attrs:{label:a.$t("lg.errorlog"),name:"error"}},[t("log-tables",{key:3,attrs:{logType:a.logsActiveName,isZhEn:a.isen,tabheadData:a.errLogsHeadData,tabodyData:a.errLogsBodyData,totalNum:a.errTotalNum,isLogLoding:a.errorLoading},on:{getChangeLogData:a.getErrorlogs}})],1):a._e(),a._v(" "),a.adminRoles||!a.auditRoles?t("el-tab-pane",{attrs:{label:"系统日志",name:"system"}},[t("log-tables",{key:3,attrs:{logType:a.logsActiveName,isZhEn:a.isen,tabheadData:a.systemLogsHeadData,tabodyData:a.systemLogsBodyData,totalNum:a.systemTotalNum,isLogLoding:a.systemLoading},on:{getChangeLogData:a.getSystemlogs}})],1):a._e(),a._v(" "),a.adminRoles||!a.auditRoles?t("el-tab-pane",{attrs:{label:"管理平台日志",name:"cm"}},[t("el-form",{ref:"cmform",attrs:{model:a.cmform,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"日志等级"}},[t("el-select",{attrs:{placeholder:"请选择日志等级"},on:{change:a.cmlogs},model:{value:a.cmform.level,callback:function(e){a.$set(a.cmform,"level",e)},expression:"cmform.level"}},[t("el-option",{attrs:{label:"INFO",value:"INFO"}}),a._v(" "),t("el-option",{attrs:{label:"WARN",value:"WARN"}}),a._v(" "),t("el-option",{attrs:{label:"ERROR",value:"ERROR"}})],1)],1)],1),a._v(" "),t("log-tables",{attrs:{logType:a.logsActiveName,isZhEn:a.isen,tabheadData:a.cmLogsHeadData,isShowPage:a.isShowPage,tabodyData:a.cmLogsBodyData,totalNum:a.cmTotalNum,isLogLoding:a.cmLoading},on:{getChangeLogData:a.getCmlogs}})],1):a._e()],1)],1)},staticRenderFns:[]};var w=t("VU/8")(D,A,!1,function(a){t("c3b/")},null,null);e.default=w.exports}});
//# sourceMappingURL=33.0bfb79ee68c2e75abeac.js.map