webpackJsonp([17],{"0dwM":function(e,t,a){"use strict";var s=a("mtWM"),r=a.n(s),o=a("qqiS"),i=a("yJCr"),n=a("xrTZ").Base64,d={components:{loading:o.a},props:{isPwdShow:{type:Boolean},isGradeShow:{type:Boolean},userData:{type:Object}},watch:{isPwdShow:function(){this.isPwdShow&&this.userData&&(this.addform.userName=this.userData.userName,this.addform.password="",this.addform.checkPass="")},isGradeShow:function(){this.isGradeShow&&this.userData&&(this.gradeform.userName=this.userData.userName,this.gradeform.gradeValue=this.userData.roles[0])}},data:function(){var e=this;return{userloading:!1,addform:{userName:"",password:"",checkPass:""},gradeform:{userName:"",gradeOptions:[{value:"ADMIN",label:"ADMIN"},{value:"USER",label:"USER"},{value:"AUDIT",label:"AUDIT"}],gradeValue:""},addformRules:{password:[{validator:function(t,a,s){""===a?s(new Error("请输入密码")):(/^(?=.*\d)(?=.*[a-zA-Z])[\da-zA-Z\-\."\\\*\!\$@\?\^\(\)<>\{\}\[\]=%\&:;\/~\+#_`]{6,20}$/.test(a)||s(new Error("请输入6-20位长度的密码，必须含字母和数字！")),""!==e.addform.checkPass&&e.$refs.addform.validateField("checkPass"),s())},trigger:"blur"}],checkPass:[{validator:function(t,a,s){""===a?s(new Error("请再次输入密码")):a!==e.addform.password?s(new Error(e.$t("lg.nomatch"))):s()},trigger:"blur"}]},gradeformRules:{gradeValue:[{required:!0,message:this.$t("lg.select"),trigger:"blur"}]}}},methods:{editUser:function(e){var t=this,a=this.userData,s=i.b+"uaa/user/"+a.userName;this.$refs[e].validate(function(a){if(a)if("gradeform"==e){var o=[];o.push(t.gradeform.gradeValue),t.userloading=!0,r.a.patch(s,{roles:o}).then(function(e){0==e.data.responseCode?(t.$message({type:"success",message:t.$t("lg.success")}),t.$emit("hasadduser"),t.gradeformCancel()):t.$message.error(t.$t("lg.failed")),t.userloading=!1}).catch(function(e){console.log(e),t.userloading=!1})}else{var i=n.encode(t.addform.password);t.userloading=!0,r.a.patch(s,{password:i}).then(function(e){0==e.data.responseCode?(t.$message({type:"success",message:t.$t("lg.success")}),t.$store.state.pswdreminder&&t.$store.state.pswdreminder.close(),t.addformCancel()):t.$message.error(t.$t("lg.failed")),t.userloading=!1}).catch(function(e){console.log(e),t.userloading=!1})}})},addformCancel:function(){this.$refs.addform.resetFields(),this.$emit("editPwdclose")},gradeformCancel:function(){this.$refs.gradeform.resetFields(),this.$emit("editGradeclose")}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{width:"40%",title:"更新密码",visible:e.isPwdShow,"close-on-click-modal":!1,"before-close":e.addformCancel},on:{"update:visible":function(t){e.isPwdShow=t}}},[a("el-form",{ref:"addform",attrs:{model:e.addform,rules:e.addformRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"账号",prop:"userName"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.addform.userName,callback:function(t){e.$set(e.addform,"userName","string"==typeof t?t.trim():t)},expression:"addform.userName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password"},model:{value:e.addform.password,callback:function(t){e.$set(e.addform,"password","string"==typeof t?t.trim():t)},expression:"addform.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码确认",prop:"checkPass"}},[a("el-input",{attrs:{type:"password"},model:{value:e.addform.checkPass,callback:function(t){e.$set(e.addform,"checkPass","string"==typeof t?t.trim():t)},expression:"addform.checkPass"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.editUser("addform")}}},[e._v("确认")]),e._v(" "),a("el-button",{on:{click:function(t){e.addformCancel()}}},[e._v("取消")])],1)],1),e._v(" "),a("loading",{directives:[{name:"show",rawName:"v-show",value:e.userloading,expression:"userloading"}],attrs:{title:"数据处理中..."}})],1),e._v(" "),a("el-dialog",{attrs:{width:"40%",title:"修改权限",visible:e.isGradeShow,"close-on-click-modal":!1,"before-close":e.gradeformCancel},on:{"update:visible":function(t){e.isGradeShow=t}}},[a("el-form",{ref:"gradeform",attrs:{model:e.gradeform,rules:e.gradeformRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"账号",prop:"userName"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.gradeform.userName,callback:function(t){e.$set(e.gradeform,"userName","string"==typeof t?t.trim():t)},expression:"gradeform.userName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"权限",prop:"gradeValue"}},[a("el-select",{attrs:{placeholder:"请选择权限"},model:{value:e.gradeform.gradeValue,callback:function(t){e.$set(e.gradeform,"gradeValue",t)},expression:"gradeform.gradeValue"}},e._l(e.gradeform.gradeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.editUser("gradeform")}}},[e._v("确认")]),e._v(" "),a("el-button",{on:{click:function(t){e.gradeformCancel()}}},[e._v("取消")])],1)],1),e._v(" "),a("loading",{directives:[{name:"show",rawName:"v-show",value:e.userloading,expression:"userloading"}],attrs:{title:"数据处理中..."}})],1)],1)},staticRenderFns:[]},c=a("VU/8")(d,l,!1,null,null,null);t.a=c.exports},EBEP:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("mtWM"),r=a.n(s),o=a("qqiS"),i=a("yJCr"),n=a("//Fk"),d=a.n(n),l=(a("xrTZ").Base64,{props:{isShow:{type:Boolean},currentUser:{type:String}},data:function(){var e=this;return{permitDomainform:{domains:""},permitDomainformRules:{domains:[{validator:function(t,a,s){if(""===a)s(new Error(e.$t("lg.required")));else{for(var r=a.split(","),o=0;o<r.length;o++){var i=r[o].replace(/^\s*|\s*$/g,"");if(i&&!/^([\w\-." \\*!$@?^()<>{}[\]=%&:;/~+#`,])+$/.test(i)){s(new Error("请输入符合规范的域名"));break}}s()}},trigger:"blur"}]},permitDomainData:[],addFlag:!1,permitDomainloading:!1}},methods:{getDistributeDomainData:function(e){var t=this;return new d.a(function(a,s){var o=i.b+"pe/shadow/user/accessdomain/"+e;r.a.get(o).then(function(e){if(0==e.data.responseCode){var s=[];e.data.data?(s=e.data.data.domains,t.addFlag=!1):t.addFlag=!0,t.permitDomainData=s,a(s)}})})},addPermitDomain:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a,s=t.currentUser;a=t.permitDomainform.domains.split(",");var o=i.b+"pe/shadow/user/accessdomain",n=t.addFlag?"post":"patch";t.permitDomainloading=!0,r.a[n](o,[{userName:s,domains:a}]).then(function(e){0==e.data.responseCode?(t.$message({type:"success",message:t.$t("lg.success")}),t.$refs.permitDomainform.resetFields(),t.getDistributeDomainData(s)):t.$message.error(t.$t("lg.failed")),t.permitDomainloading=!1}).catch(function(e){t.$message.error(e.data),t.permitDomainloading=!1})}})},delPermitDomain:function(e){var t=this;console.log(e);var a=this.currentUser,s=i.b+"pe/shadow/user/accessdomain/"+a+"?domainList="+e;r.a.delete(s).then(function(e){0==e.data.responseCode&&(t.$message({type:"success",message:t.$t("lg.success")}),t.getDistributeDomainData(a))})},resetForm:function(){this.$refs.permitDomainform.resetFields(),this.$emit("distributeDomainClose")}},components:{loading:o.a}}),c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{width:"55%",title:"域名分配管理",visible:e.isShow,"close-on-click-modal":!1,"before-close":e.resetForm},on:{"update:visible":function(t){e.isShow=t}}},[a("div",{staticClass:"tips"},[a("p",[e._v("1、允许输入域名，多个域名请用英文字符逗号( , ) 分隔，比如abc.com,abd.com,abe.com")])]),e._v(" "),a("div",{staticClass:"orderBoxJamb"},[a("el-form",{ref:"permitDomainform",attrs:{model:e.permitDomainform,rules:e.permitDomainformRules,"label-width":"60px"}},[a("el-form-item",{attrs:{label:"域名",prop:"domains"}},[a("el-input",{staticStyle:{width:"60%","margin-right":"10px"},attrs:{type:"textarea",autosize:{minRows:4}},model:{value:e.permitDomainform.domains,callback:function(t){e.$set(e.permitDomainform,"domains","string"==typeof t?t.trim():t)},expression:"permitDomainform.domains"}}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.addPermitDomain("permitDomainform")}}},[e._v(e._s(e.$t("lg.add")))])],1)],1)],1),e._v(" "),a("div",[0==e.permitDomainData.length?a("p",{staticClass:"nodata-box"},[e._v(e._s(e.$t("lg.nodata")))]):e._e(),e._v(" "),e.permitDomainData.length>0?a("div",{staticClass:"permitDomainBox"},[a("table",[a("thead",[a("tr",[a("th",[e._v(e._s(e.$t("lg.serialnumber")))]),e._v(" "),a("th",[e._v("可管理域名")]),e._v(" "),a("th",{attrs:{width:"110"}})])]),e._v(" "),a("tbody",e._l(e.permitDomainData,function(t,s){return a("tr",{key:s},[a("td",[e._v(e._s(s+1))]),e._v(" "),a("td",[e._v(e._s(t))]),e._v(" "),a("td",{staticClass:"text-center"},[a("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"},on:{click:function(a){e.delPermitDomain(t,s)}}},[a("i",{staticClass:"el-icon-close"}),e._v(e._s(e.$t("lg.delete")))])])])}))])]):e._e()]),e._v(" "),a("loading",{directives:[{name:"show",rawName:"v-show",value:e.permitDomainloading,expression:"permitDomainloading"}],attrs:{title:e.$t("lg.loading")}})],1)],1)},staticRenderFns:[]};var u=a("VU/8")(l,c,!1,function(e){a("Y2d8")},"data-v-124a6d5e",null).exports,m=a("xrTZ").Base64,f={props:{isShow:{type:Boolean}},data:function(){var e=this;return{userloading:!1,addform:{user:"",password:"",checkPass:"",gradeOptions:[{value:"ADMIN",label:"ADMIN"},{value:"USER",label:"USER"},{value:"AUDIT",label:"AUDIT"}],gradeValue:""},addformRules:{user:[{required:!0,message:this.$t("lg.required"),trigger:"blur"},{min:3,max:32,message:this.$t("lg.length332"),trigger:"blur"}],gradeValue:[{required:!0,message:this.$t("lg.required"),trigger:"blur"}],password:[{validator:function(t,a,s){""===a?s(new Error("请输入密码")):(/^(?=.*\d)(?=.*[a-zA-Z])[\da-zA-Z\-\."\\\*\!\$@\?\^\(\)<>\{\}\[\]=%\&:;\/~\+#_`]{6,20}$/.test(a)||s(new Error("请输入6-20位长度的密码，必须含字母和数字！")),""!==e.addform.checkPass&&e.$refs.addform.validateField("checkPass"),s())},trigger:"blur"},{required:!0,message:this.$t("lg.required"),trigger:"blur"}],checkPass:[{validator:function(t,a,s){""===a?s(new Error("请再次输入密码")):a!==e.addform.password?s(new Error(e.$t("lg.nomatch"))):s()},trigger:"blur"},{required:!0,message:this.$t("lg.required"),trigger:"blur"}]}}},methods:{addUser:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a=t.addform.user,s=[],o=m.encode(t.addform.password);s.push(t.addform.gradeValue);var n=i.b+"uaa/user";t.userloading=!0,r.a.post(n,{userName:a,password:o,roles:s}).then(function(e){0==e.data.responseCode?(t.$emit("hasadduser"),t.$message({type:"success",message:t.$t("lg.success")}),t.resetForm()):t.$message.error(t.$t("lg.failed")),t.userloading=!1}).catch(function(e){t.$message.error(e.data),t.userloading=!1})}})},resetForm:function(){this.$refs.addform.resetFields(),this.$emit("addclose")}},components:{loading:o.a}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{width:"40%",title:e.$t("lg.add"),visible:e.isShow,"close-on-click-modal":!1,"before-close":e.resetForm},on:{"update:visible":function(t){e.isShow=t}}},[a("el-form",{ref:"addform",attrs:{model:e.addform,rules:e.addformRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:e.$t("lg.account"),prop:"user"}},[a("el-input",{model:{value:e.addform.user,callback:function(t){e.$set(e.addform,"user","string"==typeof t?t.trim():t)},expression:"addform.user"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("lg.permission"),prop:"gradeValue"}},[a("el-select",{attrs:{placeholder:e.$t("lg.select")},model:{value:e.addform.gradeValue,callback:function(t){e.$set(e.addform,"gradeValue",t)},expression:"addform.gradeValue"}},e._l(e.addform.gradeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("lg.password"),prop:"password"}},[a("el-input",{attrs:{type:"password"},model:{value:e.addform.password,callback:function(t){e.$set(e.addform,"password","string"==typeof t?t.trim():t)},expression:"addform.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("lg.confirm"),prop:"checkPass"}},[a("el-input",{attrs:{type:"password"},model:{value:e.addform.checkPass,callback:function(t){e.$set(e.addform,"checkPass","string"==typeof t?t.trim():t)},expression:"addform.checkPass"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addUser("addform")}}},[e._v(e._s(e.$t("lg.add")))]),e._v(" "),a("el-button",{on:{click:function(t){e.resetForm()}}},[e._v(e._s(e.$t("lg.cancel")))])],1)],1),e._v(" "),a("loading",{directives:[{name:"show",rawName:"v-show",value:e.userloading,expression:"userloading"}],attrs:{title:e.$t("lg.loading")}})],1)],1)},staticRenderFns:[]},p={components:{domainDistribute:u,adduser:a("VU/8")(f,g,!1,null,null,null).exports,edituser:a("0dwM").a,loading:o.a},created:function(){this.$store.state.contentLoading=!0,this.getUsers()},data:function(){return{users:[],addShow:!1,editPwdShow:!1,editGradeShow:!1,userInfo:{},distributeDomainShow:!1,currentUser:"",isShowUsDialog:!1,needPostRequest:!1,userSettingform:{pwInterval:null},userSettingformRules:{pwInterval:[{required:!0,message:this.$t("lg.required"),trigger:"blur"},{pattern:/^[1-9]\d*$/,message:"必须为大于0的整数数值",trigger:"change"}]},userSetingloading:!1}},methods:{getUsers:function(){var e=this,t=i.b+"uaa/user";r.a.get(t).then(function(t){if(200==t.status){var a=t.data.data;e.users=a,e.$store.state.contentLoading=!1}}).catch(function(e){console.log(e)})},addUser:function(){this.addShow=!0},distributeDomain:function(e){var t=this;this.$refs.domain_distribute.getDistributeDomainData(e).then(function(a){t.currentUser=e,t.distributeDomainShow=!0})},editUser:function(e,t){this.userInfo=e,this[t]=!0},delUser:function(e){var t=this;this.$confirm(this.$t("lg.isdeleteUser"),this.$t("lg.tip"),{confirmButtonText:this.$t("lg.yes"),cancelButtonText:this.$t("lg.cancel"),type:"warning"}).then(function(){t.$store.state.contentLoading=!0;var a=i.b+"uaa/user/"+e;r.a.delete(a).then(function(e){0==e.data.responseCode?(t.getUsers(),t.$message({type:"success",message:t.$t("lg.success")})):t.$message.error(t.$t("lg.failed")+": "+e.data.data.message),t.$store.state.contentLoading=!1}).catch(function(e){console.log(e)})}).catch(function(){t.$message({type:"info",message:t.$t("lg.canceled")})})},getIntervalPeriod:function(){var e=this,t=i.b+"pe/shadow/kv/uaaIntervalPeriod";r.a.get(t).then(function(t){if(0==t.data.responseCode){var a=t.data.data;e.needPostRequest=!a,e.userSettingform.pwInterval=a?a.value:90,e.isShowUsDialog=!0}else e.$message.error(e.$t("lg.failed")+": "+t.data.data.message)}).catch(function(e){console.log(e)})},setIntervalPeriod:function(){var e=this;this.$refs.userSettingform.validate(function(t){if(t){var a=i.b+"pe/shadow/kv",s=e.needPostRequest?"post":"patch";e.userSetingloading=!0,r.a[s](a,{uaaIntervalPeriod:e.userSettingform.pwInterval-0}).then(function(t){0==t.data.responseCode?(e.$message({type:"success",message:e.$t("lg.success")}),e.usDialogClose()):e.$message.error(e.$t("lg.failed")+": "+t.data.data.message),e.userSetingloading=!1}).catch(function(e){console.log(e)})}})},usDialogClose:function(){this.isShowUsDialog=!1},usDrawerClose:function(e){e()}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"users-wrapper"},[a("h2",{staticClass:"breadcrumb"},[e._v(e._s(e.$t("lg.yonghugl")))]),e._v(" "),a("div",{staticClass:"btn-bg"},[a("el-button",{attrs:{type:"primary"},on:{click:e.addUser}},[e._v(e._s(e.$t("lg.adduser")))])],1),e._v(" "),a("div",{staticClass:"usersContent"},[0==e.users.length?a("p",{staticClass:"nodata-box"},[e._v(e._s(e.$t("lg.nodata")))]):e._e(),e._v(" "),e.users.length>0?a("table",[a("thead",[a("tr",[a("th",[e._v(e._s(e.$t("lg.account")))]),e._v(" "),a("th",[e._v(e._s(e.$t("lg.permission")))]),e._v(" "),a("th",{attrs:{width:"280"}})])]),e._v(" "),a("tbody",e._l(e.users,function(t){return a("tr",[a("td",[e._v(e._s(t.userName))]),e._v(" "),a("td",e._l(t.roles,function(t){return a("span",[e._v(" "+e._s(t))])})),e._v(" "),a("td",{staticClass:"text-center"},[a("a",{directives:[{name:"show",rawName:"v-show",value:"USER"==t.roles,expression:"item.roles=='USER'"}],staticClass:"edit-del-a",attrs:{href:"javascript:;"},on:{click:function(a){e.distributeDomain(t.userName)}}},[a("i",{staticClass:"el-icon-edit"}),e._v("域名分配管理")]),e._v(" "),a("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"},on:{click:function(a){e.editUser(t,"editGradeShow")}}},[a("i",{staticClass:"el-icon-edit"}),e._v(e._s(e.$t("lg.edit")))]),e._v(" "),a("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"},on:{click:function(a){e.editUser(t,"editPwdShow")}}},[a("i",{staticClass:"el-icon-edit-outline"}),e._v(e._s(e.$t("lg.update")))]),e._v(" "),a("a",{staticClass:"edit-del-a",attrs:{href:"javascript:;"},on:{click:function(a){e.delUser(t.userName)}}},[a("i",{staticClass:"el-icon-close"}),e._v(e._s(e.$t("lg.delete")))])])])}))]):e._e()]),e._v(" "),a("domain-distribute",{ref:"domain_distribute",attrs:{isShow:e.distributeDomainShow,currentUser:e.currentUser},on:{distributeDomainClose:function(t){e.distributeDomainShow=!1}}}),e._v(" "),a("adduser",{attrs:{isShow:e.addShow},on:{addclose:function(t){e.addShow=!1},hasadduser:e.getUsers}}),e._v(" "),a("edituser",{attrs:{isPwdShow:e.editPwdShow,isGradeShow:e.editGradeShow,userData:e.userInfo},on:{editPwdclose:function(t){e.editPwdShow=!1},editGradeclose:function(t){e.editGradeShow=!1},hasadduser:e.getUsers}}),e._v(" "),a("div",{staticClass:"text-right"},[a("el-button",{attrs:{type:"primary"},on:{click:e.getIntervalPeriod}},[e._v(" 高级设置 ")])],1),e._v(" "),a("el-dialog",{attrs:{width:"40%",title:"修改密码提醒时间间隔设置",visible:e.isShowUsDialog,"close-on-click-modal":!1,"before-close":e.usDialogClose},on:{"update:visible":function(t){e.isShowUsDialog=t}}},[a("el-form",{ref:"userSettingform",staticClass:"usDrawerContent",attrs:{model:e.userSettingform,rules:e.userSettingformRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"提醒间隔",prop:"pwInterval"}},[a("el-input",{model:{value:e.userSettingform.pwInterval,callback:function(t){e.$set(e.userSettingform,"pwInterval",t)},expression:"userSettingform.pwInterval"}},[a("template",{slot:"append"},[e._v("/天")])],2)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.setIntervalPeriod("gradeform")}}},[e._v("确认")]),e._v(" "),a("el-button",{on:{click:function(t){e.usDialogClose()}}},[e._v("取消")])],1)],1),e._v(" "),a("loading",{directives:[{name:"show",rawName:"v-show",value:e.userSetingloading,expression:"userSetingloading"}],attrs:{title:"数据处理中..."}})],1)],1)},staticRenderFns:[]};var v=a("VU/8")(p,h,!1,function(e){a("MS+k")},"data-v-04fd666f",null);t.default=v.exports},"MS+k":function(e,t){},Y2d8:function(e,t){}});
//# sourceMappingURL=17.703a78db7b66f6876560.js.map